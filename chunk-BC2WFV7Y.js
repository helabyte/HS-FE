import{a as ko}from"./chunk-5QNASIVI.js";import{a as Go,b as Qo}from"./chunk-PV6OZW6R.js";import{e as Un,h as $o}from"./chunk-O3K22ZTQ.js";import{a as xo}from"./chunk-XKK3VRSD.js";import{g as Io}from"./chunk-4T67CJ7Q.js";import{a as jo}from"./chunk-AYPRXAUO.js";import{a as Bo,b as zo,c as Ho,e as Wo,f as Uo,g as Vo}from"./chunk-3CLRMV22.js";import"./chunk-JAGYZ7TI.js";import{a as Po,b as Hn,c as Ao,d as Ut,e as Wn,h as Oo,j as Mo,k as Fo,l as Lo}from"./chunk-BIZO5LCZ.js";import{b as zn,c as No,d as _t}from"./chunk-AUNMA7IQ.js";import{$ as Ro,H as So,J as To,K as Do,L as Ln,N as pt,a as Fn,c as wo,m as Co,n as $i,o as Gi,p as bo,y as Eo}from"./chunk-KPUQBHP4.js";import"./chunk-2PPFUFFT.js";import{j as Bn}from"./chunk-IQ3U23OT.js";import"./chunk-TPPJ3RF3.js";import{$b as An,Aa as Nn,Ac as ft,Ba as Pn,Cc as K,D as Ui,Dc as Wt,Ea as ao,Fa as J,Fb as dt,G as Bt,Gb as M,Gc as yo,Ia as lo,Ib as je,Lb as Y,Mb as uo,Mc as Mn,Nb as fo,Oa as co,Ob as po,Pb as y,Qb as C,Rb as Z,Sa as Ht,Sb as $e,Tb as Ge,Tc as vo,Ub as q,Vb as ht,Y as X,Yb as ue,_b as j,a as ye,ac as Ne,b as Rn,ba as ct,bc as be,ca as Ie,cc as Vi,d as V,db as E,dc as oe,ea as ve,ec as ae,fb as we,g as Hi,gc as _o,ha as _,hc as mo,ia as io,ic as go,j as se,ja as so,jc as A,k as ot,kb as ke,kc as Qe,l as eo,lb as ho,lc as Pe,o as Lt,oa as kn,p as at,pa as Ue,q as lt,qa as Ve,qc as ee,r as to,ra as zt,rc as On,sa as ro,sb as U,sc as ji,ta as re,tb as xe,u as Re,ub as I,v as In,va as xn,w as no,wa as oo,wb as B,yb as Ce,z as Wi,zb as z,zc as ut}from"./chunk-2BAC4AMN.js";var Qi={NODE_CLIENT:!1,NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"};var f=function(n,t){if(!n)throw qe(t)},qe=function(n){return new Error("Firebase Database ("+Qi.SDK_VERSION+") INTERNAL ASSERT FAILED: "+n)};var qo=function(n){let t=[],e=0;for(let i=0;i<n.length;i++){let s=n.charCodeAt(i);s<128?t[e++]=s:s<2048?(t[e++]=s>>6|192,t[e++]=s&63|128):(s&64512)===55296&&i+1<n.length&&(n.charCodeAt(i+1)&64512)===56320?(s=65536+((s&1023)<<10)+(n.charCodeAt(++i)&1023),t[e++]=s>>18|240,t[e++]=s>>12&63|128,t[e++]=s>>6&63|128,t[e++]=s&63|128):(t[e++]=s>>12|224,t[e++]=s>>6&63|128,t[e++]=s&63|128)}return t},$c=function(n){let t=[],e=0,i=0;for(;e<n.length;){let s=n[e++];if(s<128)t[i++]=String.fromCharCode(s);else if(s>191&&s<224){let r=n[e++];t[i++]=String.fromCharCode((s&31)<<6|r&63)}else if(s>239&&s<365){let r=n[e++],o=n[e++],a=n[e++],l=((s&7)<<18|(r&63)<<12|(o&63)<<6|a&63)-65536;t[i++]=String.fromCharCode(55296+(l>>10)),t[i++]=String.fromCharCode(56320+(l&1023))}else{let r=n[e++],o=n[e++];t[i++]=String.fromCharCode((s&15)<<12|(r&63)<<6|o&63)}}return t.join("")},$n={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,t){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();let e=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,i=[];for(let s=0;s<n.length;s+=3){let r=n[s],o=s+1<n.length,a=o?n[s+1]:0,l=s+2<n.length,c=l?n[s+2]:0,h=r>>2,d=(r&3)<<4|a>>4,u=(a&15)<<2|c>>6,p=c&63;l||(p=64,o||(u=64)),i.push(e[h],e[d],e[u],e[p])}return i.join("")},encodeString(n,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(n):this.encodeByteArray(qo(n),t)},decodeString(n,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(n):$c(this.decodeStringToByteArray(n,t))},decodeStringToByteArray(n,t){this.init_();let e=t?this.charToByteMapWebSafe_:this.charToByteMap_,i=[];for(let s=0;s<n.length;){let r=e[n.charAt(s++)],a=s<n.length?e[n.charAt(s)]:0;++s;let c=s<n.length?e[n.charAt(s)]:64;++s;let d=s<n.length?e[n.charAt(s)]:64;if(++s,r==null||a==null||c==null||d==null)throw new Yi;let u=r<<2|a>>4;if(i.push(u),c!==64){let p=a<<4&240|c>>2;if(i.push(p),d!==64){let m=c<<6&192|d;i.push(m)}}}return i},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}},Yi=class extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}},qi=function(n){let t=qo(n);return $n.encodeByteArray(t,!0)},Vt=function(n){return qi(n).replace(/\./g,"")},Vn=function(n){try{return $n.decodeString(n,!0)}catch(t){console.error("base64Decode failed: ",t)}return null};function Ko(n){return Xo(void 0,n)}function Xo(n,t){if(!(t instanceof Object))return t;switch(t.constructor){case Date:let e=t;return new Date(e.getTime());case Object:n===void 0&&(n={});break;case Array:n=[];break;default:return t}for(let e in t)!t.hasOwnProperty(e)||!Gc(e)||(n[e]=Xo(n[e],t[e]));return n}function Gc(n){return n!=="__proto__"}function Qc(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}var Yc=()=>Qc().__FIREBASE_DEFAULTS__,qc=()=>{if(typeof process>"u"||typeof process.env>"u")return;let n=process.env.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},Kc=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}let t=n&&Vn(n[1]);return t&&JSON.parse(t)},Jo=()=>{try{return Yc()||qc()||Kc()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},Xc=n=>{var t,e;return(e=(t=Jo())===null||t===void 0?void 0:t.emulatorHosts)===null||e===void 0?void 0:e[n]},Zo=n=>{let t=Xc(n);if(!t)return;let e=t.lastIndexOf(":");if(e<=0||e+1===t.length)throw new Error(`Invalid host ${t} with no separate hostname and port!`);let i=parseInt(t.substring(e+1),10);return t[0]==="["?[t.substring(1,e-1),i]:[t.substring(0,e),i]},Ki=()=>{var n;return(n=Jo())===null||n===void 0?void 0:n.config};var Ee=class{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((t,e)=>{this.resolve=t,this.reject=e})}wrapCallback(t){return(e,i)=>{e?this.reject(e):this.resolve(i),typeof t=="function"&&(this.promise.catch(()=>{}),t.length===1?t(e):t(e,i))}}};function ea(n,t){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');let e={alg:"none",type:"JWT"},i=t||"demo-project",s=n.iat||0,r=n.sub||n.user_id;if(!r)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");let o=Object.assign({iss:`https://securetoken.google.com/${i}`,aud:i,iat:s,exp:s+3600,auth_time:s,sub:r,user_id:r,firebase:{sign_in_provider:"custom",identities:{}}},n);return[Vt(JSON.stringify(e)),Vt(JSON.stringify(o)),""].join(".")}function Jc(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function Xi(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Jc())}function ta(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function fe(){return Qi.NODE_CLIENT===!0||Qi.NODE_ADMIN===!0}function na(){try{return typeof indexedDB=="object"}catch{return!1}}function ia(){return new Promise((n,t)=>{try{let e=!0,i="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(i);s.onsuccess=()=>{s.result.close(),e||self.indexedDB.deleteDatabase(i),n(!0)},s.onupgradeneeded=()=>{e=!1},s.onerror=()=>{var r;t(((r=s.error)===null||r===void 0?void 0:r.message)||"")}}catch(e){t(e)}})}var Zc="FirebaseError",Ye=class n extends Error{constructor(t,e,i){super(e),this.code=t,this.customData=i,this.name=Zc,Object.setPrototypeOf(this,n.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,jt.prototype.create)}},jt=class{constructor(t,e,i){this.service=t,this.serviceName=e,this.errors=i}create(t,...e){let i=e[0]||{},s=`${this.service}/${t}`,r=this.errors[t],o=r?ed(r,i):"Error",a=`${this.serviceName}: ${o} (${s}).`;return new Ye(s,a,i)}};function ed(n,t){return n.replace(td,(e,i)=>{let s=t[i];return s!=null?String(s):`<${i}?>`})}var td=/\{\$([^}]+)}/g;function mt(n){return JSON.parse(n)}function F(n){return JSON.stringify(n)}var sa=function(n){let t={},e={},i={},s="";try{let r=n.split(".");t=mt(Vn(r[0])||""),e=mt(Vn(r[1])||""),s=r[2],i=e.d||{},delete e.d}catch{}return{header:t,claims:e,data:i,signature:s}};var ra=function(n){let t=sa(n),e=t.claims;return!!e&&typeof e=="object"&&e.hasOwnProperty("iat")},oa=function(n){let t=sa(n).claims;return typeof t=="object"&&t.admin===!0};function le(n,t){return Object.prototype.hasOwnProperty.call(n,t)}function Ke(n,t){if(Object.prototype.hasOwnProperty.call(n,t))return n[t]}function Ji(n){for(let t in n)if(Object.prototype.hasOwnProperty.call(n,t))return!1;return!0}function $t(n,t,e){let i={};for(let s in n)Object.prototype.hasOwnProperty.call(n,s)&&(i[s]=t.call(e,n[s],s,n));return i}function Gn(n,t){if(n===t)return!0;let e=Object.keys(n),i=Object.keys(t);for(let s of e){if(!i.includes(s))return!1;let r=n[s],o=t[s];if(Yo(r)&&Yo(o)){if(!Gn(r,o))return!1}else if(r!==o)return!1}for(let s of i)if(!e.includes(s))return!1;return!0}function Yo(n){return n!==null&&typeof n=="object"}function aa(n){let t=[];for(let[e,i]of Object.entries(n))Array.isArray(i)?i.forEach(s=>{t.push(encodeURIComponent(e)+"="+encodeURIComponent(s))}):t.push(encodeURIComponent(e)+"="+encodeURIComponent(i));return t.length?"&"+t.join("&"):""}var jn=class{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=512/8,this.pad_[0]=128;for(let t=1;t<this.blockSize;++t)this.pad_[t]=0;this.reset()}reset(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0}compress_(t,e){e||(e=0);let i=this.W_;if(typeof t=="string")for(let d=0;d<16;d++)i[d]=t.charCodeAt(e)<<24|t.charCodeAt(e+1)<<16|t.charCodeAt(e+2)<<8|t.charCodeAt(e+3),e+=4;else for(let d=0;d<16;d++)i[d]=t[e]<<24|t[e+1]<<16|t[e+2]<<8|t[e+3],e+=4;for(let d=16;d<80;d++){let u=i[d-3]^i[d-8]^i[d-14]^i[d-16];i[d]=(u<<1|u>>>31)&4294967295}let s=this.chain_[0],r=this.chain_[1],o=this.chain_[2],a=this.chain_[3],l=this.chain_[4],c,h;for(let d=0;d<80;d++){d<40?d<20?(c=a^r&(o^a),h=1518500249):(c=r^o^a,h=1859775393):d<60?(c=r&o|a&(r|o),h=2400959708):(c=r^o^a,h=3395469782);let u=(s<<5|s>>>27)+c+l+h+i[d]&4294967295;l=a,a=o,o=(r<<30|r>>>2)&4294967295,r=s,s=u}this.chain_[0]=this.chain_[0]+s&4294967295,this.chain_[1]=this.chain_[1]+r&4294967295,this.chain_[2]=this.chain_[2]+o&4294967295,this.chain_[3]=this.chain_[3]+a&4294967295,this.chain_[4]=this.chain_[4]+l&4294967295}update(t,e){if(t==null)return;e===void 0&&(e=t.length);let i=e-this.blockSize,s=0,r=this.buf_,o=this.inbuf_;for(;s<e;){if(o===0)for(;s<=i;)this.compress_(t,s),s+=this.blockSize;if(typeof t=="string"){for(;s<e;)if(r[o]=t.charCodeAt(s),++o,++s,o===this.blockSize){this.compress_(r),o=0;break}}else for(;s<e;)if(r[o]=t[s],++o,++s,o===this.blockSize){this.compress_(r),o=0;break}}this.inbuf_=o,this.total_+=e}digest(){let t=[],e=this.total_*8;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(let s=this.blockSize-1;s>=56;s--)this.buf_[s]=e&255,e/=256;this.compress_(this.buf_);let i=0;for(let s=0;s<5;s++)for(let r=24;r>=0;r-=8)t[i]=this.chain_[s]>>r&255,++i;return t}};function Gt(n,t){return`${n} failed: ${t} argument `}var la=function(n){let t=[],e=0;for(let i=0;i<n.length;i++){let s=n.charCodeAt(i);if(s>=55296&&s<=56319){let r=s-55296;i++,f(i<n.length,"Surrogate pair missing trail surrogate.");let o=n.charCodeAt(i)-56320;s=65536+(r<<10)+o}s<128?t[e++]=s:s<2048?(t[e++]=s>>6|192,t[e++]=s&63|128):s<65536?(t[e++]=s>>12|224,t[e++]=s>>6&63|128,t[e++]=s&63|128):(t[e++]=s>>18|240,t[e++]=s>>12&63|128,t[e++]=s>>6&63|128,t[e++]=s&63|128)}return t},Qt=function(n){let t=0;for(let e=0;e<n.length;e++){let i=n.charCodeAt(e);i<128?t++:i<2048?t+=2:i>=55296&&i<=56319?(t+=4,e++):t+=3}return t};var Up=4*60*60*1e3;function Ae(n){return n&&n._delegate?n._delegate:n}var Se=class{constructor(t,e,i){this.name=t,this.instanceFactory=e,this.type=i,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(t){return this.instantiationMode=t,this}setMultipleInstances(t){return this.multipleInstances=t,this}setServiceProps(t){return this.serviceProps=t,this}setInstanceCreatedCallback(t){return this.onInstanceCreated=t,this}};var Xe="[DEFAULT]";var Qn=class{constructor(t,e){this.name=t,this.container=e,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(t){let e=this.normalizeInstanceIdentifier(t);if(!this.instancesDeferred.has(e)){let i=new Ee;if(this.instancesDeferred.set(e,i),this.isInitialized(e)||this.shouldAutoInitialize())try{let s=this.getOrInitializeService({instanceIdentifier:e});s&&i.resolve(s)}catch{}}return this.instancesDeferred.get(e).promise}getImmediate(t){var e;let i=this.normalizeInstanceIdentifier(t?.identifier),s=(e=t?.optional)!==null&&e!==void 0?e:!1;if(this.isInitialized(i)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:i})}catch(r){if(s)return null;throw r}else{if(s)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(t){if(t.name!==this.name)throw Error(`Mismatching Component ${t.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=t,!!this.shouldAutoInitialize()){if(id(t))try{this.getOrInitializeService({instanceIdentifier:Xe})}catch{}for(let[e,i]of this.instancesDeferred.entries()){let s=this.normalizeInstanceIdentifier(e);try{let r=this.getOrInitializeService({instanceIdentifier:s});i.resolve(r)}catch{}}}}clearInstance(t=Xe){this.instancesDeferred.delete(t),this.instancesOptions.delete(t),this.instances.delete(t)}delete(){return V(this,null,function*(){let t=Array.from(this.instances.values());yield Promise.all([...t.filter(e=>"INTERNAL"in e).map(e=>e.INTERNAL.delete()),...t.filter(e=>"_delete"in e).map(e=>e._delete())])})}isComponentSet(){return this.component!=null}isInitialized(t=Xe){return this.instances.has(t)}getOptions(t=Xe){return this.instancesOptions.get(t)||{}}initialize(t={}){let{options:e={}}=t,i=this.normalizeInstanceIdentifier(t.instanceIdentifier);if(this.isInitialized(i))throw Error(`${this.name}(${i}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);let s=this.getOrInitializeService({instanceIdentifier:i,options:e});for(let[r,o]of this.instancesDeferred.entries()){let a=this.normalizeInstanceIdentifier(r);i===a&&o.resolve(s)}return s}onInit(t,e){var i;let s=this.normalizeInstanceIdentifier(e),r=(i=this.onInitCallbacks.get(s))!==null&&i!==void 0?i:new Set;r.add(t),this.onInitCallbacks.set(s,r);let o=this.instances.get(s);return o&&t(o,s),()=>{r.delete(t)}}invokeOnInitCallbacks(t,e){let i=this.onInitCallbacks.get(e);if(i)for(let s of i)try{s(t,e)}catch{}}getOrInitializeService({instanceIdentifier:t,options:e={}}){let i=this.instances.get(t);if(!i&&this.component&&(i=this.component.instanceFactory(this.container,{instanceIdentifier:nd(t),options:e}),this.instances.set(t,i),this.instancesOptions.set(t,e),this.invokeOnInitCallbacks(i,t),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,t,i)}catch{}return i||null}normalizeInstanceIdentifier(t=Xe){return this.component?this.component.multipleInstances?t:Xe:t}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}};function nd(n){return n===Xe?void 0:n}function id(n){return n.instantiationMode==="EAGER"}var Yt=class{constructor(t){this.name=t,this.providers=new Map}addComponent(t){let e=this.getProvider(t.name);if(e.isComponentSet())throw new Error(`Component ${t.name} has already been registered with ${this.name}`);e.setComponent(t)}addOrOverwriteComponent(t){this.getProvider(t.name).isComponentSet()&&this.providers.delete(t.name),this.addComponent(t)}getProvider(t){if(this.providers.has(t))return this.providers.get(t);let e=new Qn(t,this);return this.providers.set(t,e),e}getProviders(){return Array.from(this.providers.values())}};var sd=[],k=function(n){return n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT",n}(k||{}),rd={debug:k.DEBUG,verbose:k.VERBOSE,info:k.INFO,warn:k.WARN,error:k.ERROR,silent:k.SILENT},od=k.INFO,ad={[k.DEBUG]:"log",[k.VERBOSE]:"log",[k.INFO]:"info",[k.WARN]:"warn",[k.ERROR]:"error"},ld=(n,t,...e)=>{if(t<n.logLevel)return;let i=new Date().toISOString(),s=ad[t];if(s)console[s](`[${i}]  ${n.name}:`,...e);else throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`)},gt=class{constructor(t){this.name=t,this._logLevel=od,this._logHandler=ld,this._userLogHandler=null,sd.push(this)}get logLevel(){return this._logLevel}set logLevel(t){if(!(t in k))throw new TypeError(`Invalid value "${t}" assigned to \`logLevel\``);this._logLevel=t}setLogLevel(t){this._logLevel=typeof t=="string"?rd[t]:t}get logHandler(){return this._logHandler}set logHandler(t){if(typeof t!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t}get userLogHandler(){return this._userLogHandler}set userLogHandler(t){this._userLogHandler=t}debug(...t){this._userLogHandler&&this._userLogHandler(this,k.DEBUG,...t),this._logHandler(this,k.DEBUG,...t)}log(...t){this._userLogHandler&&this._userLogHandler(this,k.VERBOSE,...t),this._logHandler(this,k.VERBOSE,...t)}info(...t){this._userLogHandler&&this._userLogHandler(this,k.INFO,...t),this._logHandler(this,k.INFO,...t)}warn(...t){this._userLogHandler&&this._userLogHandler(this,k.WARN,...t),this._logHandler(this,k.WARN,...t)}error(...t){this._userLogHandler&&this._userLogHandler(this,k.ERROR,...t),this._logHandler(this,k.ERROR,...t)}};var cd=(n,t)=>t.some(e=>n instanceof e),ca,da;function dd(){return ca||(ca=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function hd(){return da||(da=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}var ha=new WeakMap,es=new WeakMap,ua=new WeakMap,Zi=new WeakMap,ns=new WeakMap;function ud(n){let t=new Promise((e,i)=>{let s=()=>{n.removeEventListener("success",r),n.removeEventListener("error",o)},r=()=>{e(pe(n.result)),s()},o=()=>{i(n.error),s()};n.addEventListener("success",r),n.addEventListener("error",o)});return t.then(e=>{e instanceof IDBCursor&&ha.set(e,n)}).catch(()=>{}),ns.set(t,n),t}function fd(n){if(es.has(n))return;let t=new Promise((e,i)=>{let s=()=>{n.removeEventListener("complete",r),n.removeEventListener("error",o),n.removeEventListener("abort",o)},r=()=>{e(),s()},o=()=>{i(n.error||new DOMException("AbortError","AbortError")),s()};n.addEventListener("complete",r),n.addEventListener("error",o),n.addEventListener("abort",o)});es.set(n,t)}var ts={get(n,t,e){if(n instanceof IDBTransaction){if(t==="done")return es.get(n);if(t==="objectStoreNames")return n.objectStoreNames||ua.get(n);if(t==="store")return e.objectStoreNames[1]?void 0:e.objectStore(e.objectStoreNames[0])}return pe(n[t])},set(n,t,e){return n[t]=e,!0},has(n,t){return n instanceof IDBTransaction&&(t==="done"||t==="store")?!0:t in n}};function fa(n){ts=n(ts)}function pd(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(t,...e){let i=n.call(Yn(this),t,...e);return ua.set(i,t.sort?t.sort():[t]),pe(i)}:hd().includes(n)?function(...t){return n.apply(Yn(this),t),pe(ha.get(this))}:function(...t){return pe(n.apply(Yn(this),t))}}function _d(n){return typeof n=="function"?pd(n):(n instanceof IDBTransaction&&fd(n),cd(n,dd())?new Proxy(n,ts):n)}function pe(n){if(n instanceof IDBRequest)return ud(n);if(Zi.has(n))return Zi.get(n);let t=_d(n);return t!==n&&(Zi.set(n,t),ns.set(t,n)),t}var Yn=n=>ns.get(n);function _a(n,t,{blocked:e,upgrade:i,blocking:s,terminated:r}={}){let o=indexedDB.open(n,t),a=pe(o);return i&&o.addEventListener("upgradeneeded",l=>{i(pe(o.result),l.oldVersion,l.newVersion,pe(o.transaction),l)}),e&&o.addEventListener("blocked",l=>e(l.oldVersion,l.newVersion,l)),a.then(l=>{r&&l.addEventListener("close",()=>r()),s&&l.addEventListener("versionchange",c=>s(c.oldVersion,c.newVersion,c))}).catch(()=>{}),a}var md=["get","getKey","getAll","getAllKeys","count"],gd=["put","add","delete","clear"],is=new Map;function pa(n,t){if(!(n instanceof IDBDatabase&&!(t in n)&&typeof t=="string"))return;if(is.get(t))return is.get(t);let e=t.replace(/FromIndex$/,""),i=t!==e,s=gd.includes(e);if(!(e in(i?IDBIndex:IDBObjectStore).prototype)||!(s||md.includes(e)))return;let r=function(o,...a){return V(this,null,function*(){let l=this.transaction(o,s?"readwrite":"readonly"),c=l.store;return i&&(c=c.index(a.shift())),(yield Promise.all([c[e](...a),s&&l.done]))[0]})};return is.set(t,r),r}fa(n=>Rn(ye({},n),{get:(t,e,i)=>pa(t,e)||n.get(t,e,i),has:(t,e)=>!!pa(t,e)||n.has(t,e)}));var rs=class{constructor(t){this.container=t}getPlatformInfoString(){return this.container.getProviders().map(e=>{if(yd(e)){let i=e.getImmediate();return`${i.library}/${i.version}`}else return null}).filter(e=>e).join(" ")}};function yd(n){let t=n.getComponent();return t?.type==="VERSION"}var os="@firebase/app",ma="0.11.1";var Te=new gt("@firebase/app"),vd="@firebase/app-compat",wd="@firebase/analytics-compat",Cd="@firebase/analytics",bd="@firebase/app-check-compat",Ed="@firebase/app-check",Sd="@firebase/auth",Td="@firebase/auth-compat",Dd="@firebase/database",Rd="@firebase/data-connect",Id="@firebase/database-compat",kd="@firebase/functions",xd="@firebase/functions-compat",Nd="@firebase/installations",Pd="@firebase/installations-compat",Ad="@firebase/messaging",Od="@firebase/messaging-compat",Md="@firebase/performance",Fd="@firebase/performance-compat",Ld="@firebase/remote-config",Bd="@firebase/remote-config-compat",zd="@firebase/storage",Hd="@firebase/storage-compat",Wd="@firebase/firestore",Ud="@firebase/vertexai",Vd="@firebase/firestore-compat",jd="firebase",$d="11.3.1";var as="[DEFAULT]",Gd={[os]:"fire-core",[vd]:"fire-core-compat",[Cd]:"fire-analytics",[wd]:"fire-analytics-compat",[Ed]:"fire-app-check",[bd]:"fire-app-check-compat",[Sd]:"fire-auth",[Td]:"fire-auth-compat",[Dd]:"fire-rtdb",[Rd]:"fire-data-connect",[Id]:"fire-rtdb-compat",[kd]:"fire-fn",[xd]:"fire-fn-compat",[Nd]:"fire-iid",[Pd]:"fire-iid-compat",[Ad]:"fire-fcm",[Od]:"fire-fcm-compat",[Md]:"fire-perf",[Fd]:"fire-perf-compat",[Ld]:"fire-rc",[Bd]:"fire-rc-compat",[zd]:"fire-gcs",[Hd]:"fire-gcs-compat",[Wd]:"fire-fst",[Vd]:"fire-fst-compat",[Ud]:"fire-vertex","fire-js":"fire-js",[jd]:"fire-js-all"};var qn=new Map,Qd=new Map,ls=new Map;function ga(n,t){try{n.container.addComponent(t)}catch(e){Te.debug(`Component ${t.name} failed to register with FirebaseApp ${n.name}`,e)}}function qt(n){let t=n.name;if(ls.has(t))return Te.debug(`There were multiple attempts to register component ${t}.`),!1;ls.set(t,n);for(let e of qn.values())ga(e,n);for(let e of Qd.values())ga(e,n);return!0}function Ca(n,t){let e=n.container.getProvider("heartbeat").getImmediate({optional:!0});return e&&e.triggerHeartbeat(),n.container.getProvider(t)}function ba(n){return n==null?!1:n.settings!==void 0}var Yd={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},Oe=new jt("app","Firebase",Yd);var cs=class{constructor(t,e,i){this._isDeleted=!1,this._options=Object.assign({},t),this._config=Object.assign({},e),this._name=e.name,this._automaticDataCollectionEnabled=e.automaticDataCollectionEnabled,this._container=i,this.container.addComponent(new Se("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(t){this.checkDestroyed(),this._automaticDataCollectionEnabled=t}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(t){this._isDeleted=t}checkDestroyed(){if(this.isDeleted)throw Oe.create("app-deleted",{appName:this._name})}};var Ea=$d;function us(n,t={}){let e=n;typeof t!="object"&&(t={name:t});let i=Object.assign({name:as,automaticDataCollectionEnabled:!1},t),s=i.name;if(typeof s!="string"||!s)throw Oe.create("bad-app-name",{appName:String(s)});if(e||(e=Ki()),!e)throw Oe.create("no-options");let r=qn.get(s);if(r){if(Gn(e,r.options)&&Gn(i,r.config))return r;throw Oe.create("duplicate-app",{appName:s})}let o=new Yt(s);for(let l of ls.values())o.addComponent(l);let a=new cs(e,i,o);return qn.set(s,a),a}function Sa(n=as){let t=qn.get(n);if(!t&&n===as&&Ki())return us();if(!t)throw Oe.create("no-app",{appName:n});return t}function Me(n,t,e){var i;let s=(i=Gd[n])!==null&&i!==void 0?i:n;e&&(s+=`-${e}`);let r=s.match(/\s|\//),o=t.match(/\s|\//);if(r||o){let a=[`Unable to register library "${s}" with version "${t}":`];r&&a.push(`library name "${s}" contains illegal characters (whitespace or "/")`),r&&o&&a.push("and"),o&&a.push(`version name "${t}" contains illegal characters (whitespace or "/")`),Te.warn(a.join(" "));return}qt(new Se(`${s}-version`,()=>({library:s,version:t}),"VERSION"))}var qd="firebase-heartbeat-database",Kd=1,Kt="firebase-heartbeat-store",ss=null;function Ta(){return ss||(ss=_a(qd,Kd,{upgrade:(n,t)=>{switch(t){case 0:try{n.createObjectStore(Kt)}catch(e){console.warn(e)}}}}).catch(n=>{throw Oe.create("idb-open",{originalErrorMessage:n.message})})),ss}function Xd(n){return V(this,null,function*(){try{let e=(yield Ta()).transaction(Kt),i=yield e.objectStore(Kt).get(Da(n));return yield e.done,i}catch(t){if(t instanceof Ye)Te.warn(t.message);else{let e=Oe.create("idb-get",{originalErrorMessage:t?.message});Te.warn(e.message)}}})}function ya(n,t){return V(this,null,function*(){try{let i=(yield Ta()).transaction(Kt,"readwrite");yield i.objectStore(Kt).put(t,Da(n)),yield i.done}catch(e){if(e instanceof Ye)Te.warn(e.message);else{let i=Oe.create("idb-set",{originalErrorMessage:e?.message});Te.warn(i.message)}}})}function Da(n){return`${n.name}!${n.options.appId}`}var Jd=1024,Zd=30,ds=class{constructor(t){this.container=t,this._heartbeatsCache=null;let e=this.container.getProvider("app").getImmediate();this._storage=new hs(e),this._heartbeatsCachePromise=this._storage.read().then(i=>(this._heartbeatsCache=i,i))}triggerHeartbeat(){return V(this,null,function*(){var t,e;try{let s=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),r=va();if(((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null&&(this._heartbeatsCache=yield this._heartbeatsCachePromise,((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===r||this._heartbeatsCache.heartbeats.some(o=>o.date===r))return;if(this._heartbeatsCache.heartbeats.push({date:r,agent:s}),this._heartbeatsCache.heartbeats.length>Zd){let o=th(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(o,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(i){Te.warn(i)}})}getHeartbeatsHeader(){return V(this,null,function*(){var t;try{if(this._heartbeatsCache===null&&(yield this._heartbeatsCachePromise),((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";let e=va(),{heartbeatsToSend:i,unsentEntries:s}=eh(this._heartbeatsCache.heartbeats),r=Vt(JSON.stringify({version:2,heartbeats:i}));return this._heartbeatsCache.lastSentHeartbeatDate=e,s.length>0?(this._heartbeatsCache.heartbeats=s,yield this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),r}catch(e){return Te.warn(e),""}})}};function va(){return new Date().toISOString().substring(0,10)}function eh(n,t=Jd){let e=[],i=n.slice();for(let s of n){let r=e.find(o=>o.agent===s.agent);if(r){if(r.dates.push(s.date),wa(e)>t){r.dates.pop();break}}else if(e.push({agent:s.agent,dates:[s.date]}),wa(e)>t){e.pop();break}i=i.slice(1)}return{heartbeatsToSend:e,unsentEntries:i}}var hs=class{constructor(t){this.app=t,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}runIndexedDBEnvironmentCheck(){return V(this,null,function*(){return na()?ia().then(()=>!0).catch(()=>!1):!1})}read(){return V(this,null,function*(){if(yield this._canUseIndexedDBPromise){let e=yield Xd(this.app);return e?.heartbeats?e:{heartbeats:[]}}else return{heartbeats:[]}})}overwrite(t){return V(this,null,function*(){var e;if(yield this._canUseIndexedDBPromise){let s=yield this.read();return ya(this.app,{lastSentHeartbeatDate:(e=t.lastSentHeartbeatDate)!==null&&e!==void 0?e:s.lastSentHeartbeatDate,heartbeats:t.heartbeats})}else return})}add(t){return V(this,null,function*(){var e;if(yield this._canUseIndexedDBPromise){let s=yield this.read();return ya(this.app,{lastSentHeartbeatDate:(e=t.lastSentHeartbeatDate)!==null&&e!==void 0?e:s.lastSentHeartbeatDate,heartbeats:[...s.heartbeats,...t.heartbeats]})}else return})}};function wa(n){return Vt(JSON.stringify({version:2,heartbeats:n})).length}function th(n){if(n.length===0)return-1;let t=0,e=n[0].date;for(let i=1;i<n.length;i++)n[i].date<e&&(e=n[i].date,t=i);return t}function nh(n){qt(new Se("platform-logger",t=>new rs(t),"PRIVATE")),qt(new Se("heartbeat",t=>new ds(t),"PRIVATE")),Me(os,ma,n),Me(os,ma,"esm2017"),Me("fire-js","")}nh("");var ih="firebase",sh="11.3.1";Me(ih,sh,"app");var Ra="@firebase/database",Ia="1.0.12";var _r="";function rh(n){_r=n}var ws=class{constructor(t){this.domStorage_=t,this.prefix_="firebase:"}set(t,e){e==null?this.domStorage_.removeItem(this.prefixedName_(t)):this.domStorage_.setItem(this.prefixedName_(t),F(e))}get(t){let e=this.domStorage_.getItem(this.prefixedName_(t));return e==null?null:mt(e)}remove(t){this.domStorage_.removeItem(this.prefixedName_(t))}prefixedName_(t){return this.prefix_+t}toString(){return this.domStorage_.toString()}};var Cs=class{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(t,e){e==null?delete this.cache_[t]:this.cache_[t]=e}get(t){return le(this.cache_,t)?this.cache_[t]:null}remove(t){delete this.cache_[t]}};var rl=function(n){try{if(typeof window<"u"&&typeof window[n]<"u"){let t=window[n];return t.setItem("firebase:sentinel","cache"),t.removeItem("firebase:sentinel"),new ws(t)}}catch{}return new Cs},Ze=rl("localStorage"),bs=rl("sessionStorage");var wt=new gt("@firebase/database"),oh=function(){let n=1;return function(){return n++}}(),ol=function(n){let t=la(n),e=new jn;e.update(t);let i=e.digest();return $n.encodeByteArray(i)},vn=function(...n){let t="";for(let e=0;e<n.length;e++){let i=n[e];Array.isArray(i)||i&&typeof i=="object"&&typeof i.length=="number"?t+=vn.apply(null,i):typeof i=="object"?t+=F(i):t+=i,t+=" "}return t},et=null,ka=!0,ah=function(n,t){f(!t||n===!0||n===!1,"Can't turn on custom loggers persistently."),n===!0?(wt.logLevel=k.VERBOSE,et=wt.log.bind(wt),t&&bs.set("logging_enabled",!0)):typeof n=="function"?et=n:(et=null,bs.remove("logging_enabled"))},H=function(...n){if(ka===!0&&(ka=!1,et===null&&bs.get("logging_enabled")===!0&&ah(!0)),et){let t=vn.apply(null,n);et(t)}},wn=function(n){return function(...t){H(n,...t)}},Es=function(...n){let t="FIREBASE INTERNAL ERROR: "+vn(...n);wt.error(t)},De=function(...n){let t=`FIREBASE FATAL ERROR: ${vn(...n)}`;throw wt.error(t),new Error(t)},G=function(...n){let t="FIREBASE WARNING: "+vn(...n);wt.warn(t)},lh=function(){typeof window<"u"&&window.location&&window.location.protocol&&window.location.protocol.indexOf("https:")!==-1&&G("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},mr=function(n){return typeof n=="number"&&(n!==n||n===Number.POSITIVE_INFINITY||n===Number.NEGATIVE_INFINITY)},ch=function(n){if(fe()||document.readyState==="complete")n();else{let t=!1,e=function(){if(!document.body){setTimeout(e,Math.floor(10));return}t||(t=!0,n())};document.addEventListener?(document.addEventListener("DOMContentLoaded",e,!1),window.addEventListener("load",e,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{document.readyState==="complete"&&e()}),window.attachEvent("onload",e))}},bt="[MIN_NAME]",tt="[MAX_NAME]",it=function(n,t){if(n===t)return 0;if(n===bt||t===tt)return-1;if(t===bt||n===tt)return 1;{let e=xa(n),i=xa(t);return e!==null?i!==null?e-i===0?n.length-t.length:e-i:-1:i!==null?1:n<t?-1:1}},dh=function(n,t){return n===t?0:n<t?-1:1},Xt=function(n,t){if(t&&n in t)return t[n];throw new Error("Missing required key ("+n+") in object: "+F(t))},gr=function(n){if(typeof n!="object"||n===null)return F(n);let t=[];for(let i in n)t.push(i);t.sort();let e="{";for(let i=0;i<t.length;i++)i!==0&&(e+=","),e+=F(t[i]),e+=":",e+=gr(n[t[i]]);return e+="}",e},al=function(n,t){let e=n.length;if(e<=t)return[n];let i=[];for(let s=0;s<e;s+=t)s+t>e?i.push(n.substring(s,e)):i.push(n.substring(s,s+t));return i};function W(n,t){for(let e in n)n.hasOwnProperty(e)&&t(e,n[e])}var ll=function(n){f(!mr(n),"Invalid JSON number");let t=11,e=52,i=(1<<t-1)-1,s,r,o,a,l;n===0?(r=0,o=0,s=1/n===-1/0?1:0):(s=n<0,n=Math.abs(n),n>=Math.pow(2,1-i)?(a=Math.min(Math.floor(Math.log(n)/Math.LN2),i),r=a+i,o=Math.round(n*Math.pow(2,e-a)-Math.pow(2,e))):(r=0,o=Math.round(n/Math.pow(2,1-i-e))));let c=[];for(l=e;l;l-=1)c.push(o%2?1:0),o=Math.floor(o/2);for(l=t;l;l-=1)c.push(r%2?1:0),r=Math.floor(r/2);c.push(s?1:0),c.reverse();let h=c.join(""),d="";for(l=0;l<64;l+=8){let u=parseInt(h.substr(l,8),2).toString(16);u.length===1&&(u="0"+u),d=d+u}return d.toLowerCase()},hh=function(){return!!(typeof window=="object"&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))},uh=function(){return typeof Windows=="object"&&typeof Windows.UI=="object"};function fh(n,t){let e="Unknown Error";n==="too_big"?e="The data requested exceeds the maximum size that can be accessed with a single request.":n==="permission_denied"?e="Client doesn't have permission to access the desired data.":n==="unavailable"&&(e="The service is unavailable");let i=new Error(n+" at "+t._path.toString()+": "+e);return i.code=n.toUpperCase(),i}var ph=new RegExp("^-?(0*)\\d{1,10}$"),_h=-2147483648,mh=2147483647,xa=function(n){if(ph.test(n)){let t=Number(n);if(t>=_h&&t<=mh)return t}return null},Nt=function(n){try{n()}catch(t){setTimeout(()=>{let e=t.stack||"";throw G("Exception was thrown by user callback.",e),t},Math.floor(0))}},gh=function(){return(typeof window=="object"&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0},nn=function(n,t){let e=setTimeout(n,t);return typeof e=="number"&&typeof Deno<"u"&&Deno.unrefTimer?Deno.unrefTimer(e):typeof e=="object"&&e.unref&&e.unref(),e};var Ss=class{constructor(t,e){this.appCheckProvider=e,this.appName=t.name,ba(t)&&t.settings.appCheckToken&&(this.serverAppAppCheckToken=t.settings.appCheckToken),this.appCheck=e?.getImmediate({optional:!0}),this.appCheck||e?.get().then(i=>this.appCheck=i)}getToken(t){if(this.serverAppAppCheckToken){if(t)throw new Error("Attempted reuse of `FirebaseServerApp.appCheckToken` after previous usage failed.");return Promise.resolve({token:this.serverAppAppCheckToken})}return this.appCheck?this.appCheck.getToken(t):new Promise((e,i)=>{setTimeout(()=>{this.appCheck?this.getToken(t).then(e,i):e(null)},0)})}addTokenChangeListener(t){var e;(e=this.appCheckProvider)===null||e===void 0||e.get().then(i=>i.addTokenListener(t))}notifyForInvalidToken(){G(`Provided AppCheck credentials for the app named "${this.appName}" are invalid. This usually indicates your app was not initialized correctly.`)}};var Ts=class{constructor(t,e,i){this.appName_=t,this.firebaseOptions_=e,this.authProvider_=i,this.auth_=null,this.auth_=i.getImmediate({optional:!0}),this.auth_||i.onInit(s=>this.auth_=s)}getToken(t){return this.auth_?this.auth_.getToken(t).catch(e=>e&&e.code==="auth/token-not-initialized"?(H("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(e)):new Promise((e,i)=>{setTimeout(()=>{this.auth_?this.getToken(t).then(e,i):e(null)},0)})}addTokenChangeListener(t){this.auth_?this.auth_.addAuthTokenListener(t):this.authProvider_.get().then(e=>e.addAuthTokenListener(t))}removeTokenChangeListener(t){this.authProvider_.get().then(e=>e.removeAuthTokenListener(t))}notifyForInvalidToken(){let t='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?t+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?t+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':t+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',G(t)}},sn=(()=>{class n{constructor(e){this.accessToken=e}getToken(e){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(e){e(this.accessToken)}removeTokenChangeListener(e){}notifyForInvalidToken(){}}n.OWNER="owner";return n})(),Xn="5",cl="v",dl="s",hl="r",ul="f",fl=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,pl="ls",_l="p",Ds="ac",ml="websocket",gl="long_polling";var Jn=class{constructor(t,e,i,s,r=!1,o="",a=!1,l=!1){this.secure=e,this.namespace=i,this.webSocketOnly=s,this.nodeAdmin=r,this.persistenceKey=o,this.includeNamespaceInQueryParams=a,this.isUsingEmulator=l,this._host=t.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=Ze.get("host:"+t)||this._host}isCacheableHost(){return this.internalHost.substr(0,2)==="s-"}isCustomHost(){return this._domain!=="firebaseio.com"&&this._domain!=="firebaseio-demo.com"}get host(){return this._host}set host(t){t!==this.internalHost&&(this.internalHost=t,this.isCacheableHost()&&Ze.set("host:"+this._host,this.internalHost))}toString(){let t=this.toURLString();return this.persistenceKey&&(t+="<"+this.persistenceKey+">"),t}toURLString(){let t=this.secure?"https://":"http://",e=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${t}${this.host}/${e}`}};function yh(n){return n.host!==n.internalHost||n.isCustomHost()||n.includeNamespaceInQueryParams}function yl(n,t,e){f(typeof t=="string","typeof type must == string"),f(typeof e=="object","typeof params must == object");let i;if(t===ml)i=(n.secure?"wss://":"ws://")+n.internalHost+"/.ws?";else if(t===gl)i=(n.secure?"https://":"http://")+n.internalHost+"/.lp?";else throw new Error("Unknown connection type: "+t);yh(n)&&(e.ns=n.namespace);let s=[];return W(e,(r,o)=>{s.push(r+"="+o)}),i+s.join("&")}var Rs=class{constructor(){this.counters_={}}incrementCounter(t,e=1){le(this.counters_,t)||(this.counters_[t]=0),this.counters_[t]+=e}get(){return Ko(this.counters_)}};var fs={},ps={};function yr(n){let t=n.toString();return fs[t]||(fs[t]=new Rs),fs[t]}function vh(n,t){let e=n.toString();return ps[e]||(ps[e]=t()),ps[e]}var Is=class{constructor(t){this.onMessage_=t,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(t,e){this.closeAfterResponse=t,this.onClose=e,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(t,e){for(this.pendingResponses[t]=e;this.pendingResponses[this.currentResponseNum];){let i=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let s=0;s<i.length;++s)i[s]&&Nt(()=>{this.onMessage_(i[s])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}};var Na="start",wh="close",Ch="pLPCommand",bh="pRTLPCB",vl="id",wl="pw",Cl="ser",Eh="cb",Sh="seg",Th="ts",Dh="d",Rh="dframe",bl=1870,El=30,Ih=bl-El,kh=25e3,xh=3e4,ks=class n{constructor(t,e,i,s,r,o,a){this.connId=t,this.repoInfo=e,this.applicationId=i,this.appCheckToken=s,this.authToken=r,this.transportSessionId=o,this.lastSessionId=a,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=wn(t),this.stats_=yr(e),this.urlFn=l=>(this.appCheckToken&&(l[Ds]=this.appCheckToken),yl(e,gl,l))}open(t,e){this.curSegmentNum=0,this.onDisconnect_=e,this.myPacketOrderer=new Is(t),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(xh)),ch(()=>{if(this.isClosed_)return;this.scriptTagHolder=new xs((...r)=>{let[o,a,l,c,h]=r;if(this.incrementIncomingBytes_(r),!!this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,o===Na)this.id=a,this.password=l;else if(o===wh)a?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(a,()=>{this.onClosed_()})):this.onClosed_();else throw new Error("Unrecognized command received: "+o)},(...r)=>{let[o,a]=r;this.incrementIncomingBytes_(r),this.myPacketOrderer.handleResponse(o,a)},()=>{this.onClosed_()},this.urlFn);let i={};i[Na]="t",i[Cl]=Math.floor(Math.random()*1e8),this.scriptTagHolder.uniqueCallbackIdentifier&&(i[Eh]=this.scriptTagHolder.uniqueCallbackIdentifier),i[cl]=Xn,this.transportSessionId&&(i[dl]=this.transportSessionId),this.lastSessionId&&(i[pl]=this.lastSessionId),this.applicationId&&(i[_l]=this.applicationId),this.appCheckToken&&(i[Ds]=this.appCheckToken),typeof location<"u"&&location.hostname&&fl.test(location.hostname)&&(i[hl]=ul);let s=this.urlFn(i);this.log_("Connecting via long-poll to "+s),this.scriptTagHolder.addTag(s,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){n.forceAllow_=!0}static forceDisallow(){n.forceDisallow_=!0}static isAvailable(){return fe()?!1:n.forceAllow_?!0:!n.forceDisallow_&&typeof document<"u"&&document.createElement!=null&&!hh()&&!uh()}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(t){let e=F(t);this.bytesSent+=e.length,this.stats_.incrementCounter("bytes_sent",e.length);let i=qi(e),s=al(i,Ih);for(let r=0;r<s.length;r++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,s.length,s[r]),this.curSegmentNum++}addDisconnectPingFrame(t,e){if(fe())return;this.myDisconnFrame=document.createElement("iframe");let i={};i[Rh]="t",i[vl]=t,i[wl]=e,this.myDisconnFrame.src=this.urlFn(i),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(t){let e=F(t).length;this.bytesReceived+=e,this.stats_.incrementCounter("bytes_received",e)}},xs=class n{constructor(t,e,i,s){if(this.onDisconnect=i,this.urlFn=s,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(Math.random()*1e8),this.sendNewPolls=!0,fe())this.commandCB=t,this.onMessageCB=e;else{this.uniqueCallbackIdentifier=oh(),window[Ch+this.uniqueCallbackIdentifier]=t,window[bh+this.uniqueCallbackIdentifier]=e,this.myIFrame=n.createIFrame_();let r="";this.myIFrame.src&&this.myIFrame.src.substr(0,11)==="javascript:"&&(r='<script>document.domain="'+document.domain+'";<\/script>');let o="<html><body>"+r+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(o),this.myIFrame.doc.close()}catch(a){H("frame writing exception"),a.stack&&H(a.stack),H(a)}}}static createIFrame_(){let t=document.createElement("iframe");if(t.style.display="none",document.body){document.body.appendChild(t);try{t.contentWindow.document||H("No IE domain setting required")}catch{let i=document.domain;t.src="javascript:void((function(){document.open();document.domain='"+i+"';document.close();})())"}}else throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";return t.contentDocument?t.doc=t.contentDocument:t.contentWindow?t.doc=t.contentWindow.document:t.document&&(t.doc=t.document),t}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{this.myIFrame!==null&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));let t=this.onDisconnect;t&&(this.onDisconnect=null,t())}startLongPoll(t,e){for(this.myID=t,this.myPW=e,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;let t={};t[vl]=this.myID,t[wl]=this.myPW,t[Cl]=this.currentSerial;let e=this.urlFn(t),i="",s=0;for(;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+El+i.length<=bl;){let o=this.pendingSegs.shift();i=i+"&"+Sh+s+"="+o.seg+"&"+Th+s+"="+o.ts+"&"+Dh+s+"="+o.d,s++}return e=e+i,this.addLongPollTag_(e,this.currentSerial),!0}else return!1}enqueueSegment(t,e,i){this.pendingSegs.push({seg:t,ts:e,d:i}),this.alive&&this.newRequest_()}addLongPollTag_(t,e){this.outstandingRequests.add(e);let i=()=>{this.outstandingRequests.delete(e),this.newRequest_()},s=setTimeout(i,Math.floor(kh)),r=()=>{clearTimeout(s),i()};this.addTag(t,r)}addTag(t,e){fe()?this.doNodeLongPoll(t,e):setTimeout(()=>{try{if(!this.sendNewPolls)return;let i=this.myIFrame.doc.createElement("script");i.type="text/javascript",i.async=!0,i.src=t,i.onload=i.onreadystatechange=function(){let s=i.readyState;(!s||s==="loaded"||s==="complete")&&(i.onload=i.onreadystatechange=null,i.parentNode&&i.parentNode.removeChild(i),e())},i.onerror=()=>{H("Long-poll script failed to load: "+t),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(i)}catch{}},Math.floor(1))}};var Nh=16384,Ph=45e3,Zn=null;typeof MozWebSocket<"u"?Zn=MozWebSocket:typeof WebSocket<"u"&&(Zn=WebSocket);var Jt=(()=>{class n{constructor(e,i,s,r,o,a,l){this.connId=e,this.applicationId=s,this.appCheckToken=r,this.authToken=o,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=wn(this.connId),this.stats_=yr(i),this.connURL=n.connectionURL_(i,a,l,r,s),this.nodeAdmin=i.nodeAdmin}static connectionURL_(e,i,s,r,o){let a={};return a[cl]=Xn,!fe()&&typeof location<"u"&&location.hostname&&fl.test(location.hostname)&&(a[hl]=ul),i&&(a[dl]=i),s&&(a[pl]=s),r&&(a[Ds]=r),o&&(a[_l]=o),yl(e,ml,a)}open(e,i){this.onDisconnect=i,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,Ze.set("previous_websocket_failure",!0);try{let s;if(fe()){let r=this.nodeAdmin?"AdminNode":"Node";s={headers:{"User-Agent":`Firebase/${Xn}/${_r}/${process.platform}/${r}`,"X-Firebase-GMPID":this.applicationId||""}},this.authToken&&(s.headers.Authorization=`Bearer ${this.authToken}`),this.appCheckToken&&(s.headers["X-Firebase-AppCheck"]=this.appCheckToken);let o=process.env,a=this.connURL.indexOf("wss://")===0?o.HTTPS_PROXY||o.https_proxy:o.HTTP_PROXY||o.http_proxy;a&&(s.proxy={origin:a})}this.mySock=new Zn(this.connURL,[],s)}catch(s){this.log_("Error instantiating WebSocket.");let r=s.message||s.data;r&&this.log_(r),this.onClosed_();return}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=s=>{this.handleIncomingFrame(s)},this.mySock.onerror=s=>{this.log_("WebSocket error.  Closing connection.");let r=s.message||s.data;r&&this.log_(r),this.onClosed_()}}start(){}static forceDisallow(){n.forceDisallow_=!0}static isAvailable(){let e=!1;if(typeof navigator<"u"&&navigator.userAgent){let i=/Android ([0-9]{0,}\.[0-9]{0,})/,s=navigator.userAgent.match(i);s&&s.length>1&&parseFloat(s[1])<4.4&&(e=!0)}return!e&&Zn!==null&&!n.forceDisallow_}static previouslyFailed(){return Ze.isInMemoryStorage||Ze.get("previous_websocket_failure")===!0}markConnectionHealthy(){Ze.remove("previous_websocket_failure")}appendFrame_(e){if(this.frames.push(e),this.frames.length===this.totalFrames){let i=this.frames.join("");this.frames=null;let s=mt(i);this.onMessage(s)}}handleNewFrameCount_(e){this.totalFrames=e,this.frames=[]}extractFrameCount_(e){if(f(this.frames===null,"We already have a frame buffer"),e.length<=6){let i=Number(e);if(!isNaN(i))return this.handleNewFrameCount_(i),null}return this.handleNewFrameCount_(1),e}handleIncomingFrame(e){if(this.mySock===null)return;let i=e.data;if(this.bytesReceived+=i.length,this.stats_.incrementCounter("bytes_received",i.length),this.resetKeepAlive(),this.frames!==null)this.appendFrame_(i);else{let s=this.extractFrameCount_(i);s!==null&&this.appendFrame_(s)}}send(e){this.resetKeepAlive();let i=F(e);this.bytesSent+=i.length,this.stats_.incrementCounter("bytes_sent",i.length);let s=al(i,Nh);s.length>1&&this.sendString_(String(s.length));for(let r=0;r<s.length;r++)this.sendString_(s[r])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(Ph))}sendString_(e){try{this.mySock.send(e)}catch(i){this.log_("Exception thrown from WebSocket.send():",i.message||i.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}n.responsesRequiredToBeHealthy=2,n.healthyTimeout=3e4;return n})(),Ah=(()=>{class n{static get ALL_TRANSPORTS(){return[ks,Jt]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}constructor(e){this.initTransports_(e)}initTransports_(e){let i=Jt&&Jt.isAvailable(),s=i&&!Jt.previouslyFailed();if(e.webSocketOnly&&(i||G("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),s=!0),s)this.transports_=[Jt];else{let r=this.transports_=[];for(let o of n.ALL_TRANSPORTS)o&&o.isAvailable()&&r.push(o);n.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}n.globalTransportInitialized_=!1;return n})(),Oh=6e4,Mh=5e3,Fh=10*1024,Lh=100*1024,_s="t",Pa="d",Bh="s",Aa="r",zh="e",Oa="o",Ma="a",Fa="n",La="p",Hh="h",Ns=class{constructor(t,e,i,s,r,o,a,l,c,h){this.id=t,this.repoInfo_=e,this.applicationId_=i,this.appCheckToken_=s,this.authToken_=r,this.onMessage_=o,this.onReady_=a,this.onDisconnect_=l,this.onKill_=c,this.lastSessionId=h,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=wn("c:"+this.id+":"),this.transportManager_=new Ah(e),this.log_("Connection created"),this.start_()}start_(){let t=this.transportManager_.initialTransport();this.conn_=new t(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=t.responsesRequiredToBeHealthy||0;let e=this.connReceiver_(this.conn_),i=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(e,i)},Math.floor(0));let s=t.healthyTimeout||0;s>0&&(this.healthyTimeout_=nn(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>Lh?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>Fh?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(s)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(t){return e=>{t===this.conn_?this.onConnectionLost_(e):t===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(t){return e=>{this.state_!==2&&(t===this.rx_?this.onPrimaryMessageReceived_(e):t===this.secondaryConn_?this.onSecondaryMessageReceived_(e):this.log_("message on old connection"))}}sendRequest(t){let e={t:"d",d:t};this.sendData_(e)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(t){if(_s in t){let e=t[_s];e===Ma?this.upgradeIfSecondaryHealthy_():e===Aa?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):e===Oa&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(t){let e=Xt("t",t),i=Xt("d",t);if(e==="c")this.onSecondaryControl_(i);else if(e==="d")this.pendingDataMessages.push(i);else throw new Error("Unknown protocol layer: "+e)}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:La,d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:Ma,d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:Fa,d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(t){let e=Xt("t",t),i=Xt("d",t);e==="c"?this.onControl_(i):e==="d"&&this.onDataMessage_(i)}onDataMessage_(t){this.onPrimaryResponse_(),this.onMessage_(t)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(t){let e=Xt(_s,t);if(Pa in t){let i=t[Pa];if(e===Hh){let s=Object.assign({},i);this.repoInfo_.isUsingEmulator&&(s.h=this.repoInfo_.host),this.onHandshake_(s)}else if(e===Fa){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let s=0;s<this.pendingDataMessages.length;++s)this.onDataMessage_(this.pendingDataMessages[s]);this.pendingDataMessages=[],this.tryCleanupConnection()}else e===Bh?this.onConnectionShutdown_(i):e===Aa?this.onReset_(i):e===zh?Es("Server Error: "+i):e===Oa?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):Es("Unknown control packet command: "+e)}}onHandshake_(t){let e=t.ts,i=t.v,s=t.h;this.sessionId=t.s,this.repoInfo_.host=s,this.state_===0&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,e),Xn!==i&&G("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){let t=this.transportManager_.upgradeTransport();t&&this.startUpgrade_(t)}startUpgrade_(t){this.secondaryConn_=new t(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=t.responsesRequiredToBeHealthy||0;let e=this.connReceiver_(this.secondaryConn_),i=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(e,i),nn(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(Oh))}onReset_(t){this.log_("Reset packet received.  New host: "+t),this.repoInfo_.host=t,this.state_===1?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(t,e){this.log_("Realtime connection established."),this.conn_=t,this.state_=1,this.onReady_&&(this.onReady_(e,this.sessionId),this.onReady_=null),this.primaryResponsesRequired_===0?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):nn(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(Mh))}sendPingOnPrimaryIfNecessary_(){!this.isHealthy_&&this.state_===1&&(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:La,d:{}}}))}onSecondaryConnectionLost_(){let t=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===t||this.rx_===t)&&this.close()}onConnectionLost_(t){this.conn_=null,!t&&this.state_===0?(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(Ze.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)):this.state_===1&&this.log_("Realtime connection lost."),this.close()}onConnectionShutdown_(t){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(t),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(t){if(this.state_!==1)throw"Connection is not connected";this.tx_.send(t)}close(){this.state_!==2&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}};var ei=class{put(t,e,i,s){}merge(t,e,i,s){}refreshAuthToken(t){}refreshAppCheckToken(t){}onDisconnectPut(t,e,i){}onDisconnectMerge(t,e,i){}onDisconnectCancel(t,e){}reportStats(t){}};var ti=class{constructor(t){this.allowedEvents_=t,this.listeners_={},f(Array.isArray(t)&&t.length>0,"Requires a non-empty array")}trigger(t,...e){if(Array.isArray(this.listeners_[t])){let i=[...this.listeners_[t]];for(let s=0;s<i.length;s++)i[s].callback.apply(i[s].context,e)}}on(t,e,i){this.validateEventType_(t),this.listeners_[t]=this.listeners_[t]||[],this.listeners_[t].push({callback:e,context:i});let s=this.getInitialEvent(t);s&&e.apply(i,s)}off(t,e,i){this.validateEventType_(t);let s=this.listeners_[t]||[];for(let r=0;r<s.length;r++)if(s[r].callback===e&&(!i||i===s[r].context)){s.splice(r,1);return}}validateEventType_(t){f(this.allowedEvents_.find(e=>e===t),"Unknown event: "+t)}};var ni=class n extends ti{static getInstance(){return new n}constructor(){super(["online"]),this.online_=!0,typeof window<"u"&&typeof window.addEventListener<"u"&&!Xi()&&(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}getInitialEvent(t){return f(t==="online","Unknown event type: "+t),[this.online_]}currentlyOnline(){return this.online_}};var Ba=32,za=768,D=class{constructor(t,e){if(e===void 0){this.pieces_=t.split("/");let i=0;for(let s=0;s<this.pieces_.length;s++)this.pieces_[s].length>0&&(this.pieces_[i]=this.pieces_[s],i++);this.pieces_.length=i,this.pieceNum_=0}else this.pieces_=t,this.pieceNum_=e}toString(){let t="";for(let e=this.pieceNum_;e<this.pieces_.length;e++)this.pieces_[e]!==""&&(t+="/"+this.pieces_[e]);return t||"/"}};function S(){return new D("")}function v(n){return n.pieceNum_>=n.pieces_.length?null:n.pieces_[n.pieceNum_]}function ze(n){return n.pieces_.length-n.pieceNum_}function x(n){let t=n.pieceNum_;return t<n.pieces_.length&&t++,new D(n.pieces_,t)}function vr(n){return n.pieceNum_<n.pieces_.length?n.pieces_[n.pieces_.length-1]:null}function Wh(n){let t="";for(let e=n.pieceNum_;e<n.pieces_.length;e++)n.pieces_[e]!==""&&(t+="/"+encodeURIComponent(String(n.pieces_[e])));return t||"/"}function ln(n,t=0){return n.pieces_.slice(n.pieceNum_+t)}function Sl(n){if(n.pieceNum_>=n.pieces_.length)return null;let t=[];for(let e=n.pieceNum_;e<n.pieces_.length-1;e++)t.push(n.pieces_[e]);return new D(t,0)}function N(n,t){let e=[];for(let i=n.pieceNum_;i<n.pieces_.length;i++)e.push(n.pieces_[i]);if(t instanceof D)for(let i=t.pieceNum_;i<t.pieces_.length;i++)e.push(t.pieces_[i]);else{let i=t.split("/");for(let s=0;s<i.length;s++)i[s].length>0&&e.push(i[s])}return new D(e,0)}function b(n){return n.pieceNum_>=n.pieces_.length}function $(n,t){let e=v(n),i=v(t);if(e===null)return t;if(e===i)return $(x(n),x(t));throw new Error("INTERNAL ERROR: innerPath ("+t+") is not within outerPath ("+n+")")}function Uh(n,t){let e=ln(n,0),i=ln(t,0);for(let s=0;s<e.length&&s<i.length;s++){let r=it(e[s],i[s]);if(r!==0)return r}return e.length===i.length?0:e.length<i.length?-1:1}function wr(n,t){if(ze(n)!==ze(t))return!1;for(let e=n.pieceNum_,i=t.pieceNum_;e<=n.pieces_.length;e++,i++)if(n.pieces_[e]!==t.pieces_[i])return!1;return!0}function te(n,t){let e=n.pieceNum_,i=t.pieceNum_;if(ze(n)>ze(t))return!1;for(;e<n.pieces_.length;){if(n.pieces_[e]!==t.pieces_[i])return!1;++e,++i}return!0}var Ps=class{constructor(t,e){this.errorPrefix_=e,this.parts_=ln(t,0),this.byteLength_=Math.max(1,this.parts_.length);for(let i=0;i<this.parts_.length;i++)this.byteLength_+=Qt(this.parts_[i]);Tl(this)}};function Vh(n,t){n.parts_.length>0&&(n.byteLength_+=1),n.parts_.push(t),n.byteLength_+=Qt(t),Tl(n)}function jh(n){let t=n.parts_.pop();n.byteLength_-=Qt(t),n.parts_.length>0&&(n.byteLength_-=1)}function Tl(n){if(n.byteLength_>za)throw new Error(n.errorPrefix_+"has a key path longer than "+za+" bytes ("+n.byteLength_+").");if(n.parts_.length>Ba)throw new Error(n.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+Ba+") or object contains a cycle "+Je(n))}function Je(n){return n.parts_.length===0?"":"in property '"+n.parts_.join(".")+"'"}var As=class n extends ti{static getInstance(){return new n}constructor(){super(["visible"]);let t,e;typeof document<"u"&&typeof document.addEventListener<"u"&&(typeof document.hidden<"u"?(e="visibilitychange",t="hidden"):typeof document.mozHidden<"u"?(e="mozvisibilitychange",t="mozHidden"):typeof document.msHidden<"u"?(e="msvisibilitychange",t="msHidden"):typeof document.webkitHidden<"u"&&(e="webkitvisibilitychange",t="webkitHidden")),this.visible_=!0,e&&document.addEventListener(e,()=>{let i=!document[t];i!==this.visible_&&(this.visible_=i,this.trigger("visible",i))},!1)}getInitialEvent(t){return f(t==="visible","Unknown event type: "+t),[this.visible_]}};var Zt=1e3,$h=60*5*1e3,Ha=30*1e3,Gh=1.3,Qh=3e4,Yh="server_kill",Wa=3,Cr=(()=>{class n extends ei{constructor(e,i,s,r,o,a,l,c){if(super(),this.repoInfo_=e,this.applicationId_=i,this.onDataUpdate_=s,this.onConnectStatus_=r,this.onServerInfoUpdate_=o,this.authTokenProvider_=a,this.appCheckTokenProvider_=l,this.authOverride_=c,this.id=n.nextPersistentConnectionId_++,this.log_=wn("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=Zt,this.maxReconnectDelay_=$h,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,c&&!fe())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");As.getInstance().on("visible",this.onVisible_,this),e.host.indexOf("fblocal")===-1&&ni.getInstance().on("online",this.onOnline_,this)}sendRequest(e,i,s){let r=++this.requestNumber_,o={r,a:e,b:i};this.log_(F(o)),f(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(o),s&&(this.requestCBHash_[r]=s)}get(e){this.initConnection_();let i=new Ee,r={action:"g",request:{p:e._path.toString(),q:e._queryObject},onComplete:a=>{let l=a.d;a.s==="ok"?i.resolve(l):i.reject(l)}};this.outstandingGets_.push(r),this.outstandingGetCount_++;let o=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(o),i.promise}listen(e,i,s,r){this.initConnection_();let o=e._queryIdentifier,a=e._path.toString();this.log_("Listen called for "+a+" "+o),this.listens.has(a)||this.listens.set(a,new Map),f(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"listen() called for non-default but complete query"),f(!this.listens.get(a).has(o),"listen() called twice for same path/queryId.");let l={onComplete:r,hashFn:i,query:e,tag:s};this.listens.get(a).set(o,l),this.connected_&&this.sendListen_(l)}sendGet_(e){let i=this.outstandingGets_[e];this.sendRequest("g",i.request,s=>{delete this.outstandingGets_[e],this.outstandingGetCount_--,this.outstandingGetCount_===0&&(this.outstandingGets_=[]),i.onComplete&&i.onComplete(s)})}sendListen_(e){let i=e.query,s=i._path.toString(),r=i._queryIdentifier;this.log_("Listen on "+s+" for "+r);let o={p:s},a="q";e.tag&&(o.q=i._queryObject,o.t=e.tag),o.h=e.hashFn(),this.sendRequest(a,o,l=>{let c=l.d,h=l.s;n.warnOnListenWarnings_(c,i),(this.listens.get(s)&&this.listens.get(s).get(r))===e&&(this.log_("listen response",l),h!=="ok"&&this.removeListen_(s,r),e.onComplete&&e.onComplete(h,c))})}static warnOnListenWarnings_(e,i){if(e&&typeof e=="object"&&le(e,"w")){let s=Ke(e,"w");if(Array.isArray(s)&&~s.indexOf("no_index")){let r='".indexOn": "'+i._queryParams.getIndex().toString()+'"',o=i._path.toString();G(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${r} at ${o} to your security rules for better performance.`)}}}refreshAuthToken(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(e)}reduceReconnectDelayIfAdminCredential_(e){(e&&e.length===40||oa(e))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=Ha)}refreshAppCheckToken(e){this.appCheckToken_=e,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){let e=this.authToken_,i=ra(e)?"auth":"gauth",s={cred:e};this.authOverride_===null?s.noauth=!0:typeof this.authOverride_=="object"&&(s.authvar=this.authOverride_),this.sendRequest(i,s,r=>{let o=r.s,a=r.d||"error";this.authToken_===e&&(o==="ok"?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(o,a))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},e=>{let i=e.s,s=e.d||"error";i==="ok"?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(i,s)})}unlisten(e,i){let s=e._path.toString(),r=e._queryIdentifier;this.log_("Unlisten called for "+s+" "+r),f(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(s,r)&&this.connected_&&this.sendUnlisten_(s,r,e._queryObject,i)}sendUnlisten_(e,i,s,r){this.log_("Unlisten on "+e+" for "+i);let o={p:e},a="n";r&&(o.q=s,o.t=r),this.sendRequest(a,o)}onDisconnectPut(e,i,s){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",e,i,s):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:i,onComplete:s})}onDisconnectMerge(e,i,s){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",e,i,s):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:i,onComplete:s})}onDisconnectCancel(e,i){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",e,null,i):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:i})}sendOnDisconnect_(e,i,s,r){let o={p:i,d:s};this.log_("onDisconnect "+e,o),this.sendRequest(e,o,a=>{r&&setTimeout(()=>{r(a.s,a.d)},Math.floor(0))})}put(e,i,s,r){this.putInternal("p",e,i,s,r)}merge(e,i,s,r){this.putInternal("m",e,i,s,r)}putInternal(e,i,s,r,o){this.initConnection_();let a={p:i,d:s};o!==void 0&&(a.h=o),this.outstandingPuts_.push({action:e,request:a,onComplete:r}),this.outstandingPutCount_++;let l=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(l):this.log_("Buffering put: "+i)}sendPut_(e){let i=this.outstandingPuts_[e].action,s=this.outstandingPuts_[e].request,r=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(i,s,o=>{this.log_(i+" response",o),delete this.outstandingPuts_[e],this.outstandingPutCount_--,this.outstandingPutCount_===0&&(this.outstandingPuts_=[]),r&&r(o.s,o.d)})}reportStats(e){if(this.connected_){let i={c:e};this.log_("reportStats",i),this.sendRequest("s",i,s=>{if(s.s!=="ok"){let o=s.d;this.log_("reportStats","Error sending stats: "+o)}})}}onDataMessage_(e){if("r"in e){this.log_("from server: "+F(e));let i=e.r,s=this.requestCBHash_[i];s&&(delete this.requestCBHash_[i],s(e.b))}else{if("error"in e)throw"A server-side error has occurred: "+e.error;"a"in e&&this.onDataPush_(e.a,e.b)}}onDataPush_(e,i){this.log_("handleServerMessage",e,i),e==="d"?this.onDataUpdate_(i.p,i.d,!1,i.t):e==="m"?this.onDataUpdate_(i.p,i.d,!0,i.t):e==="c"?this.onListenRevoked_(i.p,i.q):e==="ac"?this.onAuthRevoked_(i.s,i.d):e==="apc"?this.onAppCheckRevoked_(i.s,i.d):e==="sd"?this.onSecurityDebugPacket_(i):Es("Unrecognized action received from server: "+F(e)+`
Are you using the latest client?`)}onReady_(e,i){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=new Date().getTime(),this.handleTimestamp_(e),this.lastSessionId=i,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(e){f(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(e))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=Zt,this.realtime_||this.scheduleConnect_(0)),this.visible_=e}onOnline_(e){e?(this.log_("Browser went online."),this.reconnectDelay_=Zt,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(new Date().getTime()-this.lastConnectionEstablishedTime_>Qh&&(this.reconnectDelay_=Zt),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=new Date().getTime());let e=Math.max(0,new Date().getTime()-this.lastConnectionAttemptTime_),i=Math.max(0,this.reconnectDelay_-e);i=Math.random()*i,this.log_("Trying to reconnect in "+i+"ms"),this.scheduleConnect_(i),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,this.reconnectDelay_*Gh)}this.onConnectStatus_(!1)}establishConnection_(){return V(this,null,function*(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=new Date().getTime(),this.lastConnectionEstablishedTime_=null;let e=this.onDataMessage_.bind(this),i=this.onReady_.bind(this),s=this.onRealtimeDisconnect_.bind(this),r=this.id+":"+n.nextConnectionId_++,o=this.lastSessionId,a=!1,l=null,c=function(){l?l.close():(a=!0,s())},h=function(u){f(l,"sendRequest call when we're not connected not allowed."),l.sendRequest(u)};this.realtime_={close:c,sendRequest:h};let d=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{let[u,p]=yield Promise.all([this.authTokenProvider_.getToken(d),this.appCheckTokenProvider_.getToken(d)]);a?H("getToken() completed but was canceled"):(H("getToken() completed. Creating connection."),this.authToken_=u&&u.accessToken,this.appCheckToken_=p&&p.token,l=new Ns(r,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,e,i,s,m=>{G(m+" ("+this.repoInfo_.toString()+")"),this.interrupt(Yh)},o))}catch(u){this.log_("Failed to get token: "+u),a||(this.repoInfo_.nodeAdmin&&G(u),c())}}})}interrupt(e){H("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(e){H("Resuming connection for reason: "+e),delete this.interruptReasons_[e],Ji(this.interruptReasons_)&&(this.reconnectDelay_=Zt,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(e){let i=e-new Date().getTime();this.onServerInfoUpdate_({serverTimeOffset:i})}cancelSentTransactions_(){for(let e=0;e<this.outstandingPuts_.length;e++){let i=this.outstandingPuts_[e];i&&"h"in i.request&&i.queued&&(i.onComplete&&i.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}this.outstandingPutCount_===0&&(this.outstandingPuts_=[])}onListenRevoked_(e,i){let s;i?s=i.map(o=>gr(o)).join("$"):s="default";let r=this.removeListen_(e,s);r&&r.onComplete&&r.onComplete("permission_denied")}removeListen_(e,i){let s=new D(e).toString(),r;if(this.listens.has(s)){let o=this.listens.get(s);r=o.get(i),o.delete(i),o.size===0&&this.listens.delete(s)}else r=void 0;return r}onAuthRevoked_(e,i){H("Auth token revoked: "+e+"/"+i),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),(e==="invalid_token"||e==="permission_denied")&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=Wa&&(this.reconnectDelay_=Ha,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(e,i){H("App check token revoked: "+e+"/"+i),this.appCheckToken_=null,this.forceTokenRefresh_=!0,(e==="invalid_token"||e==="permission_denied")&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=Wa&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e.msg.replace(`
`,`
FIREBASE: `))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(let e of this.listens.values())for(let i of e.values())this.sendListen_(i);for(let e=0;e<this.outstandingPuts_.length;e++)this.outstandingPuts_[e]&&this.sendPut_(e);for(;this.onDisconnectRequestQueue_.length;){let e=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(e.action,e.pathString,e.data,e.onComplete)}for(let e=0;e<this.outstandingGets_.length;e++)this.outstandingGets_[e]&&this.sendGet_(e)}sendConnectStats_(){let e={},i="js";fe()&&(this.repoInfo_.nodeAdmin?i="admin_node":i="node"),e["sdk."+i+"."+_r.replace(/\./g,"-")]=1,Xi()?e["framework.cordova"]=1:ta()&&(e["framework.reactnative"]=1),this.reportStats(e)}shouldReconnect_(){let e=ni.getInstance().currentlyOnline();return Ji(this.interruptReasons_)&&e}}n.nextPersistentConnectionId_=0,n.nextConnectionId_=0;return n})(),w=class n{constructor(t,e){this.name=t,this.node=e}static Wrap(t,e){return new n(t,e)}};var Et=class{getCompare(){return this.compare.bind(this)}indexedValueChanged(t,e){let i=new w(bt,t),s=new w(bt,e);return this.compare(i,s)!==0}minPost(){return w.MIN}};var Kn,ii=class extends Et{static get __EMPTY_NODE(){return Kn}static set __EMPTY_NODE(t){Kn=t}compare(t,e){return it(t.name,e.name)}isDefinedOn(t){throw qe("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(t,e){return!1}minPost(){return w.MIN}maxPost(){return new w(tt,Kn)}makePost(t,e){return f(typeof t=="string","KeyIndex indexValue must always be a string."),new w(t,Kn)}toString(){return".key"}},Ct=new ii;var vt=class{constructor(t,e,i,s,r=null){this.isReverse_=s,this.resultGenerator_=r,this.nodeStack_=[];let o=1;for(;!t.isEmpty();)if(t=t,o=e?i(t.key,e):1,s&&(o*=-1),o<0)this.isReverse_?t=t.left:t=t.right;else if(o===0){this.nodeStack_.push(t);break}else this.nodeStack_.push(t),this.isReverse_?t=t.right:t=t.left}getNext(){if(this.nodeStack_.length===0)return null;let t=this.nodeStack_.pop(),e;if(this.resultGenerator_?e=this.resultGenerator_(t.key,t.value):e={key:t.key,value:t.value},this.isReverse_)for(t=t.left;!t.isEmpty();)this.nodeStack_.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack_.push(t),t=t.left;return e}hasNext(){return this.nodeStack_.length>0}peek(){if(this.nodeStack_.length===0)return null;let t=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(t.key,t.value):{key:t.key,value:t.value}}},ce=(()=>{class n{constructor(e,i,s,r,o){this.key=e,this.value=i,this.color=s??n.RED,this.left=r??ne.EMPTY_NODE,this.right=o??ne.EMPTY_NODE}copy(e,i,s,r,o){return new n(e??this.key,i??this.value,s??this.color,r??this.left,o??this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,i,s){let r=this,o=s(e,r.key);return o<0?r=r.copy(null,null,null,r.left.insert(e,i,s),null):o===0?r=r.copy(null,i,null,null,null):r=r.copy(null,null,null,null,r.right.insert(e,i,s)),r.fixUp_()}removeMin_(){if(this.left.isEmpty())return ne.EMPTY_NODE;let e=this;return!e.left.isRed_()&&!e.left.left.isRed_()&&(e=e.moveRedLeft_()),e=e.copy(null,null,null,e.left.removeMin_(),null),e.fixUp_()}remove(e,i){let s,r;if(s=this,i(e,s.key)<0)!s.left.isEmpty()&&!s.left.isRed_()&&!s.left.left.isRed_()&&(s=s.moveRedLeft_()),s=s.copy(null,null,null,s.left.remove(e,i),null);else{if(s.left.isRed_()&&(s=s.rotateRight_()),!s.right.isEmpty()&&!s.right.isRed_()&&!s.right.left.isRed_()&&(s=s.moveRedRight_()),i(e,s.key)===0){if(s.right.isEmpty())return ne.EMPTY_NODE;r=s.right.min_(),s=s.copy(r.key,r.value,null,null,s.right.removeMin_())}s=s.copy(null,null,null,null,s.right.remove(e,i))}return s.fixUp_()}isRed_(){return this.color}fixUp_(){let e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e}moveRedLeft_(){let e=this.colorFlip_();return e.right.left.isRed_()&&(e=e.copy(null,null,null,null,e.right.rotateRight_()),e=e.rotateLeft_(),e=e.colorFlip_()),e}moveRedRight_(){let e=this.colorFlip_();return e.left.left.isRed_()&&(e=e.rotateRight_(),e=e.colorFlip_()),e}rotateLeft_(){let e=this.copy(null,null,n.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight_(){let e=this.copy(null,null,n.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip_(){let e=this.left.copy(null,null,!this.left.color,null,null),i=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,i)}checkMaxDepth_(){let e=this.check_();return Math.pow(2,e)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");let e=this.left.check_();if(e!==this.right.check_())throw new Error("Black depths differ");return e+(this.isRed_()?0:1)}}return n.RED=!0,n.BLACK=!1,n})(),Os=class{copy(t,e,i,s,r){return this}insert(t,e,i){return new ce(t,e,null)}remove(t,e){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}},ne=class n{constructor(t,e=n.EMPTY_NODE){this.comparator_=t,this.root_=e}insert(t,e){return new n(this.comparator_,this.root_.insert(t,e,this.comparator_).copy(null,null,ce.BLACK,null,null))}remove(t){return new n(this.comparator_,this.root_.remove(t,this.comparator_).copy(null,null,ce.BLACK,null,null))}get(t){let e,i=this.root_;for(;!i.isEmpty();){if(e=this.comparator_(t,i.key),e===0)return i.value;e<0?i=i.left:e>0&&(i=i.right)}return null}getPredecessorKey(t){let e,i=this.root_,s=null;for(;!i.isEmpty();)if(e=this.comparator_(t,i.key),e===0){if(i.left.isEmpty())return s?s.key:null;for(i=i.left;!i.right.isEmpty();)i=i.right;return i.key}else e<0?i=i.left:e>0&&(s=i,i=i.right);throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(t){return this.root_.inorderTraversal(t)}reverseTraversal(t){return this.root_.reverseTraversal(t)}getIterator(t){return new vt(this.root_,null,this.comparator_,!1,t)}getIteratorFrom(t,e){return new vt(this.root_,t,this.comparator_,!1,e)}getReverseIteratorFrom(t,e){return new vt(this.root_,t,this.comparator_,!0,e)}getReverseIterator(t){return new vt(this.root_,null,this.comparator_,!0,t)}};ne.EMPTY_NODE=new Os;function qh(n,t){return it(n.name,t.name)}function br(n,t){return it(n,t)}var Ms;function Kh(n){Ms=n}var Dl=function(n){return typeof n=="number"?"number:"+ll(n):"string:"+n},Rl=function(n){if(n.isLeafNode()){let t=n.val();f(typeof t=="string"||typeof t=="number"||typeof t=="object"&&le(t,".sv"),"Priority must be a string or number.")}else f(n===Ms||n.isEmpty(),"priority of unexpected type.");f(n===Ms||n.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};var Ua,St=(()=>{class n{static set __childrenNodeConstructor(e){Ua=e}static get __childrenNodeConstructor(){return Ua}constructor(e,i=n.__childrenNodeConstructor.EMPTY_NODE){this.value_=e,this.priorityNode_=i,this.lazyHash_=null,f(this.value_!==void 0&&this.value_!==null,"LeafNode shouldn't be created with null/undefined value."),Rl(this.priorityNode_)}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(e){return new n(this.value_,e)}getImmediateChild(e){return e===".priority"?this.priorityNode_:n.__childrenNodeConstructor.EMPTY_NODE}getChild(e){return b(e)?this:v(e)===".priority"?this.priorityNode_:n.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(e,i){return null}updateImmediateChild(e,i){return e===".priority"?this.updatePriority(i):i.isEmpty()&&e!==".priority"?this:n.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,i).updatePriority(this.priorityNode_)}updateChild(e,i){let s=v(e);return s===null?i:i.isEmpty()&&s!==".priority"?this:(f(s!==".priority"||ze(e)===1,".priority must be the last token in a path"),this.updateImmediateChild(s,n.__childrenNodeConstructor.EMPTY_NODE.updateChild(x(e),i)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(e,i){return!1}val(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(this.lazyHash_===null){let e="";this.priorityNode_.isEmpty()||(e+="priority:"+Dl(this.priorityNode_.val())+":");let i=typeof this.value_;e+=i+":",i==="number"?e+=ll(this.value_):e+=this.value_,this.lazyHash_=ol(e)}return this.lazyHash_}getValue(){return this.value_}compareTo(e){return e===n.__childrenNodeConstructor.EMPTY_NODE?1:e instanceof n.__childrenNodeConstructor?-1:(f(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))}compareToLeafNode_(e){let i=typeof e.value_,s=typeof this.value_,r=n.VALUE_TYPE_ORDER.indexOf(i),o=n.VALUE_TYPE_ORDER.indexOf(s);return f(r>=0,"Unknown leaf type: "+i),f(o>=0,"Unknown leaf type: "+s),r===o?s==="object"?0:this.value_<e.value_?-1:this.value_===e.value_?0:1:o-r}withIndex(){return this}isIndexed(){return!0}equals(e){if(e===this)return!0;if(e.isLeafNode()){let i=e;return this.value_===i.value_&&this.priorityNode_.equals(i.priorityNode_)}else return!1}}n.VALUE_TYPE_ORDER=["object","boolean","number","string"];return n})(),Il,kl;function Xh(n){Il=n}function Jh(n){kl=n}var Fs=class extends Et{compare(t,e){let i=t.node.getPriority(),s=e.node.getPriority(),r=i.compareTo(s);return r===0?it(t.name,e.name):r}isDefinedOn(t){return!t.getPriority().isEmpty()}indexedValueChanged(t,e){return!t.getPriority().equals(e.getPriority())}minPost(){return w.MIN}maxPost(){return new w(tt,new St("[PRIORITY-POST]",kl))}makePost(t,e){let i=Il(t);return new w(e,new St("[PRIORITY-POST]",i))}toString(){return".priority"}},P=new Fs;var Zh=Math.log(2),Ls=class{constructor(t){let e=r=>parseInt(Math.log(r)/Zh,10),i=r=>parseInt(Array(r+1).join("1"),2);this.count=e(t+1),this.current_=this.count-1;let s=i(this.count);this.bits_=t+1&s}nextBitIsOne(){let t=!(this.bits_&1<<this.current_);return this.current_--,t}},si=function(n,t,e,i){n.sort(t);let s=function(l,c){let h=c-l,d,u;if(h===0)return null;if(h===1)return d=n[l],u=e?e(d):d,new ce(u,d.node,ce.BLACK,null,null);{let p=parseInt(h/2,10)+l,m=s(l,p),T=s(p+1,c);return d=n[p],u=e?e(d):d,new ce(u,d.node,ce.BLACK,m,T)}},r=function(l){let c=null,h=null,d=n.length,u=function(m,T){let R=d-m,O=d;d-=m;let We=s(R+1,O),zi=n[R],jc=e?e(zi):zi;p(new ce(jc,zi.node,T,null,We))},p=function(m){c?(c.left=m,c=m):(h=m,c=m)};for(let m=0;m<l.count;++m){let T=l.nextBitIsOne(),R=Math.pow(2,l.count-(m+1));T?u(R,ce.BLACK):(u(R,ce.BLACK),u(R,ce.RED))}return h},o=new Ls(n.length),a=r(o);return new ne(i||t,a)};var ms,yt={},Tt=class n{static get Default(){return f(yt&&P,"ChildrenNode.ts has not been loaded"),ms=ms||new n({".priority":yt},{".priority":P}),ms}constructor(t,e){this.indexes_=t,this.indexSet_=e}get(t){let e=Ke(this.indexes_,t);if(!e)throw new Error("No index defined for "+t);return e instanceof ne?e:null}hasIndex(t){return le(this.indexSet_,t.toString())}addIndex(t,e){f(t!==Ct,"KeyIndex always exists and isn't meant to be added to the IndexMap.");let i=[],s=!1,r=e.getIterator(w.Wrap),o=r.getNext();for(;o;)s=s||t.isDefinedOn(o.node),i.push(o),o=r.getNext();let a;s?a=si(i,t.getCompare()):a=yt;let l=t.toString(),c=Object.assign({},this.indexSet_);c[l]=t;let h=Object.assign({},this.indexes_);return h[l]=a,new n(h,c)}addToIndexes(t,e){let i=$t(this.indexes_,(s,r)=>{let o=Ke(this.indexSet_,r);if(f(o,"Missing index implementation for "+r),s===yt)if(o.isDefinedOn(t.node)){let a=[],l=e.getIterator(w.Wrap),c=l.getNext();for(;c;)c.name!==t.name&&a.push(c),c=l.getNext();return a.push(t),si(a,o.getCompare())}else return yt;else{let a=e.get(t.name),l=s;return a&&(l=l.remove(new w(t.name,a))),l.insert(t,t.node)}});return new n(i,this.indexSet_)}removeFromIndexes(t,e){let i=$t(this.indexes_,s=>{if(s===yt)return s;{let r=e.get(t.name);return r?s.remove(new w(t.name,r)):s}});return new n(i,this.indexSet_)}};var en,g=(()=>{class n{static get EMPTY_NODE(){return en||(en=new n(new ne(br),null,Tt.Default))}constructor(e,i,s){this.children_=e,this.priorityNode_=i,this.indexMap_=s,this.lazyHash_=null,this.priorityNode_&&Rl(this.priorityNode_),this.children_.isEmpty()&&f(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}isLeafNode(){return!1}getPriority(){return this.priorityNode_||en}updatePriority(e){return this.children_.isEmpty()?this:new n(this.children_,e,this.indexMap_)}getImmediateChild(e){if(e===".priority")return this.getPriority();{let i=this.children_.get(e);return i===null?en:i}}getChild(e){let i=v(e);return i===null?this:this.getImmediateChild(i).getChild(x(e))}hasChild(e){return this.children_.get(e)!==null}updateImmediateChild(e,i){if(f(i,"We should always be passing snapshot nodes"),e===".priority")return this.updatePriority(i);{let s=new w(e,i),r,o;i.isEmpty()?(r=this.children_.remove(e),o=this.indexMap_.removeFromIndexes(s,this.children_)):(r=this.children_.insert(e,i),o=this.indexMap_.addToIndexes(s,this.children_));let a=r.isEmpty()?en:this.priorityNode_;return new n(r,a,o)}}updateChild(e,i){let s=v(e);if(s===null)return i;{f(v(e)!==".priority"||ze(e)===1,".priority must be the last token in a path");let r=this.getImmediateChild(s).updateChild(x(e),i);return this.updateImmediateChild(s,r)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(e){if(this.isEmpty())return null;let i={},s=0,r=0,o=!0;if(this.forEachChild(P,(a,l)=>{i[a]=l.val(e),s++,o&&n.INTEGER_REGEXP_.test(a)?r=Math.max(r,Number(a)):o=!1}),!e&&o&&r<2*s){let a=[];for(let l in i)a[l]=i[l];return a}else return e&&!this.getPriority().isEmpty()&&(i[".priority"]=this.getPriority().val()),i}hash(){if(this.lazyHash_===null){let e="";this.getPriority().isEmpty()||(e+="priority:"+Dl(this.getPriority().val())+":"),this.forEachChild(P,(i,s)=>{let r=s.hash();r!==""&&(e+=":"+i+":"+r)}),this.lazyHash_=e===""?"":ol(e)}return this.lazyHash_}getPredecessorChildName(e,i,s){let r=this.resolveIndex_(s);if(r){let o=r.getPredecessorKey(new w(e,i));return o?o.name:null}else return this.children_.getPredecessorKey(e)}getFirstChildName(e){let i=this.resolveIndex_(e);if(i){let s=i.minKey();return s&&s.name}else return this.children_.minKey()}getFirstChild(e){let i=this.getFirstChildName(e);return i?new w(i,this.children_.get(i)):null}getLastChildName(e){let i=this.resolveIndex_(e);if(i){let s=i.maxKey();return s&&s.name}else return this.children_.maxKey()}getLastChild(e){let i=this.getLastChildName(e);return i?new w(i,this.children_.get(i)):null}forEachChild(e,i){let s=this.resolveIndex_(e);return s?s.inorderTraversal(r=>i(r.name,r.node)):this.children_.inorderTraversal(i)}getIterator(e){return this.getIteratorFrom(e.minPost(),e)}getIteratorFrom(e,i){let s=this.resolveIndex_(i);if(s)return s.getIteratorFrom(e,r=>r);{let r=this.children_.getIteratorFrom(e.name,w.Wrap),o=r.peek();for(;o!=null&&i.compare(o,e)<0;)r.getNext(),o=r.peek();return r}}getReverseIterator(e){return this.getReverseIteratorFrom(e.maxPost(),e)}getReverseIteratorFrom(e,i){let s=this.resolveIndex_(i);if(s)return s.getReverseIteratorFrom(e,r=>r);{let r=this.children_.getReverseIteratorFrom(e.name,w.Wrap),o=r.peek();for(;o!=null&&i.compare(o,e)>0;)r.getNext(),o=r.peek();return r}}compareTo(e){return this.isEmpty()?e.isEmpty()?0:-1:e.isLeafNode()||e.isEmpty()?1:e===Cn?-1:0}withIndex(e){if(e===Ct||this.indexMap_.hasIndex(e))return this;{let i=this.indexMap_.addIndex(e,this.children_);return new n(this.children_,this.priorityNode_,i)}}isIndexed(e){return e===Ct||this.indexMap_.hasIndex(e)}equals(e){if(e===this)return!0;if(e.isLeafNode())return!1;{let i=e;if(this.getPriority().equals(i.getPriority()))if(this.children_.count()===i.children_.count()){let s=this.getIterator(P),r=i.getIterator(P),o=s.getNext(),a=r.getNext();for(;o&&a;){if(o.name!==a.name||!o.node.equals(a.node))return!1;o=s.getNext(),a=r.getNext()}return o===null&&a===null}else return!1;else return!1}}resolveIndex_(e){return e===Ct?null:this.indexMap_.get(e.toString())}}return n.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/,n})(),Bs=class extends g{constructor(){super(new ne(br),g.EMPTY_NODE,Tt.Default)}compareTo(t){return t===this?0:1}equals(t){return t===this}getPriority(){return this}getImmediateChild(t){return g.EMPTY_NODE}isEmpty(){return!1}},Cn=new Bs;Object.defineProperties(w,{MIN:{value:new w(bt,g.EMPTY_NODE)},MAX:{value:new w(tt,Cn)}});ii.__EMPTY_NODE=g.EMPTY_NODE;St.__childrenNodeConstructor=g;Kh(Cn);Jh(Cn);var eu=!0;function L(n,t=null){if(n===null)return g.EMPTY_NODE;if(typeof n=="object"&&".priority"in n&&(t=n[".priority"]),f(t===null||typeof t=="string"||typeof t=="number"||typeof t=="object"&&".sv"in t,"Invalid priority type found: "+typeof t),typeof n=="object"&&".value"in n&&n[".value"]!==null&&(n=n[".value"]),typeof n!="object"||".sv"in n){let e=n;return new St(e,L(t))}if(!(n instanceof Array)&&eu){let e=[],i=!1;if(W(n,(o,a)=>{if(o.substring(0,1)!=="."){let l=L(a);l.isEmpty()||(i=i||!l.getPriority().isEmpty(),e.push(new w(o,l)))}}),e.length===0)return g.EMPTY_NODE;let r=si(e,qh,o=>o.name,br);if(i){let o=si(e,P.getCompare());return new g(r,L(t),new Tt({".priority":o},{".priority":P}))}else return new g(r,L(t),Tt.Default)}else{let e=g.EMPTY_NODE;return W(n,(i,s)=>{if(le(n,i)&&i.substring(0,1)!=="."){let r=L(s);(r.isLeafNode()||!r.isEmpty())&&(e=e.updateImmediateChild(i,r))}}),e.updatePriority(L(t))}}Xh(L);var zs=class extends Et{constructor(t){super(),this.indexPath_=t,f(!b(t)&&v(t)!==".priority","Can't create PathIndex with empty path or .priority key")}extractChild(t){return t.getChild(this.indexPath_)}isDefinedOn(t){return!t.getChild(this.indexPath_).isEmpty()}compare(t,e){let i=this.extractChild(t.node),s=this.extractChild(e.node),r=i.compareTo(s);return r===0?it(t.name,e.name):r}makePost(t,e){let i=L(t),s=g.EMPTY_NODE.updateChild(this.indexPath_,i);return new w(e,s)}maxPost(){let t=g.EMPTY_NODE.updateChild(this.indexPath_,Cn);return new w(tt,t)}toString(){return ln(this.indexPath_,0).join("/")}};var Hs=class extends Et{compare(t,e){let i=t.node.compareTo(e.node);return i===0?it(t.name,e.name):i}isDefinedOn(t){return!0}indexedValueChanged(t,e){return!t.equals(e)}minPost(){return w.MIN}maxPost(){return w.MAX}makePost(t,e){let i=L(t);return new w(e,i)}toString(){return".value"}},tu=new Hs;function xl(n){return{type:"value",snapshotNode:n}}function Dt(n,t){return{type:"child_added",snapshotNode:t,childName:n}}function cn(n,t){return{type:"child_removed",snapshotNode:t,childName:n}}function dn(n,t,e){return{type:"child_changed",snapshotNode:t,childName:n,oldSnap:e}}function nu(n,t){return{type:"child_moved",snapshotNode:t,childName:n}}var hn=class{constructor(t){this.index_=t}updateChild(t,e,i,s,r,o){f(t.isIndexed(this.index_),"A node must be indexed if only a child is updated");let a=t.getImmediateChild(e);return a.getChild(s).equals(i.getChild(s))&&a.isEmpty()===i.isEmpty()||(o!=null&&(i.isEmpty()?t.hasChild(e)?o.trackChildChange(cn(e,a)):f(t.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):a.isEmpty()?o.trackChildChange(Dt(e,i)):o.trackChildChange(dn(e,i,a))),t.isLeafNode()&&i.isEmpty())?t:t.updateImmediateChild(e,i).withIndex(this.index_)}updateFullNode(t,e,i){return i!=null&&(t.isLeafNode()||t.forEachChild(P,(s,r)=>{e.hasChild(s)||i.trackChildChange(cn(s,r))}),e.isLeafNode()||e.forEachChild(P,(s,r)=>{if(t.hasChild(s)){let o=t.getImmediateChild(s);o.equals(r)||i.trackChildChange(dn(s,r,o))}else i.trackChildChange(Dt(s,r))})),e.withIndex(this.index_)}updatePriority(t,e){return t.isEmpty()?g.EMPTY_NODE:t.updatePriority(e)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}};var ri=class n{constructor(t){this.indexedFilter_=new hn(t.getIndex()),this.index_=t.getIndex(),this.startPost_=n.getStartPost_(t),this.endPost_=n.getEndPost_(t),this.startIsInclusive_=!t.startAfterSet_,this.endIsInclusive_=!t.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(t){let e=this.startIsInclusive_?this.index_.compare(this.getStartPost(),t)<=0:this.index_.compare(this.getStartPost(),t)<0,i=this.endIsInclusive_?this.index_.compare(t,this.getEndPost())<=0:this.index_.compare(t,this.getEndPost())<0;return e&&i}updateChild(t,e,i,s,r,o){return this.matches(new w(e,i))||(i=g.EMPTY_NODE),this.indexedFilter_.updateChild(t,e,i,s,r,o)}updateFullNode(t,e,i){e.isLeafNode()&&(e=g.EMPTY_NODE);let s=e.withIndex(this.index_);s=s.updatePriority(g.EMPTY_NODE);let r=this;return e.forEachChild(P,(o,a)=>{r.matches(new w(o,a))||(s=s.updateImmediateChild(o,g.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(t,s,i)}updatePriority(t,e){return t}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(t){if(t.hasStart()){let e=t.getIndexStartName();return t.getIndex().makePost(t.getIndexStartValue(),e)}else return t.getIndex().minPost()}static getEndPost_(t){if(t.hasEnd()){let e=t.getIndexEndName();return t.getIndex().makePost(t.getIndexEndValue(),e)}else return t.getIndex().maxPost()}};var Ws=class{constructor(t){this.withinDirectionalStart=e=>this.reverse_?this.withinEndPost(e):this.withinStartPost(e),this.withinDirectionalEnd=e=>this.reverse_?this.withinStartPost(e):this.withinEndPost(e),this.withinStartPost=e=>{let i=this.index_.compare(this.rangedFilter_.getStartPost(),e);return this.startIsInclusive_?i<=0:i<0},this.withinEndPost=e=>{let i=this.index_.compare(e,this.rangedFilter_.getEndPost());return this.endIsInclusive_?i<=0:i<0},this.rangedFilter_=new ri(t),this.index_=t.getIndex(),this.limit_=t.getLimit(),this.reverse_=!t.isViewFromLeft(),this.startIsInclusive_=!t.startAfterSet_,this.endIsInclusive_=!t.endBeforeSet_}updateChild(t,e,i,s,r,o){return this.rangedFilter_.matches(new w(e,i))||(i=g.EMPTY_NODE),t.getImmediateChild(e).equals(i)?t:t.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(t,e,i,s,r,o):this.fullLimitUpdateChild_(t,e,i,r,o)}updateFullNode(t,e,i){let s;if(e.isLeafNode()||e.isEmpty())s=g.EMPTY_NODE.withIndex(this.index_);else if(this.limit_*2<e.numChildren()&&e.isIndexed(this.index_)){s=g.EMPTY_NODE.withIndex(this.index_);let r;this.reverse_?r=e.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):r=e.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let o=0;for(;r.hasNext()&&o<this.limit_;){let a=r.getNext();if(this.withinDirectionalStart(a))if(this.withinDirectionalEnd(a))s=s.updateImmediateChild(a.name,a.node),o++;else break;else continue}}else{s=e.withIndex(this.index_),s=s.updatePriority(g.EMPTY_NODE);let r;this.reverse_?r=s.getReverseIterator(this.index_):r=s.getIterator(this.index_);let o=0;for(;r.hasNext();){let a=r.getNext();o<this.limit_&&this.withinDirectionalStart(a)&&this.withinDirectionalEnd(a)?o++:s=s.updateImmediateChild(a.name,g.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(t,s,i)}updatePriority(t,e){return t}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(t,e,i,s,r){let o;if(this.reverse_){let d=this.index_.getCompare();o=(u,p)=>d(p,u)}else o=this.index_.getCompare();let a=t;f(a.numChildren()===this.limit_,"");let l=new w(e,i),c=this.reverse_?a.getFirstChild(this.index_):a.getLastChild(this.index_),h=this.rangedFilter_.matches(l);if(a.hasChild(e)){let d=a.getImmediateChild(e),u=s.getChildAfterChild(this.index_,c,this.reverse_);for(;u!=null&&(u.name===e||a.hasChild(u.name));)u=s.getChildAfterChild(this.index_,u,this.reverse_);let p=u==null?1:o(u,l);if(h&&!i.isEmpty()&&p>=0)return r?.trackChildChange(dn(e,i,d)),a.updateImmediateChild(e,i);{r?.trackChildChange(cn(e,d));let T=a.updateImmediateChild(e,g.EMPTY_NODE);return u!=null&&this.rangedFilter_.matches(u)?(r?.trackChildChange(Dt(u.name,u.node)),T.updateImmediateChild(u.name,u.node)):T}}else return i.isEmpty()?t:h&&o(c,l)>=0?(r!=null&&(r.trackChildChange(cn(c.name,c.node)),r.trackChildChange(Dt(e,i))),a.updateImmediateChild(e,i).updateImmediateChild(c.name,g.EMPTY_NODE)):t}};var Us=class n{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=P}hasStart(){return this.startSet_}isViewFromLeft(){return this.viewFrom_===""?this.startSet_:this.viewFrom_==="l"}getIndexStartValue(){return f(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return f(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:bt}hasEnd(){return this.endSet_}getIndexEndValue(){return f(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return f(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:tt}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&this.viewFrom_!==""}getLimit(){return f(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===P}copy(){let t=new n;return t.limitSet_=this.limitSet_,t.limit_=this.limit_,t.startSet_=this.startSet_,t.startAfterSet_=this.startAfterSet_,t.indexStartValue_=this.indexStartValue_,t.startNameSet_=this.startNameSet_,t.indexStartName_=this.indexStartName_,t.endSet_=this.endSet_,t.endBeforeSet_=this.endBeforeSet_,t.indexEndValue_=this.indexEndValue_,t.endNameSet_=this.endNameSet_,t.indexEndName_=this.indexEndName_,t.index_=this.index_,t.viewFrom_=this.viewFrom_,t}};function iu(n){return n.loadsAllData()?new hn(n.getIndex()):n.hasLimit()?new Ws(n):new ri(n)}function Va(n){let t={};if(n.isDefault())return t;let e;if(n.index_===P?e="$priority":n.index_===tu?e="$value":n.index_===Ct?e="$key":(f(n.index_ instanceof zs,"Unrecognized index type!"),e=n.index_.toString()),t.orderBy=F(e),n.startSet_){let i=n.startAfterSet_?"startAfter":"startAt";t[i]=F(n.indexStartValue_),n.startNameSet_&&(t[i]+=","+F(n.indexStartName_))}if(n.endSet_){let i=n.endBeforeSet_?"endBefore":"endAt";t[i]=F(n.indexEndValue_),n.endNameSet_&&(t[i]+=","+F(n.indexEndName_))}return n.limitSet_&&(n.isViewFromLeft()?t.limitToFirst=n.limit_:t.limitToLast=n.limit_),t}function ja(n){let t={};if(n.startSet_&&(t.sp=n.indexStartValue_,n.startNameSet_&&(t.sn=n.indexStartName_),t.sin=!n.startAfterSet_),n.endSet_&&(t.ep=n.indexEndValue_,n.endNameSet_&&(t.en=n.indexEndName_),t.ein=!n.endBeforeSet_),n.limitSet_){t.l=n.limit_;let e=n.viewFrom_;e===""&&(n.isViewFromLeft()?e="l":e="r"),t.vf=e}return n.index_!==P&&(t.i=n.index_.toString()),t}var Vs=class n extends ei{reportStats(t){throw new Error("Method not implemented.")}static getListenId_(t,e){return e!==void 0?"tag$"+e:(f(t._queryParams.isDefault(),"should have a tag if it's not a default query."),t._path.toString())}constructor(t,e,i,s){super(),this.repoInfo_=t,this.onDataUpdate_=e,this.authTokenProvider_=i,this.appCheckTokenProvider_=s,this.log_=wn("p:rest:"),this.listens_={}}listen(t,e,i,s){let r=t._path.toString();this.log_("Listen called for "+r+" "+t._queryIdentifier);let o=n.getListenId_(t,i),a={};this.listens_[o]=a;let l=Va(t._queryParams);this.restRequest_(r+".json",l,(c,h)=>{let d=h;if(c===404&&(d=null,c=null),c===null&&this.onDataUpdate_(r,d,!1,i),Ke(this.listens_,o)===a){let u;c?c===401?u="permission_denied":u="rest_error:"+c:u="ok",s(u,null)}})}unlisten(t,e){let i=n.getListenId_(t,e);delete this.listens_[i]}get(t){let e=Va(t._queryParams),i=t._path.toString(),s=new Ee;return this.restRequest_(i+".json",e,(r,o)=>{let a=o;r===404&&(a=null,r=null),r===null?(this.onDataUpdate_(i,a,!1,null),s.resolve(a)):s.reject(new Error(a))}),s.promise}refreshAuthToken(t){}restRequest_(t,e={},i){return e.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([s,r])=>{s&&s.accessToken&&(e.auth=s.accessToken),r&&r.token&&(e.ac=r.token);let o=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+t+"?ns="+this.repoInfo_.namespace+aa(e);this.log_("Sending REST request for "+o);let a=new XMLHttpRequest;a.onreadystatechange=()=>{if(i&&a.readyState===4){this.log_("REST Response for "+o+" received. status:",a.status,"response:",a.responseText);let l=null;if(a.status>=200&&a.status<300){try{l=mt(a.responseText)}catch{G("Failed to parse JSON response for "+o+": "+a.responseText)}i(null,l)}else a.status!==401&&a.status!==404&&G("Got unsuccessful REST response for "+o+" Status: "+a.status),i(a.status);i=null}},a.open("GET",o,!0),a.send()})}};var js=class{constructor(){this.rootNode_=g.EMPTY_NODE}getNode(t){return this.rootNode_.getChild(t)}updateSnapshot(t,e){this.rootNode_=this.rootNode_.updateChild(t,e)}};function oi(){return{value:null,children:new Map}}function Nl(n,t,e){if(b(t))n.value=e,n.children.clear();else if(n.value!==null)n.value=n.value.updateChild(t,e);else{let i=v(t);n.children.has(i)||n.children.set(i,oi());let s=n.children.get(i);t=x(t),Nl(s,t,e)}}function $s(n,t,e){n.value!==null?e(t,n.value):su(n,(i,s)=>{let r=new D(t.toString()+"/"+i);$s(s,r,e)})}function su(n,t){n.children.forEach((e,i)=>{t(i,e)})}var Gs=class{constructor(t){this.collection_=t,this.last_=null}get(){let t=this.collection_.get(),e=Object.assign({},t);return this.last_&&W(this.last_,(i,s)=>{e[i]=e[i]-s}),this.last_=t,e}};var $a=10*1e3,ru=30*1e3,ou=5*60*1e3,Qs=class{constructor(t,e){this.server_=e,this.statsToReport_={},this.statsListener_=new Gs(t);let i=$a+(ru-$a)*Math.random();nn(this.reportStats_.bind(this),Math.floor(i))}reportStats_(){let t=this.statsListener_.get(),e={},i=!1;W(t,(s,r)=>{r>0&&le(this.statsToReport_,s)&&(e[s]=r,i=!0)}),i&&this.server_.reportStats(e),nn(this.reportStats_.bind(this),Math.floor(Math.random()*2*ou))}};var _e=function(n){return n[n.OVERWRITE=0]="OVERWRITE",n[n.MERGE=1]="MERGE",n[n.ACK_USER_WRITE=2]="ACK_USER_WRITE",n[n.LISTEN_COMPLETE=3]="LISTEN_COMPLETE",n}(_e||{});function Er(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function Sr(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function Tr(n){return{fromUser:!1,fromServer:!0,queryId:n,tagged:!0}}var Ys=class n{constructor(t,e,i){this.path=t,this.affectedTree=e,this.revert=i,this.type=_e.ACK_USER_WRITE,this.source=Er()}operationForChild(t){if(b(this.path)){if(this.affectedTree.value!=null)return f(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{let e=this.affectedTree.subtree(new D(t));return new n(S(),e,this.revert)}}else return f(v(this.path)===t,"operationForChild called for unrelated child."),new n(x(this.path),this.affectedTree,this.revert)}};var ai=class n{constructor(t,e){this.source=t,this.path=e,this.type=_e.LISTEN_COMPLETE}operationForChild(t){return b(this.path)?new n(this.source,S()):new n(this.source,x(this.path))}};var Rt=class n{constructor(t,e,i){this.source=t,this.path=e,this.snap=i,this.type=_e.OVERWRITE}operationForChild(t){return b(this.path)?new n(this.source,S(),this.snap.getImmediateChild(t)):new n(this.source,x(this.path),this.snap)}};var un=class n{constructor(t,e,i){this.source=t,this.path=e,this.children=i,this.type=_e.MERGE}operationForChild(t){if(b(this.path)){let e=this.children.subtree(new D(t));return e.isEmpty()?null:e.value?new Rt(this.source,S(),e.value):new n(this.source,S(),e)}else return f(v(this.path)===t,"Can't get a merge for a child not on the path of the operation"),new n(this.source,x(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}};var me=class{constructor(t,e,i){this.node_=t,this.fullyInitialized_=e,this.filtered_=i}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(t){if(b(t))return this.isFullyInitialized()&&!this.filtered_;let e=v(t);return this.isCompleteForChild(e)}isCompleteForChild(t){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(t)}getNode(){return this.node_}};var qs=class{constructor(t){this.query_=t,this.index_=this.query_._queryParams.getIndex()}};function au(n,t,e,i){let s=[],r=[];return t.forEach(o=>{o.type==="child_changed"&&n.index_.indexedValueChanged(o.oldSnap,o.snapshotNode)&&r.push(nu(o.childName,o.snapshotNode))}),tn(n,s,"child_removed",t,i,e),tn(n,s,"child_added",t,i,e),tn(n,s,"child_moved",r,i,e),tn(n,s,"child_changed",t,i,e),tn(n,s,"value",t,i,e),s}function tn(n,t,e,i,s,r){let o=i.filter(a=>a.type===e);o.sort((a,l)=>cu(n,a,l)),o.forEach(a=>{let l=lu(n,a,r);s.forEach(c=>{c.respondsTo(a.type)&&t.push(c.createEvent(l,n.query_))})})}function lu(n,t,e){return t.type==="value"||t.type==="child_removed"||(t.prevName=e.getPredecessorChildName(t.childName,t.snapshotNode,n.index_)),t}function cu(n,t,e){if(t.childName==null||e.childName==null)throw qe("Should only compare child_ events.");let i=new w(t.childName,t.snapshotNode),s=new w(e.childName,e.snapshotNode);return n.index_.compare(i,s)}function wi(n,t){return{eventCache:n,serverCache:t}}function rn(n,t,e,i){return wi(new me(t,e,i),n.serverCache)}function Pl(n,t,e,i){return wi(n.eventCache,new me(t,e,i))}function li(n){return n.eventCache.isFullyInitialized()?n.eventCache.getNode():null}function nt(n){return n.serverCache.isFullyInitialized()?n.serverCache.getNode():null}var gs,du=()=>(gs||(gs=new ne(dh)),gs),Q=class n{static fromObject(t){let e=new n(null);return W(t,(i,s)=>{e=e.set(new D(i),s)}),e}constructor(t,e=du()){this.value=t,this.children=e}isEmpty(){return this.value===null&&this.children.isEmpty()}findRootMostMatchingPathAndValue(t,e){if(this.value!=null&&e(this.value))return{path:S(),value:this.value};if(b(t))return null;{let i=v(t),s=this.children.get(i);if(s!==null){let r=s.findRootMostMatchingPathAndValue(x(t),e);return r!=null?{path:N(new D(i),r.path),value:r.value}:null}else return null}}findRootMostValueAndPath(t){return this.findRootMostMatchingPathAndValue(t,()=>!0)}subtree(t){if(b(t))return this;{let e=v(t),i=this.children.get(e);return i!==null?i.subtree(x(t)):new n(null)}}set(t,e){if(b(t))return new n(e,this.children);{let i=v(t),r=(this.children.get(i)||new n(null)).set(x(t),e),o=this.children.insert(i,r);return new n(this.value,o)}}remove(t){if(b(t))return this.children.isEmpty()?new n(null):new n(null,this.children);{let e=v(t),i=this.children.get(e);if(i){let s=i.remove(x(t)),r;return s.isEmpty()?r=this.children.remove(e):r=this.children.insert(e,s),this.value===null&&r.isEmpty()?new n(null):new n(this.value,r)}else return this}}get(t){if(b(t))return this.value;{let e=v(t),i=this.children.get(e);return i?i.get(x(t)):null}}setTree(t,e){if(b(t))return e;{let i=v(t),r=(this.children.get(i)||new n(null)).setTree(x(t),e),o;return r.isEmpty()?o=this.children.remove(i):o=this.children.insert(i,r),new n(this.value,o)}}fold(t){return this.fold_(S(),t)}fold_(t,e){let i={};return this.children.inorderTraversal((s,r)=>{i[s]=r.fold_(N(t,s),e)}),e(t,this.value,i)}findOnPath(t,e){return this.findOnPath_(t,S(),e)}findOnPath_(t,e,i){let s=this.value?i(e,this.value):!1;if(s)return s;if(b(t))return null;{let r=v(t),o=this.children.get(r);return o?o.findOnPath_(x(t),N(e,r),i):null}}foreachOnPath(t,e){return this.foreachOnPath_(t,S(),e)}foreachOnPath_(t,e,i){if(b(t))return this;{this.value&&i(e,this.value);let s=v(t),r=this.children.get(s);return r?r.foreachOnPath_(x(t),N(e,s),i):new n(null)}}foreach(t){this.foreach_(S(),t)}foreach_(t,e){this.children.inorderTraversal((i,s)=>{s.foreach_(N(t,i),e)}),this.value&&e(t,this.value)}foreachChild(t){this.children.inorderTraversal((e,i)=>{i.value&&t(e,i.value)})}};var de=class n{constructor(t){this.writeTree_=t}static empty(){return new n(new Q(null))}};function on(n,t,e){if(b(t))return new de(new Q(e));{let i=n.writeTree_.findRootMostValueAndPath(t);if(i!=null){let s=i.path,r=i.value,o=$(s,t);return r=r.updateChild(o,e),new de(n.writeTree_.set(s,r))}else{let s=new Q(e),r=n.writeTree_.setTree(t,s);return new de(r)}}}function Ks(n,t,e){let i=n;return W(e,(s,r)=>{i=on(i,N(t,s),r)}),i}function Ga(n,t){if(b(t))return de.empty();{let e=n.writeTree_.setTree(t,new Q(null));return new de(e)}}function Xs(n,t){return st(n,t)!=null}function st(n,t){let e=n.writeTree_.findRootMostValueAndPath(t);return e!=null?n.writeTree_.get(e.path).getChild($(e.path,t)):null}function Qa(n){let t=[],e=n.writeTree_.value;return e!=null?e.isLeafNode()||e.forEachChild(P,(i,s)=>{t.push(new w(i,s))}):n.writeTree_.children.inorderTraversal((i,s)=>{s.value!=null&&t.push(new w(i,s.value))}),t}function Le(n,t){if(b(t))return n;{let e=st(n,t);return e!=null?new de(new Q(e)):new de(n.writeTree_.subtree(t))}}function Js(n){return n.writeTree_.isEmpty()}function It(n,t){return Al(S(),n.writeTree_,t)}function Al(n,t,e){if(t.value!=null)return e.updateChild(n,t.value);{let i=null;return t.children.inorderTraversal((s,r)=>{s===".priority"?(f(r.value!==null,"Priority writes must always be leaf nodes"),i=r.value):e=Al(N(n,s),r,e)}),!e.getChild(n).isEmpty()&&i!==null&&(e=e.updateChild(N(n,".priority"),i)),e}}function Ci(n,t){return Ll(t,n)}function hu(n,t,e,i,s){f(i>n.lastWriteId,"Stacking an older write on top of newer ones"),s===void 0&&(s=!0),n.allWrites.push({path:t,snap:e,writeId:i,visible:s}),s&&(n.visibleWrites=on(n.visibleWrites,t,e)),n.lastWriteId=i}function uu(n,t,e,i){f(i>n.lastWriteId,"Stacking an older merge on top of newer ones"),n.allWrites.push({path:t,children:e,writeId:i,visible:!0}),n.visibleWrites=Ks(n.visibleWrites,t,e),n.lastWriteId=i}function fu(n,t){for(let e=0;e<n.allWrites.length;e++){let i=n.allWrites[e];if(i.writeId===t)return i}return null}function pu(n,t){let e=n.allWrites.findIndex(a=>a.writeId===t);f(e>=0,"removeWrite called with nonexistent writeId.");let i=n.allWrites[e];n.allWrites.splice(e,1);let s=i.visible,r=!1,o=n.allWrites.length-1;for(;s&&o>=0;){let a=n.allWrites[o];a.visible&&(o>=e&&_u(a,i.path)?s=!1:te(i.path,a.path)&&(r=!0)),o--}if(s){if(r)return mu(n),!0;if(i.snap)n.visibleWrites=Ga(n.visibleWrites,i.path);else{let a=i.children;W(a,l=>{n.visibleWrites=Ga(n.visibleWrites,N(i.path,l))})}return!0}else return!1}function _u(n,t){if(n.snap)return te(n.path,t);for(let e in n.children)if(n.children.hasOwnProperty(e)&&te(N(n.path,e),t))return!0;return!1}function mu(n){n.visibleWrites=Ol(n.allWrites,gu,S()),n.allWrites.length>0?n.lastWriteId=n.allWrites[n.allWrites.length-1].writeId:n.lastWriteId=-1}function gu(n){return n.visible}function Ol(n,t,e){let i=de.empty();for(let s=0;s<n.length;++s){let r=n[s];if(t(r)){let o=r.path,a;if(r.snap)te(e,o)?(a=$(e,o),i=on(i,a,r.snap)):te(o,e)&&(a=$(o,e),i=on(i,S(),r.snap.getChild(a)));else if(r.children){if(te(e,o))a=$(e,o),i=Ks(i,a,r.children);else if(te(o,e))if(a=$(o,e),b(a))i=Ks(i,S(),r.children);else{let l=Ke(r.children,v(a));if(l){let c=l.getChild(x(a));i=on(i,S(),c)}}}else throw qe("WriteRecord should have .snap or .children")}}return i}function Ml(n,t,e,i,s){if(!i&&!s){let r=st(n.visibleWrites,t);if(r!=null)return r;{let o=Le(n.visibleWrites,t);if(Js(o))return e;if(e==null&&!Xs(o,S()))return null;{let a=e||g.EMPTY_NODE;return It(o,a)}}}else{let r=Le(n.visibleWrites,t);if(!s&&Js(r))return e;if(!s&&e==null&&!Xs(r,S()))return null;{let o=function(c){return(c.visible||s)&&(!i||!~i.indexOf(c.writeId))&&(te(c.path,t)||te(t,c.path))},a=Ol(n.allWrites,o,t),l=e||g.EMPTY_NODE;return It(a,l)}}}function yu(n,t,e){let i=g.EMPTY_NODE,s=st(n.visibleWrites,t);if(s)return s.isLeafNode()||s.forEachChild(P,(r,o)=>{i=i.updateImmediateChild(r,o)}),i;if(e){let r=Le(n.visibleWrites,t);return e.forEachChild(P,(o,a)=>{let l=It(Le(r,new D(o)),a);i=i.updateImmediateChild(o,l)}),Qa(r).forEach(o=>{i=i.updateImmediateChild(o.name,o.node)}),i}else{let r=Le(n.visibleWrites,t);return Qa(r).forEach(o=>{i=i.updateImmediateChild(o.name,o.node)}),i}}function vu(n,t,e,i,s){f(i||s,"Either existingEventSnap or existingServerSnap must exist");let r=N(t,e);if(Xs(n.visibleWrites,r))return null;{let o=Le(n.visibleWrites,r);return Js(o)?s.getChild(e):It(o,s.getChild(e))}}function wu(n,t,e,i){let s=N(t,e),r=st(n.visibleWrites,s);if(r!=null)return r;if(i.isCompleteForChild(e)){let o=Le(n.visibleWrites,s);return It(o,i.getNode().getImmediateChild(e))}else return null}function Cu(n,t){return st(n.visibleWrites,t)}function bu(n,t,e,i,s,r,o){let a,l=Le(n.visibleWrites,t),c=st(l,S());if(c!=null)a=c;else if(e!=null)a=It(l,e);else return[];if(a=a.withIndex(o),!a.isEmpty()&&!a.isLeafNode()){let h=[],d=o.getCompare(),u=r?a.getReverseIteratorFrom(i,o):a.getIteratorFrom(i,o),p=u.getNext();for(;p&&h.length<s;)d(p,i)!==0&&h.push(p),p=u.getNext();return h}else return[]}function Eu(){return{visibleWrites:de.empty(),allWrites:[],lastWriteId:-1}}function ci(n,t,e,i){return Ml(n.writeTree,n.treePath,t,e,i)}function Dr(n,t){return yu(n.writeTree,n.treePath,t)}function Ya(n,t,e,i){return vu(n.writeTree,n.treePath,t,e,i)}function di(n,t){return Cu(n.writeTree,N(n.treePath,t))}function Su(n,t,e,i,s,r){return bu(n.writeTree,n.treePath,t,e,i,s,r)}function Rr(n,t,e){return wu(n.writeTree,n.treePath,t,e)}function Fl(n,t){return Ll(N(n.treePath,t),n.writeTree)}function Ll(n,t){return{treePath:n,writeTree:t}}var Zs=class{constructor(){this.changeMap=new Map}trackChildChange(t){let e=t.type,i=t.childName;f(e==="child_added"||e==="child_changed"||e==="child_removed","Only child changes supported for tracking"),f(i!==".priority","Only non-priority child changes can be tracked.");let s=this.changeMap.get(i);if(s){let r=s.type;if(e==="child_added"&&r==="child_removed")this.changeMap.set(i,dn(i,t.snapshotNode,s.snapshotNode));else if(e==="child_removed"&&r==="child_added")this.changeMap.delete(i);else if(e==="child_removed"&&r==="child_changed")this.changeMap.set(i,cn(i,s.oldSnap));else if(e==="child_changed"&&r==="child_added")this.changeMap.set(i,Dt(i,t.snapshotNode));else if(e==="child_changed"&&r==="child_changed")this.changeMap.set(i,dn(i,t.snapshotNode,s.oldSnap));else throw qe("Illegal combination of changes: "+t+" occurred after "+s)}else this.changeMap.set(i,t)}getChanges(){return Array.from(this.changeMap.values())}};var er=class{getCompleteChild(t){return null}getChildAfterChild(t,e,i){return null}},Bl=new er,fn=class{constructor(t,e,i=null){this.writes_=t,this.viewCache_=e,this.optCompleteServerCache_=i}getCompleteChild(t){let e=this.viewCache_.eventCache;if(e.isCompleteForChild(t))return e.getNode().getImmediateChild(t);{let i=this.optCompleteServerCache_!=null?new me(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return Rr(this.writes_,t,i)}}getChildAfterChild(t,e,i){let s=this.optCompleteServerCache_!=null?this.optCompleteServerCache_:nt(this.viewCache_),r=Su(this.writes_,s,e,1,i,t);return r.length===0?null:r[0]}};function Tu(n){return{filter:n}}function Du(n,t){f(t.eventCache.getNode().isIndexed(n.filter.getIndex()),"Event snap not indexed"),f(t.serverCache.getNode().isIndexed(n.filter.getIndex()),"Server snap not indexed")}function Ru(n,t,e,i,s){let r=new Zs,o,a;if(e.type===_e.OVERWRITE){let c=e;c.source.fromUser?o=tr(n,t,c.path,c.snap,i,s,r):(f(c.source.fromServer,"Unknown source."),a=c.source.tagged||t.serverCache.isFiltered()&&!b(c.path),o=hi(n,t,c.path,c.snap,i,s,a,r))}else if(e.type===_e.MERGE){let c=e;c.source.fromUser?o=ku(n,t,c.path,c.children,i,s,r):(f(c.source.fromServer,"Unknown source."),a=c.source.tagged||t.serverCache.isFiltered(),o=nr(n,t,c.path,c.children,i,s,a,r))}else if(e.type===_e.ACK_USER_WRITE){let c=e;c.revert?o=Pu(n,t,c.path,i,s,r):o=xu(n,t,c.path,c.affectedTree,i,s,r)}else if(e.type===_e.LISTEN_COMPLETE)o=Nu(n,t,e.path,i,r);else throw qe("Unknown operation type: "+e.type);let l=r.getChanges();return Iu(t,o,l),{viewCache:o,changes:l}}function Iu(n,t,e){let i=t.eventCache;if(i.isFullyInitialized()){let s=i.getNode().isLeafNode()||i.getNode().isEmpty(),r=li(n);(e.length>0||!n.eventCache.isFullyInitialized()||s&&!i.getNode().equals(r)||!i.getNode().getPriority().equals(r.getPriority()))&&e.push(xl(li(t)))}}function zl(n,t,e,i,s,r){let o=t.eventCache;if(di(i,e)!=null)return t;{let a,l;if(b(e))if(f(t.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),t.serverCache.isFiltered()){let c=nt(t),h=c instanceof g?c:g.EMPTY_NODE,d=Dr(i,h);a=n.filter.updateFullNode(t.eventCache.getNode(),d,r)}else{let c=ci(i,nt(t));a=n.filter.updateFullNode(t.eventCache.getNode(),c,r)}else{let c=v(e);if(c===".priority"){f(ze(e)===1,"Can't have a priority with additional path components");let h=o.getNode();l=t.serverCache.getNode();let d=Ya(i,e,h,l);d!=null?a=n.filter.updatePriority(h,d):a=o.getNode()}else{let h=x(e),d;if(o.isCompleteForChild(c)){l=t.serverCache.getNode();let u=Ya(i,e,o.getNode(),l);u!=null?d=o.getNode().getImmediateChild(c).updateChild(h,u):d=o.getNode().getImmediateChild(c)}else d=Rr(i,c,t.serverCache);d!=null?a=n.filter.updateChild(o.getNode(),c,d,h,s,r):a=o.getNode()}}return rn(t,a,o.isFullyInitialized()||b(e),n.filter.filtersNodes())}}function hi(n,t,e,i,s,r,o,a){let l=t.serverCache,c,h=o?n.filter:n.filter.getIndexedFilter();if(b(e))c=h.updateFullNode(l.getNode(),i,null);else if(h.filtersNodes()&&!l.isFiltered()){let p=l.getNode().updateChild(e,i);c=h.updateFullNode(l.getNode(),p,null)}else{let p=v(e);if(!l.isCompleteForPath(e)&&ze(e)>1)return t;let m=x(e),R=l.getNode().getImmediateChild(p).updateChild(m,i);p===".priority"?c=h.updatePriority(l.getNode(),R):c=h.updateChild(l.getNode(),p,R,m,Bl,null)}let d=Pl(t,c,l.isFullyInitialized()||b(e),h.filtersNodes()),u=new fn(s,d,r);return zl(n,d,e,s,u,a)}function tr(n,t,e,i,s,r,o){let a=t.eventCache,l,c,h=new fn(s,t,r);if(b(e))c=n.filter.updateFullNode(t.eventCache.getNode(),i,o),l=rn(t,c,!0,n.filter.filtersNodes());else{let d=v(e);if(d===".priority")c=n.filter.updatePriority(t.eventCache.getNode(),i),l=rn(t,c,a.isFullyInitialized(),a.isFiltered());else{let u=x(e),p=a.getNode().getImmediateChild(d),m;if(b(u))m=i;else{let T=h.getCompleteChild(d);T!=null?vr(u)===".priority"&&T.getChild(Sl(u)).isEmpty()?m=T:m=T.updateChild(u,i):m=g.EMPTY_NODE}if(p.equals(m))l=t;else{let T=n.filter.updateChild(a.getNode(),d,m,u,h,o);l=rn(t,T,a.isFullyInitialized(),n.filter.filtersNodes())}}}return l}function qa(n,t){return n.eventCache.isCompleteForChild(t)}function ku(n,t,e,i,s,r,o){let a=t;return i.foreach((l,c)=>{let h=N(e,l);qa(t,v(h))&&(a=tr(n,a,h,c,s,r,o))}),i.foreach((l,c)=>{let h=N(e,l);qa(t,v(h))||(a=tr(n,a,h,c,s,r,o))}),a}function Ka(n,t,e){return e.foreach((i,s)=>{t=t.updateChild(i,s)}),t}function nr(n,t,e,i,s,r,o,a){if(t.serverCache.getNode().isEmpty()&&!t.serverCache.isFullyInitialized())return t;let l=t,c;b(e)?c=i:c=new Q(null).setTree(e,i);let h=t.serverCache.getNode();return c.children.inorderTraversal((d,u)=>{if(h.hasChild(d)){let p=t.serverCache.getNode().getImmediateChild(d),m=Ka(n,p,u);l=hi(n,l,new D(d),m,s,r,o,a)}}),c.children.inorderTraversal((d,u)=>{let p=!t.serverCache.isCompleteForChild(d)&&u.value===null;if(!h.hasChild(d)&&!p){let m=t.serverCache.getNode().getImmediateChild(d),T=Ka(n,m,u);l=hi(n,l,new D(d),T,s,r,o,a)}}),l}function xu(n,t,e,i,s,r,o){if(di(s,e)!=null)return t;let a=t.serverCache.isFiltered(),l=t.serverCache;if(i.value!=null){if(b(e)&&l.isFullyInitialized()||l.isCompleteForPath(e))return hi(n,t,e,l.getNode().getChild(e),s,r,a,o);if(b(e)){let c=new Q(null);return l.getNode().forEachChild(Ct,(h,d)=>{c=c.set(new D(h),d)}),nr(n,t,e,c,s,r,a,o)}else return t}else{let c=new Q(null);return i.foreach((h,d)=>{let u=N(e,h);l.isCompleteForPath(u)&&(c=c.set(h,l.getNode().getChild(u)))}),nr(n,t,e,c,s,r,a,o)}}function Nu(n,t,e,i,s){let r=t.serverCache,o=Pl(t,r.getNode(),r.isFullyInitialized()||b(e),r.isFiltered());return zl(n,o,e,i,Bl,s)}function Pu(n,t,e,i,s,r){let o;if(di(i,e)!=null)return t;{let a=new fn(i,t,s),l=t.eventCache.getNode(),c;if(b(e)||v(e)===".priority"){let h;if(t.serverCache.isFullyInitialized())h=ci(i,nt(t));else{let d=t.serverCache.getNode();f(d instanceof g,"serverChildren would be complete if leaf node"),h=Dr(i,d)}h=h,c=n.filter.updateFullNode(l,h,r)}else{let h=v(e),d=Rr(i,h,t.serverCache);d==null&&t.serverCache.isCompleteForChild(h)&&(d=l.getImmediateChild(h)),d!=null?c=n.filter.updateChild(l,h,d,x(e),a,r):t.eventCache.getNode().hasChild(h)?c=n.filter.updateChild(l,h,g.EMPTY_NODE,x(e),a,r):c=l,c.isEmpty()&&t.serverCache.isFullyInitialized()&&(o=ci(i,nt(t)),o.isLeafNode()&&(c=n.filter.updateFullNode(c,o,r)))}return o=t.serverCache.isFullyInitialized()||di(i,S())!=null,rn(t,c,o,n.filter.filtersNodes())}}var ir=class{constructor(t,e){this.query_=t,this.eventRegistrations_=[];let i=this.query_._queryParams,s=new hn(i.getIndex()),r=iu(i);this.processor_=Tu(r);let o=e.serverCache,a=e.eventCache,l=s.updateFullNode(g.EMPTY_NODE,o.getNode(),null),c=r.updateFullNode(g.EMPTY_NODE,a.getNode(),null),h=new me(l,o.isFullyInitialized(),s.filtersNodes()),d=new me(c,a.isFullyInitialized(),r.filtersNodes());this.viewCache_=wi(d,h),this.eventGenerator_=new qs(this.query_)}get query(){return this.query_}};function Au(n){return n.viewCache_.serverCache.getNode()}function Ou(n){return li(n.viewCache_)}function Mu(n,t){let e=nt(n.viewCache_);return e&&(n.query._queryParams.loadsAllData()||!b(t)&&!e.getImmediateChild(v(t)).isEmpty())?e.getChild(t):null}function Xa(n){return n.eventRegistrations_.length===0}function Fu(n,t){n.eventRegistrations_.push(t)}function Ja(n,t,e){let i=[];if(e){f(t==null,"A cancel should cancel all event registrations.");let s=n.query._path;n.eventRegistrations_.forEach(r=>{let o=r.createCancelEvent(e,s);o&&i.push(o)})}if(t){let s=[];for(let r=0;r<n.eventRegistrations_.length;++r){let o=n.eventRegistrations_[r];if(!o.matches(t))s.push(o);else if(t.hasAnyCallback()){s=s.concat(n.eventRegistrations_.slice(r+1));break}}n.eventRegistrations_=s}else n.eventRegistrations_=[];return i}function Za(n,t,e,i){t.type===_e.MERGE&&t.source.queryId!==null&&(f(nt(n.viewCache_),"We should always have a full cache before handling merges"),f(li(n.viewCache_),"Missing event cache, even though we have a server cache"));let s=n.viewCache_,r=Ru(n.processor_,s,t,e,i);return Du(n.processor_,r.viewCache),f(r.viewCache.serverCache.isFullyInitialized()||!s.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),n.viewCache_=r.viewCache,Hl(n,r.changes,r.viewCache.eventCache.getNode(),null)}function Lu(n,t){let e=n.viewCache_.eventCache,i=[];return e.getNode().isLeafNode()||e.getNode().forEachChild(P,(r,o)=>{i.push(Dt(r,o))}),e.isFullyInitialized()&&i.push(xl(e.getNode())),Hl(n,i,e.getNode(),t)}function Hl(n,t,e,i){let s=i?[i]:n.eventRegistrations_;return au(n.eventGenerator_,t,e,s)}var ui,fi=class{constructor(){this.views=new Map}};function Bu(n){f(!ui,"__referenceConstructor has already been defined"),ui=n}function zu(){return f(ui,"Reference.ts has not been loaded"),ui}function Hu(n){return n.views.size===0}function Ir(n,t,e,i){let s=t.source.queryId;if(s!==null){let r=n.views.get(s);return f(r!=null,"SyncTree gave us an op for an invalid query."),Za(r,t,e,i)}else{let r=[];for(let o of n.views.values())r=r.concat(Za(o,t,e,i));return r}}function Wl(n,t,e,i,s){let r=t._queryIdentifier,o=n.views.get(r);if(!o){let a=ci(e,s?i:null),l=!1;a?l=!0:i instanceof g?(a=Dr(e,i),l=!1):(a=g.EMPTY_NODE,l=!1);let c=wi(new me(a,l,!1),new me(i,s,!1));return new ir(t,c)}return o}function Wu(n,t,e,i,s,r){let o=Wl(n,t,i,s,r);return n.views.has(t._queryIdentifier)||n.views.set(t._queryIdentifier,o),Fu(o,e),Lu(o,e)}function Uu(n,t,e,i){let s=t._queryIdentifier,r=[],o=[],a=He(n);if(s==="default")for(let[l,c]of n.views.entries())o=o.concat(Ja(c,e,i)),Xa(c)&&(n.views.delete(l),c.query._queryParams.loadsAllData()||r.push(c.query));else{let l=n.views.get(s);l&&(o=o.concat(Ja(l,e,i)),Xa(l)&&(n.views.delete(s),l.query._queryParams.loadsAllData()||r.push(l.query)))}return a&&!He(n)&&r.push(new(zu())(t._repo,t._path)),{removed:r,events:o}}function Ul(n){let t=[];for(let e of n.views.values())e.query._queryParams.loadsAllData()||t.push(e);return t}function Be(n,t){let e=null;for(let i of n.views.values())e=e||Mu(i,t);return e}function Vl(n,t){if(t._queryParams.loadsAllData())return bi(n);{let i=t._queryIdentifier;return n.views.get(i)}}function jl(n,t){return Vl(n,t)!=null}function He(n){return bi(n)!=null}function bi(n){for(let t of n.views.values())if(t.query._queryParams.loadsAllData())return t;return null}var pi;function Vu(n){f(!pi,"__referenceConstructor has already been defined"),pi=n}function ju(){return f(pi,"Reference.ts has not been loaded"),pi}var $u=1,_i=class{constructor(t){this.listenProvider_=t,this.syncPointTree_=new Q(null),this.pendingWriteTree_=Eu(),this.tagToQueryMap=new Map,this.queryToTagMap=new Map}};function $l(n,t,e,i,s){return hu(n.pendingWriteTree_,t,e,i,s),s?Pt(n,new Rt(Er(),t,e)):[]}function Gu(n,t,e,i){uu(n.pendingWriteTree_,t,e,i);let s=Q.fromObject(e);return Pt(n,new un(Er(),t,s))}function Fe(n,t,e=!1){let i=fu(n.pendingWriteTree_,t);if(pu(n.pendingWriteTree_,t)){let r=new Q(null);return i.snap!=null?r=r.set(S(),!0):W(i.children,o=>{r=r.set(new D(o),!0)}),Pt(n,new Ys(i.path,r,e))}else return[]}function bn(n,t,e){return Pt(n,new Rt(Sr(),t,e))}function Qu(n,t,e){let i=Q.fromObject(e);return Pt(n,new un(Sr(),t,i))}function Yu(n,t){return Pt(n,new ai(Sr(),t))}function qu(n,t,e){let i=xr(n,e);if(i){let s=Nr(i),r=s.path,o=s.queryId,a=$(r,t),l=new ai(Tr(o),a);return Pr(n,r,l)}else return[]}function mi(n,t,e,i,s=!1){let r=t._path,o=n.syncPointTree_.get(r),a=[];if(o&&(t._queryIdentifier==="default"||jl(o,t))){let l=Uu(o,t,e,i);Hu(o)&&(n.syncPointTree_=n.syncPointTree_.remove(r));let c=l.removed;if(a=l.events,!s){let h=c.findIndex(u=>u._queryParams.loadsAllData())!==-1,d=n.syncPointTree_.findOnPath(r,(u,p)=>He(p));if(h&&!d){let u=n.syncPointTree_.subtree(r);if(!u.isEmpty()){let p=Ju(u);for(let m=0;m<p.length;++m){let T=p[m],R=T.query,O=ql(n,T);n.listenProvider_.startListening(an(R),pn(n,R),O.hashFn,O.onComplete)}}}!d&&c.length>0&&!i&&(h?n.listenProvider_.stopListening(an(t),null):c.forEach(u=>{let p=n.queryToTagMap.get(Ei(u));n.listenProvider_.stopListening(an(u),p)}))}Zu(n,c)}return a}function Gl(n,t,e,i){let s=xr(n,i);if(s!=null){let r=Nr(s),o=r.path,a=r.queryId,l=$(o,t),c=new Rt(Tr(a),l,e);return Pr(n,o,c)}else return[]}function Ku(n,t,e,i){let s=xr(n,i);if(s){let r=Nr(s),o=r.path,a=r.queryId,l=$(o,t),c=Q.fromObject(e),h=new un(Tr(a),l,c);return Pr(n,o,h)}else return[]}function sr(n,t,e,i=!1){let s=t._path,r=null,o=!1;n.syncPointTree_.foreachOnPath(s,(u,p)=>{let m=$(u,s);r=r||Be(p,m),o=o||He(p)});let a=n.syncPointTree_.get(s);a?(o=o||He(a),r=r||Be(a,S())):(a=new fi,n.syncPointTree_=n.syncPointTree_.set(s,a));let l;r!=null?l=!0:(l=!1,r=g.EMPTY_NODE,n.syncPointTree_.subtree(s).foreachChild((p,m)=>{let T=Be(m,S());T&&(r=r.updateImmediateChild(p,T))}));let c=jl(a,t);if(!c&&!t._queryParams.loadsAllData()){let u=Ei(t);f(!n.queryToTagMap.has(u),"View does not exist, but we have a tag");let p=ef();n.queryToTagMap.set(u,p),n.tagToQueryMap.set(p,u)}let h=Ci(n.pendingWriteTree_,s),d=Wu(a,t,e,h,r,l);if(!c&&!o&&!i){let u=Vl(a,t);d=d.concat(tf(n,t,u))}return d}function kr(n,t,e){let s=n.pendingWriteTree_,r=n.syncPointTree_.findOnPath(t,(o,a)=>{let l=$(o,t),c=Be(a,l);if(c)return c});return Ml(s,t,r,e,!0)}function Xu(n,t){let e=t._path,i=null;n.syncPointTree_.foreachOnPath(e,(c,h)=>{let d=$(c,e);i=i||Be(h,d)});let s=n.syncPointTree_.get(e);s?i=i||Be(s,S()):(s=new fi,n.syncPointTree_=n.syncPointTree_.set(e,s));let r=i!=null,o=r?new me(i,!0,!1):null,a=Ci(n.pendingWriteTree_,t._path),l=Wl(s,t,a,r?o.getNode():g.EMPTY_NODE,r);return Ou(l)}function Pt(n,t){return Ql(t,n.syncPointTree_,null,Ci(n.pendingWriteTree_,S()))}function Ql(n,t,e,i){if(b(n.path))return Yl(n,t,e,i);{let s=t.get(S());e==null&&s!=null&&(e=Be(s,S()));let r=[],o=v(n.path),a=n.operationForChild(o),l=t.children.get(o);if(l&&a){let c=e?e.getImmediateChild(o):null,h=Fl(i,o);r=r.concat(Ql(a,l,c,h))}return s&&(r=r.concat(Ir(s,n,i,e))),r}}function Yl(n,t,e,i){let s=t.get(S());e==null&&s!=null&&(e=Be(s,S()));let r=[];return t.children.inorderTraversal((o,a)=>{let l=e?e.getImmediateChild(o):null,c=Fl(i,o),h=n.operationForChild(o);h&&(r=r.concat(Yl(h,a,l,c)))}),s&&(r=r.concat(Ir(s,n,i,e))),r}function ql(n,t){let e=t.query,i=pn(n,e);return{hashFn:()=>(Au(t)||g.EMPTY_NODE).hash(),onComplete:s=>{if(s==="ok")return i?qu(n,e._path,i):Yu(n,e._path);{let r=fh(s,e);return mi(n,e,null,r)}}}}function pn(n,t){let e=Ei(t);return n.queryToTagMap.get(e)}function Ei(n){return n._path.toString()+"$"+n._queryIdentifier}function xr(n,t){return n.tagToQueryMap.get(t)}function Nr(n){let t=n.indexOf("$");return f(t!==-1&&t<n.length-1,"Bad queryKey."),{queryId:n.substr(t+1),path:new D(n.substr(0,t))}}function Pr(n,t,e){let i=n.syncPointTree_.get(t);f(i,"Missing sync point for query tag that we're tracking");let s=Ci(n.pendingWriteTree_,t);return Ir(i,e,s,null)}function Ju(n){return n.fold((t,e,i)=>{if(e&&He(e))return[bi(e)];{let s=[];return e&&(s=Ul(e)),W(i,(r,o)=>{s=s.concat(o)}),s}})}function an(n){return n._queryParams.loadsAllData()&&!n._queryParams.isDefault()?new(ju())(n._repo,n._path):n}function Zu(n,t){for(let e=0;e<t.length;++e){let i=t[e];if(!i._queryParams.loadsAllData()){let s=Ei(i),r=n.queryToTagMap.get(s);n.queryToTagMap.delete(s),n.tagToQueryMap.delete(r)}}}function ef(){return $u++}function tf(n,t,e){let i=t._path,s=pn(n,t),r=ql(n,e),o=n.listenProvider_.startListening(an(t),s,r.hashFn,r.onComplete),a=n.syncPointTree_.subtree(i);if(s)f(!He(a.value),"If we're adding a query, it shouldn't be shadowed");else{let l=a.fold((c,h,d)=>{if(!b(c)&&h&&He(h))return[bi(h).query];{let u=[];return h&&(u=u.concat(Ul(h).map(p=>p.query))),W(d,(p,m)=>{u=u.concat(m)}),u}});for(let c=0;c<l.length;++c){let h=l[c];n.listenProvider_.stopListening(an(h),pn(n,h))}}return o}var rr=class n{constructor(t){this.node_=t}getImmediateChild(t){let e=this.node_.getImmediateChild(t);return new n(e)}node(){return this.node_}},or=class n{constructor(t,e){this.syncTree_=t,this.path_=e}getImmediateChild(t){let e=N(this.path_,t);return new n(this.syncTree_,e)}node(){return kr(this.syncTree_,this.path_)}},nf=function(n){return n=n||{},n.timestamp=n.timestamp||new Date().getTime(),n},el=function(n,t,e){if(!n||typeof n!="object")return n;if(f(".sv"in n,"Unexpected leaf node or priority contents"),typeof n[".sv"]=="string")return sf(n[".sv"],t,e);if(typeof n[".sv"]=="object")return rf(n[".sv"],t);f(!1,"Unexpected server value: "+JSON.stringify(n,null,2))},sf=function(n,t,e){switch(n){case"timestamp":return e.timestamp;default:f(!1,"Unexpected server value: "+n)}},rf=function(n,t,e){n.hasOwnProperty("increment")||f(!1,"Unexpected server value: "+JSON.stringify(n,null,2));let i=n.increment;typeof i!="number"&&f(!1,"Unexpected increment value: "+i);let s=t.node();if(f(s!==null&&typeof s<"u","Expected ChildrenNode.EMPTY_NODE for nulls"),!s.isLeafNode())return i;let o=s.getValue();return typeof o!="number"?i:o+i},Kl=function(n,t,e,i){return Ar(t,new or(e,n),i)},Xl=function(n,t,e){return Ar(n,new rr(t),e)};function Ar(n,t,e){let i=n.getPriority().val(),s=el(i,t.getImmediateChild(".priority"),e),r;if(n.isLeafNode()){let o=n,a=el(o.getValue(),t,e);return a!==o.getValue()||s!==o.getPriority().val()?new St(a,L(s)):n}else{let o=n;return r=o,s!==o.getPriority().val()&&(r=r.updatePriority(new St(s))),o.forEachChild(P,(a,l)=>{let c=Ar(l,t.getImmediateChild(a),e);c!==l&&(r=r.updateImmediateChild(a,c))}),r}}var _n=class{constructor(t="",e=null,i={children:{},childCount:0}){this.name=t,this.parent=e,this.node=i}};function Or(n,t){let e=t instanceof D?t:new D(t),i=n,s=v(e);for(;s!==null;){let r=Ke(i.node.children,s)||{children:{},childCount:0};i=new _n(s,i,r),e=x(e),s=v(e)}return i}function At(n){return n.node.value}function Jl(n,t){n.node.value=t,ar(n)}function Zl(n){return n.node.childCount>0}function of(n){return At(n)===void 0&&!Zl(n)}function Si(n,t){W(n.node.children,(e,i)=>{t(new _n(e,n,i))})}function ec(n,t,e,i){e&&!i&&t(n),Si(n,s=>{ec(s,t,!0,i)}),e&&i&&t(n)}function af(n,t,e){let i=e?n:n.parent;for(;i!==null;){if(t(i))return!0;i=i.parent}return!1}function En(n){return new D(n.parent===null?n.name:En(n.parent)+"/"+n.name)}function ar(n){n.parent!==null&&lf(n.parent,n.name,n)}function lf(n,t,e){let i=of(e),s=le(n.node.children,t);i&&s?(delete n.node.children[t],n.node.childCount--,ar(n)):!i&&!s&&(n.node.children[t]=e.node,n.node.childCount++,ar(n))}var cf=/[\[\].#$\/\u0000-\u001F\u007F]/,df=/[\[\].#$\u0000-\u001F\u007F]/,ys=10*1024*1024,Mr=function(n){return typeof n=="string"&&n.length!==0&&!cf.test(n)},tc=function(n){return typeof n=="string"&&n.length!==0&&!df.test(n)},hf=function(n){return n&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),tc(n)},uf=function(n){return n===null||typeof n=="string"||typeof n=="number"&&!mr(n)||n&&typeof n=="object"&&le(n,".sv")},nc=function(n,t,e,i){i&&t===void 0||Ti(Gt(n,"value"),t,e)},Ti=function(n,t,e){let i=e instanceof D?new Ps(e,n):e;if(t===void 0)throw new Error(n+"contains undefined "+Je(i));if(typeof t=="function")throw new Error(n+"contains a function "+Je(i)+" with contents = "+t.toString());if(mr(t))throw new Error(n+"contains "+t.toString()+" "+Je(i));if(typeof t=="string"&&t.length>ys/3&&Qt(t)>ys)throw new Error(n+"contains a string greater than "+ys+" utf8 bytes "+Je(i)+" ('"+t.substring(0,50)+"...')");if(t&&typeof t=="object"){let s=!1,r=!1;if(W(t,(o,a)=>{if(o===".value")s=!0;else if(o!==".priority"&&o!==".sv"&&(r=!0,!Mr(o)))throw new Error(n+" contains an invalid key ("+o+") "+Je(i)+`.  Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`);Vh(i,o),Ti(n,a,i),jh(i)}),s&&r)throw new Error(n+' contains ".value" child '+Je(i)+" in addition to actual children.")}},ff=function(n,t){let e,i;for(e=0;e<t.length;e++){i=t[e];let r=ln(i);for(let o=0;o<r.length;o++)if(!(r[o]===".priority"&&o===r.length-1)){if(!Mr(r[o]))throw new Error(n+"contains an invalid key ("+r[o]+") in path "+i.toString()+`. Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`)}}t.sort(Uh);let s=null;for(e=0;e<t.length;e++){if(i=t[e],s!==null&&te(s,i))throw new Error(n+"contains a path "+s.toString()+" that is ancestor of another path "+i.toString());s=i}},pf=function(n,t,e,i){if(i&&t===void 0)return;let s=Gt(n,"values");if(!(t&&typeof t=="object")||Array.isArray(t))throw new Error(s+" must be an object containing the children to replace.");let r=[];W(t,(o,a)=>{let l=new D(o);if(Ti(s,a,N(e,l)),vr(l)===".priority"&&!uf(a))throw new Error(s+"contains an invalid value for '"+l.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");r.push(l)}),ff(s,r)};var ic=function(n,t,e,i){if(!(i&&e===void 0)&&!tc(e))throw new Error(Gt(n,t)+'was an invalid path = "'+e+`". Paths must be non-empty strings and can't contain ".", "#", "$", "[", or "]"`)},_f=function(n,t,e,i){e&&(e=e.replace(/^\/*\.info(\/|$)/,"/")),ic(n,t,e,i)},Fr=function(n,t){if(v(t)===".info")throw new Error(n+" failed = Can't modify data under /.info/")},mf=function(n,t){let e=t.path.toString();if(typeof t.repoInfo.host!="string"||t.repoInfo.host.length===0||!Mr(t.repoInfo.namespace)&&t.repoInfo.host.split(":")[0]!=="localhost"||e.length!==0&&!hf(e))throw new Error(Gt(n,"url")+`must be a valid firebase URL and the path can't contain ".", "#", "$", "[", or "]".`)};var lr=class{constructor(){this.eventLists_=[],this.recursionDepth_=0}};function Di(n,t){let e=null;for(let i=0;i<t.length;i++){let s=t[i],r=s.getPath();e!==null&&!wr(r,e.path)&&(n.eventLists_.push(e),e=null),e===null&&(e={events:[],path:r}),e.events.push(s)}e&&n.eventLists_.push(e)}function sc(n,t,e){Di(n,e),rc(n,i=>wr(i,t))}function ie(n,t,e){Di(n,e),rc(n,i=>te(i,t)||te(t,i))}function rc(n,t){n.recursionDepth_++;let e=!0;for(let i=0;i<n.eventLists_.length;i++){let s=n.eventLists_[i];if(s){let r=s.path;t(r)?(gf(n.eventLists_[i]),n.eventLists_[i]=null):e=!1}}e&&(n.eventLists_=[]),n.recursionDepth_--}function gf(n){for(let t=0;t<n.events.length;t++){let e=n.events[t];if(e!==null){n.events[t]=null;let i=e.getEventRunner();et&&H("event: "+e.toString()),Nt(i)}}}var yf="repo_interrupt",vf=25,cr=class{constructor(t,e,i,s){this.repoInfo_=t,this.forceRestClient_=e,this.authTokenProvider_=i,this.appCheckProvider_=s,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new lr,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=oi(),this.transactionQueueTree_=new _n,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}};function wf(n,t,e){if(n.stats_=yr(n.repoInfo_),n.forceRestClient_||gh())n.server_=new Vs(n.repoInfo_,(i,s,r,o)=>{tl(n,i,s,r,o)},n.authTokenProvider_,n.appCheckProvider_),setTimeout(()=>nl(n,!0),0);else{if(typeof e<"u"&&e!==null){if(typeof e!="object")throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{F(e)}catch(i){throw new Error("Invalid authOverride provided: "+i)}}n.persistentConnection_=new Cr(n.repoInfo_,t,(i,s,r,o)=>{tl(n,i,s,r,o)},i=>{nl(n,i)},i=>{Cf(n,i)},n.authTokenProvider_,n.appCheckProvider_,e),n.server_=n.persistentConnection_}n.authTokenProvider_.addTokenChangeListener(i=>{n.server_.refreshAuthToken(i)}),n.appCheckProvider_.addTokenChangeListener(i=>{n.server_.refreshAppCheckToken(i.token)}),n.statsReporter_=vh(n.repoInfo_,()=>new Qs(n.stats_,n.server_)),n.infoData_=new js,n.infoSyncTree_=new _i({startListening:(i,s,r,o)=>{let a=[],l=n.infoData_.getNode(i._path);return l.isEmpty()||(a=bn(n.infoSyncTree_,i._path,l),setTimeout(()=>{o("ok")},0)),a},stopListening:()=>{}}),Lr(n,"connected",!1),n.serverSyncTree_=new _i({startListening:(i,s,r,o)=>(n.server_.listen(i,r,s,(a,l)=>{let c=o(a,l);ie(n.eventQueue_,i._path,c)}),[]),stopListening:(i,s)=>{n.server_.unlisten(i,s)}})}function oc(n){let e=n.infoData_.getNode(new D(".info/serverTimeOffset")).val()||0;return new Date().getTime()+e}function Ri(n){return nf({timestamp:oc(n)})}function tl(n,t,e,i,s){n.dataUpdateCount++;let r=new D(t);e=n.interceptServerDataCallback_?n.interceptServerDataCallback_(t,e):e;let o=[];if(s)if(i){let l=$t(e,c=>L(c));o=Ku(n.serverSyncTree_,r,l,s)}else{let l=L(e);o=Gl(n.serverSyncTree_,r,l,s)}else if(i){let l=$t(e,c=>L(c));o=Qu(n.serverSyncTree_,r,l)}else{let l=L(e);o=bn(n.serverSyncTree_,r,l)}let a=r;o.length>0&&(a=kt(n,r)),ie(n.eventQueue_,a,o)}function nl(n,t){Lr(n,"connected",t),t===!1&&Tf(n)}function Cf(n,t){W(t,(e,i)=>{Lr(n,e,i)})}function Lr(n,t,e){let i=new D("/.info/"+t),s=L(e);n.infoData_.updateSnapshot(i,s);let r=bn(n.infoSyncTree_,i,s);ie(n.eventQueue_,i,r)}function Br(n){return n.nextWriteId_++}function bf(n,t,e){let i=Xu(n.serverSyncTree_,t);return i!=null?Promise.resolve(i):n.server_.get(t).then(s=>{let r=L(s).withIndex(t._queryParams.getIndex());sr(n.serverSyncTree_,t,e,!0);let o;if(t._queryParams.loadsAllData())o=bn(n.serverSyncTree_,t._path,r);else{let a=pn(n.serverSyncTree_,t);o=Gl(n.serverSyncTree_,t._path,r,a)}return ie(n.eventQueue_,t._path,o),mi(n.serverSyncTree_,t,e,null,!0),r},s=>(Sn(n,"get for query "+F(t)+" failed: "+s),Promise.reject(new Error(s))))}function Ef(n,t,e,i,s){Sn(n,"set",{path:t.toString(),value:e,priority:i});let r=Ri(n),o=L(e,i),a=kr(n.serverSyncTree_,t),l=Xl(o,a,r),c=Br(n),h=$l(n.serverSyncTree_,t,l,c,!0);Di(n.eventQueue_,h),n.server_.put(t.toString(),o.val(!0),(u,p)=>{let m=u==="ok";m||G("set at "+t+" failed: "+u);let T=Fe(n.serverSyncTree_,c,!m);ie(n.eventQueue_,t,T),hr(n,s,u,p)});let d=Hr(n,t);kt(n,d),ie(n.eventQueue_,d,[])}function Sf(n,t,e,i){Sn(n,"update",{path:t.toString(),value:e});let s=!0,r=Ri(n),o={};if(W(e,(a,l)=>{s=!1,o[a]=Kl(N(t,a),L(l),n.serverSyncTree_,r)}),s)H("update() called with empty data.  Don't do anything."),hr(n,i,"ok",void 0);else{let a=Br(n),l=Gu(n.serverSyncTree_,t,o,a);Di(n.eventQueue_,l),n.server_.merge(t.toString(),e,(c,h)=>{let d=c==="ok";d||G("update at "+t+" failed: "+c);let u=Fe(n.serverSyncTree_,a,!d),p=u.length>0?kt(n,t):t;ie(n.eventQueue_,p,u),hr(n,i,c,h)}),W(e,c=>{let h=Hr(n,N(t,c));kt(n,h)}),ie(n.eventQueue_,t,[])}}function Tf(n){Sn(n,"onDisconnectEvents");let t=Ri(n),e=oi();$s(n.onDisconnect_,S(),(s,r)=>{let o=Kl(s,r,n.serverSyncTree_,t);Nl(e,s,o)});let i=[];$s(e,S(),(s,r)=>{i=i.concat(bn(n.serverSyncTree_,s,r));let o=Hr(n,s);kt(n,o)}),n.onDisconnect_=oi(),ie(n.eventQueue_,S(),i)}function Df(n,t,e){let i;v(t._path)===".info"?i=sr(n.infoSyncTree_,t,e):i=sr(n.serverSyncTree_,t,e),sc(n.eventQueue_,t._path,i)}function dr(n,t,e){let i;v(t._path)===".info"?i=mi(n.infoSyncTree_,t,e):i=mi(n.serverSyncTree_,t,e),sc(n.eventQueue_,t._path,i)}function Rf(n){n.persistentConnection_&&n.persistentConnection_.interrupt(yf)}function Sn(n,...t){let e="";n.persistentConnection_&&(e=n.persistentConnection_.id+":"),H(e,...t)}function hr(n,t,e,i){t&&Nt(()=>{if(e==="ok")t(null);else{let s=(e||"error").toUpperCase(),r=s;i&&(r+=": "+i);let o=new Error(r);o.code=s,t(o)}})}function ac(n,t,e){return kr(n.serverSyncTree_,t,e)||g.EMPTY_NODE}function zr(n,t=n.transactionQueueTree_){if(t||Ii(n,t),At(t)){let e=cc(n,t);f(e.length>0,"Sending zero length transaction queue"),e.every(s=>s.status===0)&&If(n,En(t),e)}else Zl(t)&&Si(t,e=>{zr(n,e)})}function If(n,t,e){let i=e.map(c=>c.currentWriteId),s=ac(n,t,i),r=s,o=s.hash();for(let c=0;c<e.length;c++){let h=e[c];f(h.status===0,"tryToSendTransactionQueue_: items in queue should all be run."),h.status=1,h.retryCount++;let d=$(t,h.path);r=r.updateChild(d,h.currentOutputSnapshotRaw)}let a=r.val(!0),l=t;n.server_.put(l.toString(),a,c=>{Sn(n,"transaction put response",{path:l.toString(),status:c});let h=[];if(c==="ok"){let d=[];for(let u=0;u<e.length;u++)e[u].status=2,h=h.concat(Fe(n.serverSyncTree_,e[u].currentWriteId)),e[u].onComplete&&d.push(()=>e[u].onComplete(null,!0,e[u].currentOutputSnapshotResolved)),e[u].unwatcher();Ii(n,Or(n.transactionQueueTree_,t)),zr(n,n.transactionQueueTree_),ie(n.eventQueue_,t,h);for(let u=0;u<d.length;u++)Nt(d[u])}else{if(c==="datastale")for(let d=0;d<e.length;d++)e[d].status===3?e[d].status=4:e[d].status=0;else{G("transaction at "+l.toString()+" failed: "+c);for(let d=0;d<e.length;d++)e[d].status=4,e[d].abortReason=c}kt(n,t)}},o)}function kt(n,t){let e=lc(n,t),i=En(e),s=cc(n,e);return kf(n,s,i),i}function kf(n,t,e){if(t.length===0)return;let i=[],s=[],o=t.filter(a=>a.status===0).map(a=>a.currentWriteId);for(let a=0;a<t.length;a++){let l=t[a],c=$(e,l.path),h=!1,d;if(f(c!==null,"rerunTransactionsUnderNode_: relativePath should not be null."),l.status===4)h=!0,d=l.abortReason,s=s.concat(Fe(n.serverSyncTree_,l.currentWriteId,!0));else if(l.status===0)if(l.retryCount>=vf)h=!0,d="maxretry",s=s.concat(Fe(n.serverSyncTree_,l.currentWriteId,!0));else{let u=ac(n,l.path,o);l.currentInputSnapshot=u;let p=t[a].update(u.val());if(p!==void 0){Ti("transaction failed: Data returned ",p,l.path);let m=L(p);typeof p=="object"&&p!=null&&le(p,".priority")||(m=m.updatePriority(u.getPriority()));let R=l.currentWriteId,O=Ri(n),We=Xl(m,u,O);l.currentOutputSnapshotRaw=m,l.currentOutputSnapshotResolved=We,l.currentWriteId=Br(n),o.splice(o.indexOf(R),1),s=s.concat($l(n.serverSyncTree_,l.path,We,l.currentWriteId,l.applyLocally)),s=s.concat(Fe(n.serverSyncTree_,R,!0))}else h=!0,d="nodata",s=s.concat(Fe(n.serverSyncTree_,l.currentWriteId,!0))}ie(n.eventQueue_,e,s),s=[],h&&(t[a].status=2,function(u){setTimeout(u,Math.floor(0))}(t[a].unwatcher),t[a].onComplete&&(d==="nodata"?i.push(()=>t[a].onComplete(null,!1,t[a].currentInputSnapshot)):i.push(()=>t[a].onComplete(new Error(d),!1,null))))}Ii(n,n.transactionQueueTree_);for(let a=0;a<i.length;a++)Nt(i[a]);zr(n,n.transactionQueueTree_)}function lc(n,t){let e,i=n.transactionQueueTree_;for(e=v(t);e!==null&&At(i)===void 0;)i=Or(i,e),t=x(t),e=v(t);return i}function cc(n,t){let e=[];return dc(n,t,e),e.sort((i,s)=>i.order-s.order),e}function dc(n,t,e){let i=At(t);if(i)for(let s=0;s<i.length;s++)e.push(i[s]);Si(t,s=>{dc(n,s,e)})}function Ii(n,t){let e=At(t);if(e){let i=0;for(let s=0;s<e.length;s++)e[s].status!==2&&(e[i]=e[s],i++);e.length=i,Jl(t,e.length>0?e:void 0)}Si(t,i=>{Ii(n,i)})}function Hr(n,t){let e=En(lc(n,t)),i=Or(n.transactionQueueTree_,t);return af(i,s=>{vs(n,s)}),vs(n,i),ec(i,s=>{vs(n,s)}),e}function vs(n,t){let e=At(t);if(e){let i=[],s=[],r=-1;for(let o=0;o<e.length;o++)e[o].status===3||(e[o].status===1?(f(r===o-1,"All SENT items should be at beginning of queue."),r=o,e[o].status=3,e[o].abortReason="set"):(f(e[o].status===0,"Unexpected transaction status in abort"),e[o].unwatcher(),s=s.concat(Fe(n.serverSyncTree_,e[o].currentWriteId,!0)),e[o].onComplete&&i.push(e[o].onComplete.bind(null,new Error("set"),!1,null))));r===-1?Jl(t,void 0):e.length=r+1,ie(n.eventQueue_,En(t),s);for(let o=0;o<i.length;o++)Nt(i[o])}}function xf(n){let t="",e=n.split("/");for(let i=0;i<e.length;i++)if(e[i].length>0){let s=e[i];try{s=decodeURIComponent(s.replace(/\+/g," "))}catch{}t+="/"+s}return t}function Nf(n){let t={};n.charAt(0)==="?"&&(n=n.substring(1));for(let e of n.split("&")){if(e.length===0)continue;let i=e.split("=");i.length===2?t[decodeURIComponent(i[0])]=decodeURIComponent(i[1]):G(`Invalid query segment '${e}' in query '${n}'`)}return t}var il=function(n,t){let e=Pf(n),i=e.namespace;e.domain==="firebase.com"&&De(e.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),(!i||i==="undefined")&&e.domain!=="localhost"&&De("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),e.secure||lh();let s=e.scheme==="ws"||e.scheme==="wss";return{repoInfo:new Jn(e.host,e.secure,i,s,t,"",i!==e.subdomain),path:new D(e.pathString)}},Pf=function(n){let t="",e="",i="",s="",r="",o=!0,a="https",l=443;if(typeof n=="string"){let c=n.indexOf("//");c>=0&&(a=n.substring(0,c-1),n=n.substring(c+2));let h=n.indexOf("/");h===-1&&(h=n.length);let d=n.indexOf("?");d===-1&&(d=n.length),t=n.substring(0,Math.min(h,d)),h<d&&(s=xf(n.substring(h,d)));let u=Nf(n.substring(Math.min(n.length,d)));c=t.indexOf(":"),c>=0?(o=a==="https"||a==="wss",l=parseInt(t.substring(c+1),10)):c=t.length;let p=t.slice(0,c);if(p.toLowerCase()==="localhost")e="localhost";else if(p.split(".").length<=2)e=p;else{let m=t.indexOf(".");i=t.substring(0,m).toLowerCase(),e=t.substring(m+1),r=i}"ns"in u&&(r=u.ns)}return{host:t,port:l,domain:e,subdomain:i,secure:o,scheme:a,pathString:s,namespace:r}};var sl="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",Af=function(){let n=0,t=[];return function(e){let i=e===n;n=e;let s,r=new Array(8);for(s=7;s>=0;s--)r[s]=sl.charAt(e%64),e=Math.floor(e/64);f(e===0,"Cannot push at time == 0");let o=r.join("");if(i){for(s=11;s>=0&&t[s]===63;s--)t[s]=0;t[s]++}else for(s=0;s<12;s++)t[s]=Math.floor(Math.random()*64);for(s=0;s<12;s++)o+=sl.charAt(t[s]);return f(o.length===20,"nextPushId: Length should be 20."),o}}();var gi=class{constructor(t,e,i,s){this.eventType=t,this.eventRegistration=e,this.snapshot=i,this.prevName=s}getPath(){let t=this.snapshot.ref;return this.eventType==="value"?t._path:t.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+F(this.snapshot.exportVal())}},yi=class{constructor(t,e,i){this.eventRegistration=t,this.error=e,this.path=i}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}};var mn=class{constructor(t,e){this.snapshotCallback=t,this.cancelCallback=e}onValue(t,e){this.snapshotCallback.call(null,t,e)}onCancel(t){return f(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,t)}get hasCancelCallback(){return!!this.cancelCallback}matches(t){return this.snapshotCallback===t.snapshotCallback||this.snapshotCallback.userCallback!==void 0&&this.snapshotCallback.userCallback===t.snapshotCallback.userCallback&&this.snapshotCallback.context===t.snapshotCallback.context}};var ur=class n{constructor(t,e,i,s){this._repo=t,this._path=e,this._queryParams=i,this._orderByCalled=s}get key(){return b(this._path)?null:vr(this._path)}get ref(){return new ge(this._repo,this._path)}get _queryIdentifier(){let t=ja(this._queryParams),e=gr(t);return e==="{}"?"default":e}get _queryObject(){return ja(this._queryParams)}isEqual(t){if(t=Ae(t),!(t instanceof n))return!1;let e=this._repo===t._repo,i=wr(this._path,t._path),s=this._queryIdentifier===t._queryIdentifier;return e&&i&&s}toJSON(){return this.toString()}toString(){return this._repo.toString()+Wh(this._path)}};var ge=class n extends ur{constructor(t,e){super(t,e,new Us,!1)}get parent(){let t=Sl(this._path);return t===null?null:new n(this._repo,t)}get root(){let t=this;for(;t.parent!==null;)t=t.parent;return t}},gn=class n{constructor(t,e,i){this._node=t,this.ref=e,this._index=i}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(t){let e=new D(t),i=xt(this.ref,t);return new n(this._node.getChild(e),i,P)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(t){return this._node.isLeafNode()?!1:!!this._node.forEachChild(this._index,(i,s)=>t(new n(s,xt(this.ref,i),P)))}hasChild(t){let e=new D(t);return!this._node.getChild(e).isEmpty()}hasChildren(){return this._node.isLeafNode()?!1:!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}};function hc(n,t){return n=Ae(n),n._checkNotDeleted("ref"),t!==void 0?xt(n._root,t):n._root}function xt(n,t){return n=Ae(n),v(n._path)===null?_f("child","path",t,!1):ic("child","path",t,!1),new ge(n._repo,N(n._path,t))}function uc(n,t){n=Ae(n),Fr("push",n._path),nc("push",t,n._path,!0);let e=oc(n._repo),i=Af(e),s=xt(n,i),r=xt(n,i),o;return t!=null?o=ki(r,t).then(()=>r):o=Promise.resolve(r),s.then=o.then.bind(o),s.catch=o.then.bind(o,void 0),s}function fc(n){return Fr("remove",n._path),ki(n,null)}function ki(n,t){n=Ae(n),Fr("set",n._path),nc("set",t,n._path,!1);let e=new Ee;return Ef(n._repo,n._path,t,null,e.wrapCallback(()=>{})),e.promise}function pc(n,t){pf("update",t,n._path,!1);let e=new Ee;return Sf(n._repo,n._path,t,e.wrapCallback(()=>{})),e.promise}function _c(n){n=Ae(n);let t=new mn(()=>{}),e=new yn(t);return bf(n._repo,n,e).then(i=>new gn(i,new ge(n._repo,n._path),n._queryParams.getIndex()))}var yn=class n{constructor(t){this.callbackContext=t}respondsTo(t){return t==="value"}createEvent(t,e){let i=e._queryParams.getIndex();return new gi("value",this,new gn(t.snapshotNode,new ge(e._repo,e._path),i))}getEventRunner(t){return t.getEventType()==="cancel"?()=>this.callbackContext.onCancel(t.error):()=>this.callbackContext.onValue(t.snapshot,null)}createCancelEvent(t,e){return this.callbackContext.hasCancelCallback?new yi(this,t,e):null}matches(t){return t instanceof n?!t.callbackContext||!this.callbackContext?!0:t.callbackContext.matches(this.callbackContext):!1}hasAnyCallback(){return this.callbackContext!==null}},vi=class n{constructor(t,e){this.eventType=t,this.callbackContext=e}respondsTo(t){let e=t==="children_added"?"child_added":t;return e=e==="children_removed"?"child_removed":e,this.eventType===e}createCancelEvent(t,e){return this.callbackContext.hasCancelCallback?new yi(this,t,e):null}createEvent(t,e){f(t.childName!=null,"Child events should have a childName.");let i=xt(new ge(e._repo,e._path),t.childName),s=e._queryParams.getIndex();return new gi(t.type,this,new gn(t.snapshotNode,i,s),t.prevName)}getEventRunner(t){return t.getEventType()==="cancel"?()=>this.callbackContext.onCancel(t.error):()=>this.callbackContext.onValue(t.snapshot,t.prevName)}matches(t){return t instanceof n?this.eventType===t.eventType&&(!this.callbackContext||!t.callbackContext||this.callbackContext.matches(t.callbackContext)):!1}hasAnyCallback(){return!!this.callbackContext}};function Of(n,t,e,i,s){let r;if(typeof i=="object"&&(r=void 0,s=i),typeof i=="function"&&(r=i),s&&s.onlyOnce){let l=e,c=(h,d)=>{dr(n._repo,n,a),l(h,d)};c.userCallback=e.userCallback,c.context=e.context,e=c}let o=new mn(e,r||void 0),a=t==="value"?new yn(o):new vi(t,o);return Df(n._repo,n,a),()=>dr(n._repo,n,a)}function Wr(n,t,e,i){return Of(n,"value",t,e,i)}function Ur(n,t,e){let i=null,s=e?new mn(e):null;t==="value"?i=new yn(s):t&&(i=new vi(t,s)),dr(n._repo,n,i)}Bu(ge);Vu(ge);var Mf="FIREBASE_DATABASE_EMULATOR_HOST",fr={},Ff=!1;function Lf(n,t,e,i){n.repoInfo_=new Jn(`${t}:${e}`,!1,n.repoInfo_.namespace,n.repoInfo_.webSocketOnly,n.repoInfo_.nodeAdmin,n.repoInfo_.persistenceKey,n.repoInfo_.includeNamespaceInQueryParams,!0),i&&(n.authTokenProvider_=i)}function Bf(n,t,e,i,s){let r=i||n.options.databaseURL;r===void 0&&(n.options.projectId||De("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),H("Using default host for project ",n.options.projectId),r=`${n.options.projectId}-default-rtdb.firebaseio.com`);let o=il(r,s),a=o.repoInfo,l,c;typeof process<"u"&&process.env&&(c=process.env[Mf]),c?(l=!0,r=`http://${c}?ns=${a.namespace}`,o=il(r,s),a=o.repoInfo):l=!o.repoInfo.secure;let h=s&&l?new sn(sn.OWNER):new Ts(n.name,n.options,t);mf("Invalid Firebase Database URL",o),b(o.path)||De("Database URL must point to the root of a Firebase Database (not including a child path).");let d=Hf(a,n,h,new Ss(n,e));return new pr(d,n)}function zf(n,t){let e=fr[t];(!e||e[n.key]!==n)&&De(`Database ${t}(${n.repoInfo_}) has already been deleted.`),Rf(n),delete e[n.key]}function Hf(n,t,e,i){let s=fr[t.name];s||(s={},fr[t.name]=s);let r=s[n.toURLString()];return r&&De("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),r=new cr(n,Ff,e,i),s[n.toURLString()]=r,r}var pr=class{constructor(t,e){this._repoInternal=t,this.app=e,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(wf(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new ge(this._repo,S())),this._rootInternal}_delete(){return this._rootInternal!==null&&(zf(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(t){this._rootInternal===null&&De("Cannot call "+t+" on a deleted database.")}};function mc(n=Sa(),t){let e=Ca(n,"database").getImmediate({identifier:t});if(!e._instanceStarted){let i=Zo("database");i&&Wf(e,...i)}return e}function Wf(n,t,e,i={}){n=Ae(n),n._checkNotDeleted("useEmulator"),n._instanceStarted&&De("Cannot call useEmulator() after instance has already been initialized.");let s=n._repoInternal,r;if(s.repoInfo_.nodeAdmin)i.mockUserToken&&De('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),r=new sn(sn.OWNER);else if(i.mockUserToken){let o=typeof i.mockUserToken=="string"?i.mockUserToken:ea(i.mockUserToken,n.app.options.projectId);r=new sn(o)}Lf(s,t,e,r)}function Uf(n){rh(Ea),qt(new Se("database",(t,{instanceIdentifier:e})=>{let i=t.getProvider("app").getImmediate(),s=t.getProvider("auth-internal"),r=t.getProvider("app-check-internal");return Bf(i,s,r,e)},"PUBLIC").setMultipleInstances(!0)),Me(Ra,Ia,n),Me(Ra,Ia,"esm2017")}Cr.prototype.simpleListen=function(n,t){this.sendRequest("q",{p:n},t)};Cr.prototype.echo=function(n,t){this.sendRequest("echo",{d:n},t)};Uf();var gc=(()=>{class n{config=_(ko).firebase||{};app=us(this.config);db=mc(this.app);subscriptions=new Map;ngOnDestroy(){this.subscriptions.forEach(e=>e()),this.subscriptions.clear()}dbRef(e){return hc(this.db,e)}create(e,i,s){return Wi(()=>{let r=s?this.dbRef(`${e}/${s}`):uc(this.dbRef(e)),o=s||r.key;if(!o)return lt(()=>new Error("Failed to generate a key for the new record."));let a=Rn(ye({},i),{id:o});return Lt(ki(r,a)).pipe(Re(()=>a),Bt(l=>(console.error("Error creating record:",l),lt(()=>l))))})}read(e){return Lt(_c(this.dbRef(e))).pipe(Re(i=>i.exists()?i.val():null),Bt(i=>(console.error("Error reading data:",i),lt(()=>i))))}readById(e,i){let s=`${e}/${i}`;return this.read(s)}update(e,i,s){let r=`${e}/${i}`;return Lt(pc(this.dbRef(r),s)).pipe(no(()=>this.read(r)),Re(o=>{if(!o)throw new Error(`Data at path ${r} was unexpectedly null after update.`);return o}),Bt(o=>(console.error("Error updating record:",o),lt(()=>o))))}delete(e,i){let s=`${e}/${i}`;return Lt(fc(this.dbRef(s))).pipe(Bt(r=>(console.error("Error deleting record:",r),lt(()=>r))))}listen(e){return new Hi(i=>{let s=this.dbRef(e),r=Wr(s,o=>{let a=o.exists()?o.val():null;i.next(a)},o=>{i.error(o)});return this.subscriptions.set(e,()=>Ur(s,"value",r)),()=>{this.subscriptions.get(e)?.(),this.subscriptions.delete(e)}})}listenWithDefer(e){return Wi(()=>new Hi(i=>{let s=this.dbRef(e),r=Wr(s,o=>{let a=o.exists()?o.val():null;i.next(a)},o=>{i.error(o)});return this.subscriptions.set(e,()=>Ur(s,"value",r)),()=>{this.subscriptions.get(e)?.(),this.subscriptions.delete(e)}}))}static \u0275fac=function(i){return new(i||n)};static \u0275prov=ct({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();var jf=["tooltip"],wc=20;var Cc=new ve("mat-tooltip-scroll-strategy",{providedIn:"root",factory:()=>{let n=_(Un);return()=>n.scrollStrategies.reposition({scrollThrottle:wc})}});function $f(n){return()=>n.scrollStrategies.reposition({scrollThrottle:wc})}var Gf={provide:Cc,deps:[Un],useFactory:$f};function Qf(){return{showDelay:0,hideDelay:0,touchendHideDelay:1500}}var Yf=new ve("mat-tooltip-default-options",{providedIn:"root",factory:Qf});var yc="tooltip-panel",vc=wo({passive:!0}),qf=8,Kf=8,Xf=24,Jf=200,bc=(()=>{class n{_overlay=_(Un);_elementRef=_(J);_scrollDispatcher=_(Oo);_viewContainerRef=_(ke);_ngZone=_(Pn);_platform=_(Fn);_ariaDescriber=_(Eo);_focusMonitor=_(So);_dir=_(Ln);_injector=_(xn);_defaultOptions=_(Yf,{optional:!0});_overlayRef;_tooltipInstance;_portal;_position="below";_positionAtOrigin=!1;_disabled=!1;_tooltipClass;_scrollStrategy=_(Cc);_viewInitialized=!1;_pointerExitEventsInitialized=!1;_tooltipComponent=Zf;_viewportMargin=8;_currentPosition;_cssClassPrefix="mat-mdc";_ariaDescriptionPending;_dirSubscribed=!1;get position(){return this._position}set position(e){e!==this._position&&(this._position=e,this._overlayRef&&(this._updatePosition(this._overlayRef),this._tooltipInstance?.show(0),this._overlayRef.updatePosition()))}get positionAtOrigin(){return this._positionAtOrigin}set positionAtOrigin(e){this._positionAtOrigin=$i(e),this._detach(),this._overlayRef=null}get disabled(){return this._disabled}set disabled(e){let i=$i(e);this._disabled!==i&&(this._disabled=i,i?this.hide(0):this._setupPointerEnterEventsIfNeeded(),this._syncAriaDescription(this.message))}get showDelay(){return this._showDelay}set showDelay(e){this._showDelay=Gi(e)}_showDelay;get hideDelay(){return this._hideDelay}set hideDelay(e){this._hideDelay=Gi(e),this._tooltipInstance&&(this._tooltipInstance._mouseLeaveHideDelay=this._hideDelay)}_hideDelay;touchGestures="auto";get message(){return this._message}set message(e){let i=this._message;this._message=e!=null?String(e).trim():"",!this._message&&this._isTooltipVisible()?this.hide(0):(this._setupPointerEnterEventsIfNeeded(),this._updateTooltipMessage()),this._syncAriaDescription(i)}_message="";get tooltipClass(){return this._tooltipClass}set tooltipClass(e){this._tooltipClass=e,this._tooltipInstance&&this._setTooltipClass(this._tooltipClass)}_passiveListeners=[];_document=_(Mn);_touchstartTimeout=null;_destroyed=new se;_isDestroyed=!1;constructor(){let e=this._defaultOptions;e&&(this._showDelay=e.showDelay,this._hideDelay=e.hideDelay,e.position&&(this.position=e.position),e.positionAtOrigin&&(this.positionAtOrigin=e.positionAtOrigin),e.touchGestures&&(this.touchGestures=e.touchGestures),e.tooltipClass&&(this.tooltipClass=e.tooltipClass)),this._viewportMargin=qf}ngAfterViewInit(){this._viewInitialized=!0,this._setupPointerEnterEventsIfNeeded(),this._focusMonitor.monitor(this._elementRef).pipe(X(this._destroyed)).subscribe(e=>{e?e==="keyboard"&&this._ngZone.run(()=>this.show()):this._ngZone.run(()=>this.hide(0))})}ngOnDestroy(){let e=this._elementRef.nativeElement;this._touchstartTimeout&&clearTimeout(this._touchstartTimeout),this._overlayRef&&(this._overlayRef.dispose(),this._tooltipInstance=null),this._passiveListeners.forEach(([i,s])=>{e.removeEventListener(i,s,vc)}),this._passiveListeners.length=0,this._destroyed.next(),this._destroyed.complete(),this._isDestroyed=!0,this._ariaDescriber.removeDescription(e,this.message,"tooltip"),this._focusMonitor.stopMonitoring(e)}show(e=this.showDelay,i){if(this.disabled||!this.message||this._isTooltipVisible()){this._tooltipInstance?._cancelPendingAnimations();return}let s=this._createOverlay(i);this._detach(),this._portal=this._portal||new jo(this._tooltipComponent,this._viewContainerRef);let r=this._tooltipInstance=s.attach(this._portal).instance;r._triggerElement=this._elementRef.nativeElement,r._mouseLeaveHideDelay=this._hideDelay,r.afterHidden().pipe(X(this._destroyed)).subscribe(()=>this._detach()),this._setTooltipClass(this._tooltipClass),this._updateTooltipMessage(),r.show(e)}hide(e=this.hideDelay){let i=this._tooltipInstance;i&&(i.isVisible()?i.hide(e):(i._cancelPendingAnimations(),this._detach()))}toggle(e){this._isTooltipVisible()?this.hide():this.show(void 0,e)}_isTooltipVisible(){return!!this._tooltipInstance&&this._tooltipInstance.isVisible()}_createOverlay(e){if(this._overlayRef){let r=this._overlayRef.getConfig().positionStrategy;if((!this.positionAtOrigin||!e)&&r._origin instanceof J)return this._overlayRef;this._detach()}let i=this._scrollDispatcher.getAncestorScrollContainers(this._elementRef),s=this._overlay.position().flexibleConnectedTo(this.positionAtOrigin?e||this._elementRef:this._elementRef).withTransformOriginOn(`.${this._cssClassPrefix}-tooltip`).withFlexibleDimensions(!1).withViewportMargin(this._viewportMargin).withScrollableContainers(i);return s.positionChanges.pipe(X(this._destroyed)).subscribe(r=>{this._updateCurrentPositionClass(r.connectionPair),this._tooltipInstance&&r.scrollableViewProperties.isOverlayClipped&&this._tooltipInstance.isVisible()&&this._ngZone.run(()=>this.hide(0))}),this._overlayRef=this._overlay.create({direction:this._dir,positionStrategy:s,panelClass:`${this._cssClassPrefix}-${yc}`,scrollStrategy:this._scrollStrategy()}),this._updatePosition(this._overlayRef),this._overlayRef.detachments().pipe(X(this._destroyed)).subscribe(()=>this._detach()),this._overlayRef.outsidePointerEvents().pipe(X(this._destroyed)).subscribe(()=>this._tooltipInstance?._handleBodyInteraction()),this._overlayRef.keydownEvents().pipe(X(this._destroyed)).subscribe(r=>{this._isTooltipVisible()&&r.keyCode===27&&!Co(r)&&(r.preventDefault(),r.stopPropagation(),this._ngZone.run(()=>this.hide(0)))}),this._defaultOptions?.disableTooltipInteractivity&&this._overlayRef.addPanelClass(`${this._cssClassPrefix}-tooltip-panel-non-interactive`),this._dirSubscribed||(this._dirSubscribed=!0,this._dir.change.pipe(X(this._destroyed)).subscribe(()=>{this._overlayRef&&this._updatePosition(this._overlayRef)})),this._overlayRef}_detach(){this._overlayRef&&this._overlayRef.hasAttached()&&this._overlayRef.detach(),this._tooltipInstance=null}_updatePosition(e){let i=e.getConfig().positionStrategy,s=this._getOrigin(),r=this._getOverlayPosition();i.withPositions([this._addOffset(ye(ye({},s.main),r.main)),this._addOffset(ye(ye({},s.fallback),r.fallback))])}_addOffset(e){let i=Kf,s=!this._dir||this._dir.value=="ltr";return e.originY==="top"?e.offsetY=-i:e.originY==="bottom"?e.offsetY=i:e.originX==="start"?e.offsetX=s?-i:i:e.originX==="end"&&(e.offsetX=s?i:-i),e}_getOrigin(){let e=!this._dir||this._dir.value=="ltr",i=this.position,s;i=="above"||i=="below"?s={originX:"center",originY:i=="above"?"top":"bottom"}:i=="before"||i=="left"&&e||i=="right"&&!e?s={originX:"start",originY:"center"}:(i=="after"||i=="right"&&e||i=="left"&&!e)&&(s={originX:"end",originY:"center"});let{x:r,y:o}=this._invertPosition(s.originX,s.originY);return{main:s,fallback:{originX:r,originY:o}}}_getOverlayPosition(){let e=!this._dir||this._dir.value=="ltr",i=this.position,s;i=="above"?s={overlayX:"center",overlayY:"bottom"}:i=="below"?s={overlayX:"center",overlayY:"top"}:i=="before"||i=="left"&&e||i=="right"&&!e?s={overlayX:"end",overlayY:"center"}:(i=="after"||i=="right"&&e||i=="left"&&!e)&&(s={overlayX:"start",overlayY:"center"});let{x:r,y:o}=this._invertPosition(s.overlayX,s.overlayY);return{main:s,fallback:{overlayX:r,overlayY:o}}}_updateTooltipMessage(){this._tooltipInstance&&(this._tooltipInstance.message=this.message,this._tooltipInstance._markForCheck(),Ht(()=>{this._tooltipInstance&&this._overlayRef.updatePosition()},{injector:this._injector}))}_setTooltipClass(e){this._tooltipInstance&&(this._tooltipInstance.tooltipClass=e,this._tooltipInstance._markForCheck())}_invertPosition(e,i){return this.position==="above"||this.position==="below"?i==="top"?i="bottom":i==="bottom"&&(i="top"):e==="end"?e="start":e==="start"&&(e="end"),{x:e,y:i}}_updateCurrentPositionClass(e){let{overlayY:i,originX:s,originY:r}=e,o;if(i==="center"?this._dir&&this._dir.value==="rtl"?o=s==="end"?"left":"right":o=s==="start"?"left":"right":o=i==="bottom"&&r==="top"?"above":"below",o!==this._currentPosition){let a=this._overlayRef;if(a){let l=`${this._cssClassPrefix}-${yc}-`;a.removePanelClass(l+this._currentPosition),a.addPanelClass(l+o)}this._currentPosition=o}}_setupPointerEnterEventsIfNeeded(){this._disabled||!this.message||!this._viewInitialized||this._passiveListeners.length||(this._platformSupportsMouseEvents()?this._passiveListeners.push(["mouseenter",e=>{this._setupPointerExitEventsIfNeeded();let i;e.x!==void 0&&e.y!==void 0&&(i=e),this.show(void 0,i)}]):this.touchGestures!=="off"&&(this._disableNativeGesturesIfNecessary(),this._passiveListeners.push(["touchstart",e=>{let i=e.targetTouches?.[0],s=i?{x:i.clientX,y:i.clientY}:void 0;this._setupPointerExitEventsIfNeeded(),this._touchstartTimeout&&clearTimeout(this._touchstartTimeout);let r=500;this._touchstartTimeout=setTimeout(()=>{this._touchstartTimeout=null,this.show(void 0,s)},this._defaultOptions?.touchLongPressShowDelay??r)}])),this._addListeners(this._passiveListeners))}_setupPointerExitEventsIfNeeded(){if(this._pointerExitEventsInitialized)return;this._pointerExitEventsInitialized=!0;let e=[];if(this._platformSupportsMouseEvents())e.push(["mouseleave",i=>{let s=i.relatedTarget;(!s||!this._overlayRef?.overlayElement.contains(s))&&this.hide()}],["wheel",i=>this._wheelListener(i)]);else if(this.touchGestures!=="off"){this._disableNativeGesturesIfNecessary();let i=()=>{this._touchstartTimeout&&clearTimeout(this._touchstartTimeout),this.hide(this._defaultOptions?.touchendHideDelay)};e.push(["touchend",i],["touchcancel",i])}this._addListeners(e),this._passiveListeners.push(...e)}_addListeners(e){e.forEach(([i,s])=>{this._elementRef.nativeElement.addEventListener(i,s,vc)})}_platformSupportsMouseEvents(){return!this._platform.IOS&&!this._platform.ANDROID}_wheelListener(e){if(this._isTooltipVisible()){let i=this._document.elementFromPoint(e.clientX,e.clientY),s=this._elementRef.nativeElement;i!==s&&!s.contains(i)&&this.hide()}}_disableNativeGesturesIfNecessary(){let e=this.touchGestures;if(e!=="off"){let i=this._elementRef.nativeElement,s=i.style;(e==="on"||i.nodeName!=="INPUT"&&i.nodeName!=="TEXTAREA")&&(s.userSelect=s.msUserSelect=s.webkitUserSelect=s.MozUserSelect="none"),(e==="on"||!i.draggable)&&(s.webkitUserDrag="none"),s.touchAction="none",s.webkitTapHighlightColor="transparent"}}_syncAriaDescription(e){this._ariaDescriptionPending||(this._ariaDescriptionPending=!0,this._ariaDescriber.removeDescription(this._elementRef.nativeElement,e,"tooltip"),this._isDestroyed||Ht({write:()=>{this._ariaDescriptionPending=!1,this.message&&!this.disabled&&this._ariaDescriber.describe(this._elementRef.nativeElement,this.message,"tooltip")}},{injector:this._injector}))}static \u0275fac=function(i){return new(i||n)};static \u0275dir=I({type:n,selectors:[["","matTooltip",""]],hostAttrs:[1,"mat-mdc-tooltip-trigger"],hostVars:2,hostBindings:function(i,s){i&2&&je("mat-mdc-tooltip-disabled",s.disabled)},inputs:{position:[0,"matTooltipPosition","position"],positionAtOrigin:[0,"matTooltipPositionAtOrigin","positionAtOrigin"],disabled:[0,"matTooltipDisabled","disabled"],showDelay:[0,"matTooltipShowDelay","showDelay"],hideDelay:[0,"matTooltipHideDelay","hideDelay"],touchGestures:[0,"matTooltipTouchGestures","touchGestures"],message:[0,"matTooltip","message"],tooltipClass:[0,"matTooltipClass","tooltipClass"]},exportAs:["matTooltip"]})}return n})(),Zf=(()=>{class n{_changeDetectorRef=_(ut);_elementRef=_(J);_isMultiline=!1;message;tooltipClass;_showTimeoutId;_hideTimeoutId;_triggerElement;_mouseLeaveHideDelay;_animationsDisabled;_tooltip;_closeOnInteraction=!1;_isVisible=!1;_onHide=new se;_showAnimation="mat-mdc-tooltip-show";_hideAnimation="mat-mdc-tooltip-hide";constructor(){let e=_(co,{optional:!0});this._animationsDisabled=e==="NoopAnimations"}show(e){this._hideTimeoutId!=null&&clearTimeout(this._hideTimeoutId),this._showTimeoutId=setTimeout(()=>{this._toggleVisibility(!0),this._showTimeoutId=void 0},e)}hide(e){this._showTimeoutId!=null&&clearTimeout(this._showTimeoutId),this._hideTimeoutId=setTimeout(()=>{this._toggleVisibility(!1),this._hideTimeoutId=void 0},e)}afterHidden(){return this._onHide}isVisible(){return this._isVisible}ngOnDestroy(){this._cancelPendingAnimations(),this._onHide.complete(),this._triggerElement=null}_handleBodyInteraction(){this._closeOnInteraction&&this.hide(0)}_markForCheck(){this._changeDetectorRef.markForCheck()}_handleMouseLeave({relatedTarget:e}){(!e||!this._triggerElement.contains(e))&&(this.isVisible()?this.hide(this._mouseLeaveHideDelay):this._finalizeAnimation(!1))}_onShow(){this._isMultiline=this._isTooltipMultiline(),this._markForCheck()}_isTooltipMultiline(){let e=this._elementRef.nativeElement.getBoundingClientRect();return e.height>Xf&&e.width>=Jf}_handleAnimationEnd({animationName:e}){(e===this._showAnimation||e===this._hideAnimation)&&this._finalizeAnimation(e===this._showAnimation)}_cancelPendingAnimations(){this._showTimeoutId!=null&&clearTimeout(this._showTimeoutId),this._hideTimeoutId!=null&&clearTimeout(this._hideTimeoutId),this._showTimeoutId=this._hideTimeoutId=void 0}_finalizeAnimation(e){e?this._closeOnInteraction=!0:this.isVisible()||this._onHide.next()}_toggleVisibility(e){let i=this._tooltip.nativeElement,s=this._showAnimation,r=this._hideAnimation;if(i.classList.remove(e?r:s),i.classList.add(e?s:r),this._isVisible!==e&&(this._isVisible=e,this._changeDetectorRef.markForCheck()),e&&!this._animationsDisabled&&typeof getComputedStyle=="function"){let o=getComputedStyle(i);(o.getPropertyValue("animation-duration")==="0s"||o.getPropertyValue("animation-name")==="none")&&(this._animationsDisabled=!0)}e&&this._onShow(),this._animationsDisabled&&(i.classList.add("_mat-animation-noopable"),this._finalizeAnimation(e))}static \u0275fac=function(i){return new(i||n)};static \u0275cmp=U({type:n,selectors:[["mat-tooltip-component"]],viewQuery:function(i,s){if(i&1&&Vi(jf,7),i&2){let r;oe(r=ae())&&(s._tooltip=r.first)}},hostAttrs:["aria-hidden","true"],hostBindings:function(i,s){i&1&&ue("mouseleave",function(o){return s._handleMouseLeave(o)})},decls:4,vars:4,consts:[["tooltip",""],[1,"mdc-tooltip","mat-mdc-tooltip",3,"animationend","ngClass"],[1,"mat-mdc-tooltip-surface","mdc-tooltip__surface"]],template:function(i,s){if(i&1){let r=ht();y(0,"div",1,0),ue("animationend",function(a){return Ue(r),Ve(s._handleAnimationEnd(a))}),y(2,"div",2),A(3),C()()}i&2&&(je("mdc-tooltip--multiline",s._isMultiline),M("ngClass",s.tooltipClass),E(3),Qe(s.message))},dependencies:[vo],styles:['.mat-mdc-tooltip{position:relative;transform:scale(0);display:inline-flex}.mat-mdc-tooltip::before{content:"";top:0;right:0;bottom:0;left:0;z-index:-1;position:absolute}.mat-mdc-tooltip-panel-below .mat-mdc-tooltip::before{top:-8px}.mat-mdc-tooltip-panel-above .mat-mdc-tooltip::before{bottom:-8px}.mat-mdc-tooltip-panel-right .mat-mdc-tooltip::before{left:-8px}.mat-mdc-tooltip-panel-left .mat-mdc-tooltip::before{right:-8px}.mat-mdc-tooltip._mat-animation-noopable{animation:none;transform:scale(1)}.mat-mdc-tooltip-surface{word-break:normal;overflow-wrap:anywhere;padding:4px 8px;min-width:40px;max-width:200px;min-height:24px;max-height:40vh;box-sizing:border-box;overflow:hidden;text-align:center;will-change:transform,opacity;background-color:var(--mdc-plain-tooltip-container-color, var(--mat-sys-inverse-surface));color:var(--mdc-plain-tooltip-supporting-text-color, var(--mat-sys-inverse-on-surface));border-radius:var(--mdc-plain-tooltip-container-shape, var(--mat-sys-corner-extra-small));font-family:var(--mdc-plain-tooltip-supporting-text-font, var(--mat-sys-body-small-font));font-size:var(--mdc-plain-tooltip-supporting-text-size, var(--mat-sys-body-small-size));font-weight:var(--mdc-plain-tooltip-supporting-text-weight, var(--mat-sys-body-small-weight));line-height:var(--mdc-plain-tooltip-supporting-text-line-height, var(--mat-sys-body-small-line-height));letter-spacing:var(--mdc-plain-tooltip-supporting-text-tracking, var(--mat-sys-body-small-tracking))}.mat-mdc-tooltip-surface::before{position:absolute;box-sizing:border-box;width:100%;height:100%;top:0;left:0;border:1px solid rgba(0,0,0,0);border-radius:inherit;content:"";pointer-events:none}.mdc-tooltip--multiline .mat-mdc-tooltip-surface{text-align:left}[dir=rtl] .mdc-tooltip--multiline .mat-mdc-tooltip-surface{text-align:right}.mat-mdc-tooltip-panel{line-height:normal}.mat-mdc-tooltip-panel.mat-mdc-tooltip-panel-non-interactive{pointer-events:none}@keyframes mat-mdc-tooltip-show{0%{opacity:0;transform:scale(0.8)}100%{opacity:1;transform:scale(1)}}@keyframes mat-mdc-tooltip-hide{0%{opacity:1;transform:scale(1)}100%{opacity:0;transform:scale(0.8)}}.mat-mdc-tooltip-show{animation:mat-mdc-tooltip-show 150ms cubic-bezier(0, 0, 0.2, 1) forwards}.mat-mdc-tooltip-hide{animation:mat-mdc-tooltip-hide 75ms cubic-bezier(0.4, 0, 1, 1) forwards}'],encapsulation:2,changeDetection:0})}return n})();var Ec=(()=>{class n{static \u0275fac=function(i){return new(i||n)};static \u0275mod=xe({type:n});static \u0275inj=Ie({providers:[Gf],imports:[To,$o,pt,pt,Fo]})}return n})();function ep(n,t){if(n&1&&(y(0,"mat-option",17),A(1),C()),n&2){let e=t.$implicit;M("value",e),E(),Pe(" ",e," ")}}function tp(n,t){if(n&1){let e=ht();y(0,"mat-form-field",14)(1,"mat-select",16,0),ue("selectionChange",function(s){Ue(e);let r=j(2);return Ve(r._changePageSize(s.value))}),fo(3,ep,2,2,"mat-option",17,uo),C(),y(5,"div",18),ue("click",function(){Ue(e);let s=go(2);return Ve(s.open())}),C()()}if(n&2){let e=j(2);M("appearance",e._formFieldAppearance)("color",e.color),E(),M("value",e.pageSize)("disabled",e.disabled)("aria-labelledby",e._pageSizeLabelId)("panelClass",e.selectConfig.panelClass||"")("disableOptionCentering",e.selectConfig.disableOptionCentering),E(2),po(e._displayedPageSizeOptions)}}function np(n,t){if(n&1&&(y(0,"div",15),A(1),C()),n&2){let e=j(2);E(),Qe(e.pageSize)}}function ip(n,t){if(n&1&&(y(0,"div",3)(1,"div",13),A(2),C(),z(3,tp,6,7,"mat-form-field",14)(4,np,2,1,"div",15),C()),n&2){let e=j();E(),dt("id",e._pageSizeLabelId),E(),Pe(" ",e._intl.itemsPerPageLabel," "),E(),Y(e._displayedPageSizeOptions.length>1?3:-1),E(),Y(e._displayedPageSizeOptions.length<=1?4:-1)}}function sp(n,t){if(n&1){let e=ht();y(0,"button",19),ue("click",function(){Ue(e);let s=j();return Ve(s._buttonClicked(0,s._previousButtonsDisabled()))}),zt(),y(1,"svg",8),Z(2,"path",20),C()()}if(n&2){let e=j();M("matTooltip",e._intl.firstPageLabel)("matTooltipDisabled",e._previousButtonsDisabled())("disabled",e._previousButtonsDisabled()),dt("aria-label",e._intl.firstPageLabel)}}function rp(n,t){if(n&1){let e=ht();y(0,"button",21),ue("click",function(){Ue(e);let s=j();return Ve(s._buttonClicked(s.getNumberOfPages()-1,s._nextButtonsDisabled()))}),zt(),y(1,"svg",8),Z(2,"path",22),C()()}if(n&2){let e=j();M("matTooltip",e._intl.lastPageLabel)("matTooltipDisabled",e._nextButtonsDisabled())("disabled",e._nextButtonsDisabled()),dt("aria-label",e._intl.lastPageLabel)}}var xi=(()=>{class n{changes=new se;itemsPerPageLabel="Items per page:";nextPageLabel="Next page";previousPageLabel="Previous page";firstPageLabel="First page";lastPageLabel="Last page";getRangeLabel=(e,i,s)=>{if(s==0||i==0)return`0 of ${s}`;s=Math.max(s,0);let r=e*i,o=r<s?Math.min(r+i,s):r+i;return`${r+1} \u2013 ${o} of ${s}`};static \u0275fac=function(i){return new(i||n)};static \u0275prov=ct({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();function op(n){return n||new xi}var ap={provide:xi,deps:[[new io,new so,xi]],useFactory:op},lp=50;var cp=new ve("MAT_PAGINATOR_DEFAULT_OPTIONS"),Mt=(()=>{class n{_intl=_(xi);_changeDetectorRef=_(ut);_formFieldAppearance;_pageSizeLabelId=_(Do).getId("mat-paginator-page-size-label-");_intlChanges;_isInitialized=!1;_initializedStream=new eo(1);color;get pageIndex(){return this._pageIndex}set pageIndex(e){this._pageIndex=Math.max(e||0,0),this._changeDetectorRef.markForCheck()}_pageIndex=0;get length(){return this._length}set length(e){this._length=e||0,this._changeDetectorRef.markForCheck()}_length=0;get pageSize(){return this._pageSize}set pageSize(e){this._pageSize=Math.max(e||0,0),this._updateDisplayedPageSizeOptions()}_pageSize;get pageSizeOptions(){return this._pageSizeOptions}set pageSizeOptions(e){this._pageSizeOptions=(e||[]).map(i=>Wt(i,0)),this._updateDisplayedPageSizeOptions()}_pageSizeOptions=[];hidePageSize=!1;showFirstLastButtons=!1;selectConfig={};disabled=!1;page=new Nn;_displayedPageSizeOptions;initialized=this._initializedStream;constructor(){let e=this._intl,i=_(cp,{optional:!0});if(this._intlChanges=e.changes.subscribe(()=>this._changeDetectorRef.markForCheck()),i){let{pageSize:s,pageSizeOptions:r,hidePageSize:o,showFirstLastButtons:a}=i;s!=null&&(this._pageSize=s),r!=null&&(this._pageSizeOptions=r),o!=null&&(this.hidePageSize=o),a!=null&&(this.showFirstLastButtons=a)}this._formFieldAppearance=i?.formFieldAppearance||"outline"}ngOnInit(){this._isInitialized=!0,this._updateDisplayedPageSizeOptions(),this._initializedStream.next()}ngOnDestroy(){this._initializedStream.complete(),this._intlChanges.unsubscribe()}nextPage(){this.hasNextPage()&&this._navigate(this.pageIndex+1)}previousPage(){this.hasPreviousPage()&&this._navigate(this.pageIndex-1)}firstPage(){this.hasPreviousPage()&&this._navigate(0)}lastPage(){this.hasNextPage()&&this._navigate(this.getNumberOfPages()-1)}hasPreviousPage(){return this.pageIndex>=1&&this.pageSize!=0}hasNextPage(){let e=this.getNumberOfPages()-1;return this.pageIndex<e&&this.pageSize!=0}getNumberOfPages(){return this.pageSize?Math.ceil(this.length/this.pageSize):0}_changePageSize(e){let i=this.pageIndex*this.pageSize,s=this.pageIndex;this.pageIndex=Math.floor(i/e)||0,this.pageSize=e,this._emitPageEvent(s)}_nextButtonsDisabled(){return this.disabled||!this.hasNextPage()}_previousButtonsDisabled(){return this.disabled||!this.hasPreviousPage()}_updateDisplayedPageSizeOptions(){this._isInitialized&&(this.pageSize||(this._pageSize=this.pageSizeOptions.length!=0?this.pageSizeOptions[0]:lp),this._displayedPageSizeOptions=this.pageSizeOptions.slice(),this._displayedPageSizeOptions.indexOf(this.pageSize)===-1&&this._displayedPageSizeOptions.push(this.pageSize),this._displayedPageSizeOptions.sort((e,i)=>e-i),this._changeDetectorRef.markForCheck())}_emitPageEvent(e){this.page.emit({previousPageIndex:e,pageIndex:this.pageIndex,pageSize:this.pageSize,length:this.length})}_navigate(e){let i=this.pageIndex;e!==i&&(this.pageIndex=e,this._emitPageEvent(i))}_buttonClicked(e,i){i||this._navigate(e)}static \u0275fac=function(i){return new(i||n)};static \u0275cmp=U({type:n,selectors:[["mat-paginator"]],hostAttrs:["role","group",1,"mat-mdc-paginator"],inputs:{color:"color",pageIndex:[2,"pageIndex","pageIndex",Wt],length:[2,"length","length",Wt],pageSize:[2,"pageSize","pageSize",Wt],pageSizeOptions:"pageSizeOptions",hidePageSize:[2,"hidePageSize","hidePageSize",K],showFirstLastButtons:[2,"showFirstLastButtons","showFirstLastButtons",K],selectConfig:"selectConfig",disabled:[2,"disabled","disabled",K]},outputs:{page:"page"},exportAs:["matPaginator"],features:[Ce],decls:14,vars:12,consts:[["selectRef",""],[1,"mat-mdc-paginator-outer-container"],[1,"mat-mdc-paginator-container"],[1,"mat-mdc-paginator-page-size"],[1,"mat-mdc-paginator-range-actions"],["aria-live","polite",1,"mat-mdc-paginator-range-label"],["mat-icon-button","","type","button","matTooltipPosition","above","disabledInteractive","",1,"mat-mdc-paginator-navigation-first",3,"matTooltip","matTooltipDisabled","disabled"],["mat-icon-button","","type","button","matTooltipPosition","above","disabledInteractive","",1,"mat-mdc-paginator-navigation-previous",3,"click","matTooltip","matTooltipDisabled","disabled"],["viewBox","0 0 24 24","focusable","false","aria-hidden","true",1,"mat-mdc-paginator-icon"],["d","M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"],["mat-icon-button","","type","button","matTooltipPosition","above","disabledInteractive","",1,"mat-mdc-paginator-navigation-next",3,"click","matTooltip","matTooltipDisabled","disabled"],["d","M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"],["mat-icon-button","","type","button","matTooltipPosition","above","disabledInteractive","",1,"mat-mdc-paginator-navigation-last",3,"matTooltip","matTooltipDisabled","disabled"],[1,"mat-mdc-paginator-page-size-label"],[1,"mat-mdc-paginator-page-size-select",3,"appearance","color"],[1,"mat-mdc-paginator-page-size-value"],["hideSingleSelectionIndicator","",3,"selectionChange","value","disabled","aria-labelledby","panelClass","disableOptionCentering"],[3,"value"],[1,"mat-mdc-paginator-touch-target",3,"click"],["mat-icon-button","","type","button","matTooltipPosition","above","disabledInteractive","",1,"mat-mdc-paginator-navigation-first",3,"click","matTooltip","matTooltipDisabled","disabled"],["d","M18.41 16.59L13.82 12l4.59-4.59L17 6l-6 6 6 6zM6 6h2v12H6z"],["mat-icon-button","","type","button","matTooltipPosition","above","disabledInteractive","",1,"mat-mdc-paginator-navigation-last",3,"click","matTooltip","matTooltipDisabled","disabled"],["d","M5.59 7.41L10.18 12l-4.59 4.59L7 18l6-6-6-6zM16 6h2v12h-2z"]],template:function(i,s){i&1&&(y(0,"div",1)(1,"div",2),z(2,ip,5,4,"div",3),y(3,"div",4)(4,"div",5),A(5),C(),z(6,sp,3,4,"button",6),y(7,"button",7),ue("click",function(){return s._buttonClicked(s.pageIndex-1,s._previousButtonsDisabled())}),zt(),y(8,"svg",8),Z(9,"path",9),C()(),ro(),y(10,"button",10),ue("click",function(){return s._buttonClicked(s.pageIndex+1,s._nextButtonsDisabled())}),zt(),y(11,"svg",8),Z(12,"path",11),C()(),z(13,rp,3,4,"button",12),C()()()),i&2&&(E(2),Y(s.hidePageSize?-1:2),E(3),Pe(" ",s._intl.getRangeLabel(s.pageIndex,s.pageSize,s.length)," "),E(),Y(s.showFirstLastButtons?6:-1),E(),M("matTooltip",s._intl.previousPageLabel)("matTooltipDisabled",s._previousButtonsDisabled())("disabled",s._previousButtonsDisabled()),dt("aria-label",s._intl.previousPageLabel),E(3),M("matTooltip",s._intl.nextPageLabel)("matTooltipDisabled",s._nextButtonsDisabled())("disabled",s._nextButtonsDisabled()),dt("aria-label",s._intl.nextPageLabel),E(3),Y(s.showFirstLastButtons?13:-1))},dependencies:[Io,Go,Ro,No,bc],styles:[".mat-mdc-paginator{display:block;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;color:var(--mat-paginator-container-text-color, var(--mat-sys-on-surface));background-color:var(--mat-paginator-container-background-color, var(--mat-sys-surface));font-family:var(--mat-paginator-container-text-font, var(--mat-sys-body-small-font));line-height:var(--mat-paginator-container-text-line-height, var(--mat-sys-body-small-line-height));font-size:var(--mat-paginator-container-text-size, var(--mat-sys-body-small-size));font-weight:var(--mat-paginator-container-text-weight, var(--mat-sys-body-small-weight));letter-spacing:var(--mat-paginator-container-text-tracking, var(--mat-sys-body-small-tracking));--mat-form-field-container-height:var(--mat-paginator-form-field-container-height, 40px);--mat-form-field-container-vertical-padding:var(--mat-paginator-form-field-container-vertical-padding, 8px)}.mat-mdc-paginator .mat-mdc-select-value{font-size:var(--mat-paginator-select-trigger-text-size, var(--mat-sys-body-small-size))}.mat-mdc-paginator .mat-mdc-form-field-subscript-wrapper{display:none}.mat-mdc-paginator .mat-mdc-select{line-height:1.5}.mat-mdc-paginator-outer-container{display:flex}.mat-mdc-paginator-container{display:flex;align-items:center;justify-content:flex-end;padding:0 8px;flex-wrap:wrap;width:100%;min-height:var(--mat-paginator-container-size, 56px)}.mat-mdc-paginator-page-size{display:flex;align-items:baseline;margin-right:8px}[dir=rtl] .mat-mdc-paginator-page-size{margin-right:0;margin-left:8px}.mat-mdc-paginator-page-size-label{margin:0 4px}.mat-mdc-paginator-page-size-select{margin:0 4px;width:84px}.mat-mdc-paginator-range-label{margin:0 32px 0 24px}.mat-mdc-paginator-range-actions{display:flex;align-items:center}.mat-mdc-paginator-icon{display:inline-block;width:28px;fill:var(--mat-paginator-enabled-icon-color, var(--mat-sys-on-surface-variant))}.mat-mdc-icon-button[aria-disabled] .mat-mdc-paginator-icon{fill:var(--mat-paginator-disabled-icon-color, color-mix(in srgb, var(--mat-sys-on-surface) 38%, transparent))}[dir=rtl] .mat-mdc-paginator-icon{transform:rotate(180deg)}@media(forced-colors: active){.mat-mdc-icon-button[disabled] .mat-mdc-paginator-icon,.mat-mdc-paginator-icon{fill:currentColor;fill:CanvasText}.mat-mdc-paginator-range-actions .mat-mdc-icon-button{outline:solid 1px}}.mat-mdc-paginator-touch-target{display:var(--mat-paginator-touch-target-display, block);position:absolute;top:50%;left:50%;width:84px;height:48px;background-color:rgba(0,0,0,0);transform:translate(-50%, -50%);cursor:pointer}"],encapsulation:2,changeDetection:0})}return n})(),Sc=(()=>{class n{static \u0275fac=function(i){return new(i||n)};static \u0275mod=xe({type:n});static \u0275inj=Ie({providers:[ap],imports:[_t,Qo,Ec,Mt]})}return n})();var fp=[[["caption"]],[["colgroup"],["col"]],"*"],pp=["caption","colgroup, col","*"];function _p(n,t){n&1&&Ne(0,2)}function mp(n,t){n&1&&(y(0,"thead",0),q(1,1),C(),y(2,"tbody",0),q(3,2)(4,3),C(),y(5,"tfoot",0),q(6,4),C())}function gp(n,t){n&1&&q(0,1)(1,2)(2,3)(3,4)}var he=new ve("CDK_TABLE");var Fi=(()=>{class n{template=_(we);constructor(){}static \u0275fac=function(i){return new(i||n)};static \u0275dir=I({type:n,selectors:[["","cdkCellDef",""]]})}return n})(),Li=(()=>{class n{template=_(we);constructor(){}static \u0275fac=function(i){return new(i||n)};static \u0275dir=I({type:n,selectors:[["","cdkHeaderCellDef",""]]})}return n})(),Rc=(()=>{class n{template=_(we);constructor(){}static \u0275fac=function(i){return new(i||n)};static \u0275dir=I({type:n,selectors:[["","cdkFooterCellDef",""]]})}return n})(),Ft=(()=>{class n{_table=_(he,{optional:!0});_hasStickyChanged=!1;get name(){return this._name}set name(e){this._setNameInput(e)}_name;get sticky(){return this._sticky}set sticky(e){e!==this._sticky&&(this._sticky=e,this._hasStickyChanged=!0)}_sticky=!1;get stickyEnd(){return this._stickyEnd}set stickyEnd(e){e!==this._stickyEnd&&(this._stickyEnd=e,this._hasStickyChanged=!0)}_stickyEnd=!1;cell;headerCell;footerCell;cssClassFriendlyName;_columnCssClassName;constructor(){}hasStickyChanged(){let e=this._hasStickyChanged;return this.resetStickyChanged(),e}resetStickyChanged(){this._hasStickyChanged=!1}_updateColumnCssClassName(){this._columnCssClassName=[`cdk-column-${this.cssClassFriendlyName}`]}_setNameInput(e){e&&(this._name=e,this.cssClassFriendlyName=e.replace(/[^a-z0-9_-]/gi,"-"),this._updateColumnCssClassName())}static \u0275fac=function(i){return new(i||n)};static \u0275dir=I({type:n,selectors:[["","cdkColumnDef",""]],contentQueries:function(i,s,r){if(i&1&&(be(r,Fi,5),be(r,Li,5),be(r,Rc,5)),i&2){let o;oe(o=ae())&&(s.cell=o.first),oe(o=ae())&&(s.headerCell=o.first),oe(o=ae())&&(s.footerCell=o.first)}},inputs:{name:[0,"cdkColumnDef","name"],sticky:[2,"sticky","sticky",K],stickyEnd:[2,"stickyEnd","stickyEnd",K]},features:[ee([{provide:"MAT_SORT_HEADER_COLUMN_DEF",useExisting:n}]),Ce]})}return n})(),Pi=class{constructor(t,e){e.nativeElement.classList.add(...t._columnCssClassName)}},Ic=(()=>{class n extends Pi{constructor(){super(_(Ft),_(J))}static \u0275fac=function(i){return new(i||n)};static \u0275dir=I({type:n,selectors:[["cdk-header-cell"],["th","cdk-header-cell",""]],hostAttrs:["role","columnheader",1,"cdk-header-cell"],features:[B]})}return n})();var kc=(()=>{class n extends Pi{constructor(){let e=_(Ft),i=_(J);super(e,i);let s=e._table?._getCellRole();s&&i.nativeElement.setAttribute("role",s)}static \u0275fac=function(i){return new(i||n)};static \u0275dir=I({type:n,selectors:[["cdk-cell"],["td","cdk-cell",""]],hostAttrs:[1,"cdk-cell"],features:[B]})}return n})(),Ai=class{tasks=[];endTasks=[]},Oi=new ve("_COALESCED_STYLE_SCHEDULER"),jr=(()=>{class n{_currentSchedule=null;_ngZone=_(Pn);constructor(){}schedule(e){this._createScheduleIfNeeded(),this._currentSchedule.tasks.push(e)}scheduleEnd(e){this._createScheduleIfNeeded(),this._currentSchedule.endTasks.push(e)}_createScheduleIfNeeded(){this._currentSchedule||(this._currentSchedule=new Ai,this._ngZone.runOutsideAngular(()=>queueMicrotask(()=>{for(;this._currentSchedule.tasks.length||this._currentSchedule.endTasks.length;){let e=this._currentSchedule;this._currentSchedule=new Ai;for(let i of e.tasks)i();for(let i of e.endTasks)i()}this._currentSchedule=null})))}static \u0275fac=function(i){return new(i||n)};static \u0275prov=ct({token:n,factory:n.\u0275fac})}return n})();var $r=(()=>{class n{template=_(we);_differs=_(ft);columns;_columnsDiffer;constructor(){}ngOnChanges(e){if(!this._columnsDiffer){let i=e.columns&&e.columns.currentValue||[];this._columnsDiffer=this._differs.find(i).create(),this._columnsDiffer.diff(i)}}getColumnsDiff(){return this._columnsDiffer.diff(this.columns)}extractCellTemplate(e){return this instanceof Tn?e.headerCell.template:this instanceof Gr?e.footerCell.template:e.cell.template}static \u0275fac=function(i){return new(i||n)};static \u0275dir=I({type:n,features:[kn]})}return n})(),Tn=(()=>{class n extends $r{_table=_(he,{optional:!0});_hasStickyChanged=!1;get sticky(){return this._sticky}set sticky(e){e!==this._sticky&&(this._sticky=e,this._hasStickyChanged=!0)}_sticky=!1;constructor(){super(_(we),_(ft))}ngOnChanges(e){super.ngOnChanges(e)}hasStickyChanged(){let e=this._hasStickyChanged;return this.resetStickyChanged(),e}resetStickyChanged(){this._hasStickyChanged=!1}static \u0275fac=function(i){return new(i||n)};static \u0275dir=I({type:n,selectors:[["","cdkHeaderRowDef",""]],inputs:{columns:[0,"cdkHeaderRowDef","columns"],sticky:[2,"cdkHeaderRowDefSticky","sticky",K]},features:[Ce,B,kn]})}return n})(),Gr=(()=>{class n extends $r{_table=_(he,{optional:!0});_hasStickyChanged=!1;get sticky(){return this._sticky}set sticky(e){e!==this._sticky&&(this._sticky=e,this._hasStickyChanged=!0)}_sticky=!1;constructor(){super(_(we),_(ft))}ngOnChanges(e){super.ngOnChanges(e)}hasStickyChanged(){let e=this._hasStickyChanged;return this.resetStickyChanged(),e}resetStickyChanged(){this._hasStickyChanged=!1}static \u0275fac=function(i){return new(i||n)};static \u0275dir=I({type:n,selectors:[["","cdkFooterRowDef",""]],inputs:{columns:[0,"cdkFooterRowDef","columns"],sticky:[2,"cdkFooterRowDefSticky","sticky",K]},features:[Ce,B,kn]})}return n})(),Bi=(()=>{class n extends $r{_table=_(he,{optional:!0});when;constructor(){super(_(we),_(ft))}static \u0275fac=function(i){return new(i||n)};static \u0275dir=I({type:n,selectors:[["","cdkRowDef",""]],inputs:{columns:[0,"cdkRowDefColumns","columns"],when:[0,"cdkRowDefWhen","when"]},features:[B]})}return n})(),rt=(()=>{class n{_viewContainer=_(ke);cells;context;static mostRecentCellOutlet=null;constructor(){n.mostRecentCellOutlet=this}ngOnDestroy(){n.mostRecentCellOutlet===this&&(n.mostRecentCellOutlet=null)}static \u0275fac=function(i){return new(i||n)};static \u0275dir=I({type:n,selectors:[["","cdkCellOutlet",""]]})}return n})(),Qr=(()=>{class n{static \u0275fac=function(i){return new(i||n)};static \u0275cmp=U({type:n,selectors:[["cdk-header-row"],["tr","cdk-header-row",""]],hostAttrs:["role","row",1,"cdk-header-row"],decls:1,vars:0,consts:[["cdkCellOutlet",""]],template:function(i,s){i&1&&q(0,0)},dependencies:[rt],encapsulation:2})}return n})();var Yr=(()=>{class n{static \u0275fac=function(i){return new(i||n)};static \u0275cmp=U({type:n,selectors:[["cdk-row"],["tr","cdk-row",""]],hostAttrs:["role","row",1,"cdk-row"],decls:1,vars:0,consts:[["cdkCellOutlet",""]],template:function(i,s){i&1&&q(0,0)},dependencies:[rt],encapsulation:2})}return n})(),xc=(()=>{class n{templateRef=_(we);_contentClassName="cdk-no-data-row";constructor(){}static \u0275fac=function(i){return new(i||n)};static \u0275dir=I({type:n,selectors:[["ng-template","cdkNoDataRow",""]]})}return n})(),Tc=["top","bottom","left","right"],Vr=class{_isNativeHtmlTable;_stickCellCss;direction;_coalescedStyleScheduler;_isBrowser;_needsPositionStickyOnElement;_positionListener;_tableInjector;_elemSizeCache=new WeakMap;_resizeObserver=globalThis?.ResizeObserver?new globalThis.ResizeObserver(t=>this._updateCachedSizes(t)):null;_updatedStickyColumnsParamsToReplay=[];_stickyColumnsReplayTimeout=null;_cachedCellWidths=[];_borderCellCss;_destroyed=!1;constructor(t,e,i,s,r=!0,o=!0,a,l){this._isNativeHtmlTable=t,this._stickCellCss=e,this.direction=i,this._coalescedStyleScheduler=s,this._isBrowser=r,this._needsPositionStickyOnElement=o,this._positionListener=a,this._tableInjector=l,this._borderCellCss={top:`${e}-border-elem-top`,bottom:`${e}-border-elem-bottom`,left:`${e}-border-elem-left`,right:`${e}-border-elem-right`}}clearStickyPositioning(t,e){(e.includes("left")||e.includes("right"))&&this._removeFromStickyColumnReplayQueue(t);let i=[];for(let s of t)s.nodeType===s.ELEMENT_NODE&&i.push(s,...Array.from(s.children));this._afterNextRender({write:()=>{for(let s of i)this._removeStickyStyle(s,e)}})}updateStickyColumns(t,e,i,s=!0,r=!0){if(r&&this._updateStickyColumnReplayQueue({rows:[...t],stickyStartStates:[...e],stickyEndStates:[...i]}),!t.length||!this._isBrowser||!(e.some(R=>R)||i.some(R=>R))){this._positionListener&&(this._positionListener.stickyColumnsUpdated({sizes:[]}),this._positionListener.stickyEndColumnsUpdated({sizes:[]}));return}let o=t[0],a=o.children.length,l=this.direction==="rtl",c=l?"right":"left",h=l?"left":"right",d=e.lastIndexOf(!0),u=i.indexOf(!0),p,m,T;this._afterNextRender({earlyRead:()=>{p=this._getCellWidths(o,s),m=this._getStickyStartColumnPositions(p,e),T=this._getStickyEndColumnPositions(p,i)},write:()=>{for(let R of t)for(let O=0;O<a;O++){let We=R.children[O];e[O]&&this._addStickyStyle(We,c,m[O],O===d),i[O]&&this._addStickyStyle(We,h,T[O],O===u)}this._positionListener&&p.some(R=>!!R)&&(this._positionListener.stickyColumnsUpdated({sizes:d===-1?[]:p.slice(0,d+1).map((R,O)=>e[O]?R:null)}),this._positionListener.stickyEndColumnsUpdated({sizes:u===-1?[]:p.slice(u).map((R,O)=>i[O+u]?R:null).reverse()}))}})}stickRows(t,e,i){if(!this._isBrowser)return;let s=i==="bottom"?t.slice().reverse():t,r=i==="bottom"?e.slice().reverse():e,o=[],a=[],l=[];this._afterNextRender({earlyRead:()=>{for(let c=0,h=0;c<s.length;c++){if(!r[c])continue;o[c]=h;let d=s[c];l[c]=this._isNativeHtmlTable?Array.from(d.children):[d];let u=this._retrieveElementSize(d).height;h+=u,a[c]=u}},write:()=>{let c=r.lastIndexOf(!0);for(let h=0;h<s.length;h++){if(!r[h])continue;let d=o[h],u=h===c;for(let p of l[h])this._addStickyStyle(p,i,d,u)}i==="top"?this._positionListener?.stickyHeaderRowsUpdated({sizes:a,offsets:o,elements:l}):this._positionListener?.stickyFooterRowsUpdated({sizes:a,offsets:o,elements:l})}})}updateStickyFooterContainer(t,e){this._isNativeHtmlTable&&this._afterNextRender({write:()=>{let i=t.querySelector("tfoot");i&&(e.some(s=>!s)?this._removeStickyStyle(i,["bottom"]):this._addStickyStyle(i,"bottom",0,!1))}})}destroy(){this._stickyColumnsReplayTimeout&&clearTimeout(this._stickyColumnsReplayTimeout),this._destroyed=!0}_removeStickyStyle(t,e){for(let s of e)t.style[s]="",t.classList.remove(this._borderCellCss[s]);Tc.some(s=>e.indexOf(s)===-1&&t.style[s])?t.style.zIndex=this._getCalculatedZIndex(t):(t.style.zIndex="",this._needsPositionStickyOnElement&&(t.style.position=""),t.classList.remove(this._stickCellCss))}_addStickyStyle(t,e,i,s){t.classList.add(this._stickCellCss),s&&t.classList.add(this._borderCellCss[e]),t.style[e]=`${i}px`,t.style.zIndex=this._getCalculatedZIndex(t),this._needsPositionStickyOnElement&&(t.style.cssText+="position: -webkit-sticky; position: sticky; ")}_getCalculatedZIndex(t){let e={top:100,bottom:10,left:1,right:1},i=0;for(let s of Tc)t.style[s]&&(i+=e[s]);return i?`${i}`:""}_getCellWidths(t,e=!0){if(!e&&this._cachedCellWidths.length)return this._cachedCellWidths;let i=[],s=t.children;for(let r=0;r<s.length;r++){let o=s[r];i.push(this._retrieveElementSize(o).width)}return this._cachedCellWidths=i,i}_getStickyStartColumnPositions(t,e){let i=[],s=0;for(let r=0;r<t.length;r++)e[r]&&(i[r]=s,s+=t[r]);return i}_getStickyEndColumnPositions(t,e){let i=[],s=0;for(let r=t.length;r>0;r--)e[r]&&(i[r]=s,s+=t[r]);return i}_retrieveElementSize(t){let e=this._elemSizeCache.get(t);if(e)return e;let i=t.getBoundingClientRect(),s={width:i.width,height:i.height};return this._resizeObserver&&(this._elemSizeCache.set(t,s),this._resizeObserver.observe(t,{box:"border-box"})),s}_updateStickyColumnReplayQueue(t){this._removeFromStickyColumnReplayQueue(t.rows),!this._stickyColumnsReplayTimeout&&this._updatedStickyColumnsParamsToReplay.push(t)}_removeFromStickyColumnReplayQueue(t){let e=new Set(t);for(let i of this._updatedStickyColumnsParamsToReplay)i.rows=i.rows.filter(s=>!e.has(s));this._updatedStickyColumnsParamsToReplay=this._updatedStickyColumnsParamsToReplay.filter(i=>!!i.rows.length)}_updateCachedSizes(t){let e=!1;for(let i of t){let s=i.borderBoxSize?.length?{width:i.borderBoxSize[0].inlineSize,height:i.borderBoxSize[0].blockSize}:{width:i.contentRect.width,height:i.contentRect.height};s.width!==this._elemSizeCache.get(i.target)?.width&&yp(i.target)&&(e=!0),this._elemSizeCache.set(i.target,s)}e&&this._updatedStickyColumnsParamsToReplay.length&&(this._stickyColumnsReplayTimeout&&clearTimeout(this._stickyColumnsReplayTimeout),this._stickyColumnsReplayTimeout=setTimeout(()=>{if(!this._destroyed){for(let i of this._updatedStickyColumnsParamsToReplay)this.updateStickyColumns(i.rows,i.stickyStartStates,i.stickyEndStates,!0,!1);this._updatedStickyColumnsParamsToReplay=[],this._stickyColumnsReplayTimeout=null}},0))}_afterNextRender(t){this._tableInjector?Ht(t,{injector:this._tableInjector}):this._coalescedStyleScheduler.schedule(()=>{t.earlyRead?.(),t.write()})}};function yp(n){return["cdk-cell","cdk-header-cell","cdk-footer-cell"].some(t=>n.classList.contains(t))}var Mi=new ve("CDK_SPL");var qr=(()=>{class n{viewContainer=_(ke);elementRef=_(J);constructor(){let e=_(he);e._rowOutlet=this,e._outletAssigned()}static \u0275fac=function(i){return new(i||n)};static \u0275dir=I({type:n,selectors:[["","rowOutlet",""]]})}return n})(),Kr=(()=>{class n{viewContainer=_(ke);elementRef=_(J);constructor(){let e=_(he);e._headerRowOutlet=this,e._outletAssigned()}static \u0275fac=function(i){return new(i||n)};static \u0275dir=I({type:n,selectors:[["","headerRowOutlet",""]]})}return n})(),Xr=(()=>{class n{viewContainer=_(ke);elementRef=_(J);constructor(){let e=_(he);e._footerRowOutlet=this,e._outletAssigned()}static \u0275fac=function(i){return new(i||n)};static \u0275dir=I({type:n,selectors:[["","footerRowOutlet",""]]})}return n})(),Jr=(()=>{class n{viewContainer=_(ke);elementRef=_(J);constructor(){let e=_(he);e._noDataRowOutlet=this,e._outletAssigned()}static \u0275fac=function(i){return new(i||n)};static \u0275dir=I({type:n,selectors:[["","noDataRowOutlet",""]]})}return n})();var Zr=(()=>{class n{_differs=_(ft);_changeDetectorRef=_(ut);_elementRef=_(J);_dir=_(Ln,{optional:!0});_platform=_(Fn);_viewRepeater=_(Ut);_coalescedStyleScheduler=_(Oi);_viewportRuler=_(Mo);_stickyPositioningListener=_(Mi,{optional:!0,skipSelf:!0});_document=_(Mn);_data;_onDestroy=new se;_renderRows;_renderChangeSubscription;_columnDefsByName=new Map;_rowDefs;_headerRowDefs;_footerRowDefs;_dataDiffer;_defaultRowDef;_customColumnDefs=new Set;_customRowDefs=new Set;_customHeaderRowDefs=new Set;_customFooterRowDefs=new Set;_customNoDataRow;_headerRowDefChanged=!0;_footerRowDefChanged=!0;_stickyColumnStylesNeedReset=!0;_forceRecalculateCellWidths=!0;_cachedRenderRowsMap=new Map;_isNativeHtmlTable;_stickyStyler;stickyCssClass="cdk-table-sticky";needsPositionStickyOnElement=!0;_isServer;_isShowingNoDataRow=!1;_hasAllOutlets=!1;_hasInitialized=!1;_getCellRole(){if(this._cellRoleInternal===void 0){let e=this._elementRef.nativeElement.getAttribute("role");return e==="grid"||e==="treegrid"?"gridcell":"cell"}return this._cellRoleInternal}_cellRoleInternal=void 0;get trackBy(){return this._trackByFn}set trackBy(e){this._trackByFn=e}_trackByFn;get dataSource(){return this._dataSource}set dataSource(e){this._dataSource!==e&&this._switchDataSource(e)}_dataSource;get multiTemplateDataRows(){return this._multiTemplateDataRows}set multiTemplateDataRows(e){this._multiTemplateDataRows=e,this._rowOutlet&&this._rowOutlet.viewContainer.length&&(this._forceRenderDataRows(),this.updateStickyColumnStyles())}_multiTemplateDataRows=!1;get fixedLayout(){return this._fixedLayout}set fixedLayout(e){this._fixedLayout=e,this._forceRecalculateCellWidths=!0,this._stickyColumnStylesNeedReset=!0}_fixedLayout=!1;contentChanged=new Nn;viewChange=new ot({start:0,end:Number.MAX_VALUE});_rowOutlet;_headerRowOutlet;_footerRowOutlet;_noDataRowOutlet;_contentColumnDefs;_contentRowDefs;_contentHeaderRowDefs;_contentFooterRowDefs;_noDataRow;_injector=_(xn);constructor(){_(new oo("role"),{optional:!0})||this._elementRef.nativeElement.setAttribute("role","table"),this._isServer=!this._platform.isBrowser,this._isNativeHtmlTable=this._elementRef.nativeElement.nodeName==="TABLE"}ngOnInit(){this._setupStickyStyler(),this._dataDiffer=this._differs.find([]).create((e,i)=>this.trackBy?this.trackBy(i.dataIndex,i.data):i),this._viewportRuler.change().pipe(X(this._onDestroy)).subscribe(()=>{this._forceRecalculateCellWidths=!0})}ngAfterContentInit(){this._hasInitialized=!0}ngAfterContentChecked(){this._canRender()&&this._render()}ngOnDestroy(){this._stickyStyler?.destroy(),[this._rowOutlet?.viewContainer,this._headerRowOutlet?.viewContainer,this._footerRowOutlet?.viewContainer,this._cachedRenderRowsMap,this._customColumnDefs,this._customRowDefs,this._customHeaderRowDefs,this._customFooterRowDefs,this._columnDefsByName].forEach(e=>{e?.clear()}),this._headerRowDefs=[],this._footerRowDefs=[],this._defaultRowDef=null,this._onDestroy.next(),this._onDestroy.complete(),Hn(this.dataSource)&&this.dataSource.disconnect(this)}renderRows(){this._renderRows=this._getAllRenderRows();let e=this._dataDiffer.diff(this._renderRows);if(!e){this._updateNoDataRow(),this.contentChanged.next();return}let i=this._rowOutlet.viewContainer;this._viewRepeater.applyChanges(e,i,(s,r,o)=>this._getEmbeddedViewArgs(s.item,o),s=>s.item.data,s=>{s.operation===Ao.INSERTED&&s.context&&this._renderCellTemplateForItem(s.record.item.rowDef,s.context)}),this._updateRowIndexContext(),e.forEachIdentityChange(s=>{let r=i.get(s.currentIndex);r.context.$implicit=s.item.data}),this._updateNoDataRow(),this.contentChanged.next(),this.updateStickyColumnStyles()}addColumnDef(e){this._customColumnDefs.add(e)}removeColumnDef(e){this._customColumnDefs.delete(e)}addRowDef(e){this._customRowDefs.add(e)}removeRowDef(e){this._customRowDefs.delete(e)}addHeaderRowDef(e){this._customHeaderRowDefs.add(e),this._headerRowDefChanged=!0}removeHeaderRowDef(e){this._customHeaderRowDefs.delete(e),this._headerRowDefChanged=!0}addFooterRowDef(e){this._customFooterRowDefs.add(e),this._footerRowDefChanged=!0}removeFooterRowDef(e){this._customFooterRowDefs.delete(e),this._footerRowDefChanged=!0}setNoDataRow(e){this._customNoDataRow=e}updateStickyHeaderRowStyles(){let e=this._getRenderedRows(this._headerRowOutlet);if(this._isNativeHtmlTable){let s=Dc(this._headerRowOutlet,"thead");s&&(s.style.display=e.length?"":"none")}let i=this._headerRowDefs.map(s=>s.sticky);this._stickyStyler.clearStickyPositioning(e,["top"]),this._stickyStyler.stickRows(e,i,"top"),this._headerRowDefs.forEach(s=>s.resetStickyChanged())}updateStickyFooterRowStyles(){let e=this._getRenderedRows(this._footerRowOutlet);if(this._isNativeHtmlTable){let s=Dc(this._footerRowOutlet,"tfoot");s&&(s.style.display=e.length?"":"none")}let i=this._footerRowDefs.map(s=>s.sticky);this._stickyStyler.clearStickyPositioning(e,["bottom"]),this._stickyStyler.stickRows(e,i,"bottom"),this._stickyStyler.updateStickyFooterContainer(this._elementRef.nativeElement,i),this._footerRowDefs.forEach(s=>s.resetStickyChanged())}updateStickyColumnStyles(){let e=this._getRenderedRows(this._headerRowOutlet),i=this._getRenderedRows(this._rowOutlet),s=this._getRenderedRows(this._footerRowOutlet);(this._isNativeHtmlTable&&!this._fixedLayout||this._stickyColumnStylesNeedReset)&&(this._stickyStyler.clearStickyPositioning([...e,...i,...s],["left","right"]),this._stickyColumnStylesNeedReset=!1),e.forEach((r,o)=>{this._addStickyColumnStyles([r],this._headerRowDefs[o])}),this._rowDefs.forEach(r=>{let o=[];for(let a=0;a<i.length;a++)this._renderRows[a].rowDef===r&&o.push(i[a]);this._addStickyColumnStyles(o,r)}),s.forEach((r,o)=>{this._addStickyColumnStyles([r],this._footerRowDefs[o])}),Array.from(this._columnDefsByName.values()).forEach(r=>r.resetStickyChanged())}_outletAssigned(){!this._hasAllOutlets&&this._rowOutlet&&this._headerRowOutlet&&this._footerRowOutlet&&this._noDataRowOutlet&&(this._hasAllOutlets=!0,this._canRender()&&this._render())}_canRender(){return this._hasAllOutlets&&this._hasInitialized}_render(){this._cacheRowDefs(),this._cacheColumnDefs(),!this._headerRowDefs.length&&!this._footerRowDefs.length&&this._rowDefs.length;let i=this._renderUpdatedColumns()||this._headerRowDefChanged||this._footerRowDefChanged;this._stickyColumnStylesNeedReset=this._stickyColumnStylesNeedReset||i,this._forceRecalculateCellWidths=i,this._headerRowDefChanged&&(this._forceRenderHeaderRows(),this._headerRowDefChanged=!1),this._footerRowDefChanged&&(this._forceRenderFooterRows(),this._footerRowDefChanged=!1),this.dataSource&&this._rowDefs.length>0&&!this._renderChangeSubscription?this._observeRenderChanges():this._stickyColumnStylesNeedReset&&this.updateStickyColumnStyles(),this._checkStickyStates()}_getAllRenderRows(){let e=[],i=this._cachedRenderRowsMap;this._cachedRenderRowsMap=new Map;for(let s=0;s<this._data.length;s++){let r=this._data[s],o=this._getRenderRowsForData(r,s,i.get(r));this._cachedRenderRowsMap.has(r)||this._cachedRenderRowsMap.set(r,new WeakMap);for(let a=0;a<o.length;a++){let l=o[a],c=this._cachedRenderRowsMap.get(l.data);c.has(l.rowDef)?c.get(l.rowDef).push(l):c.set(l.rowDef,[l]),e.push(l)}}return e}_getRenderRowsForData(e,i,s){return this._getRowDefs(e,i).map(o=>{let a=s&&s.has(o)?s.get(o):[];if(a.length){let l=a.shift();return l.dataIndex=i,l}else return{data:e,rowDef:o,dataIndex:i}})}_cacheColumnDefs(){this._columnDefsByName.clear(),Ni(this._getOwnDefs(this._contentColumnDefs),this._customColumnDefs).forEach(i=>{this._columnDefsByName.has(i.name),this._columnDefsByName.set(i.name,i)})}_cacheRowDefs(){this._headerRowDefs=Ni(this._getOwnDefs(this._contentHeaderRowDefs),this._customHeaderRowDefs),this._footerRowDefs=Ni(this._getOwnDefs(this._contentFooterRowDefs),this._customFooterRowDefs),this._rowDefs=Ni(this._getOwnDefs(this._contentRowDefs),this._customRowDefs);let e=this._rowDefs.filter(i=>!i.when);!this.multiTemplateDataRows&&e.length>1,this._defaultRowDef=e[0]}_renderUpdatedColumns(){let e=(o,a)=>{let l=!!a.getColumnsDiff();return o||l},i=this._rowDefs.reduce(e,!1);i&&this._forceRenderDataRows();let s=this._headerRowDefs.reduce(e,!1);s&&this._forceRenderHeaderRows();let r=this._footerRowDefs.reduce(e,!1);return r&&this._forceRenderFooterRows(),i||s||r}_switchDataSource(e){this._data=[],Hn(this.dataSource)&&this.dataSource.disconnect(this),this._renderChangeSubscription&&(this._renderChangeSubscription.unsubscribe(),this._renderChangeSubscription=null),e||(this._dataDiffer&&this._dataDiffer.diff([]),this._rowOutlet&&this._rowOutlet.viewContainer.clear()),this._dataSource=e}_observeRenderChanges(){if(!this.dataSource)return;let e;Hn(this.dataSource)?e=this.dataSource.connect(this):to(this.dataSource)?e=this.dataSource:Array.isArray(this.dataSource)&&(e=at(this.dataSource)),this._renderChangeSubscription=e.pipe(X(this._onDestroy)).subscribe(i=>{this._data=i||[],this.renderRows()})}_forceRenderHeaderRows(){this._headerRowOutlet.viewContainer.length>0&&this._headerRowOutlet.viewContainer.clear(),this._headerRowDefs.forEach((e,i)=>this._renderRow(this._headerRowOutlet,e,i)),this.updateStickyHeaderRowStyles()}_forceRenderFooterRows(){this._footerRowOutlet.viewContainer.length>0&&this._footerRowOutlet.viewContainer.clear(),this._footerRowDefs.forEach((e,i)=>this._renderRow(this._footerRowOutlet,e,i)),this.updateStickyFooterRowStyles()}_addStickyColumnStyles(e,i){let s=Array.from(i?.columns||[]).map(a=>{let l=this._columnDefsByName.get(a);return l}),r=s.map(a=>a.sticky),o=s.map(a=>a.stickyEnd);this._stickyStyler.updateStickyColumns(e,r,o,!this._fixedLayout||this._forceRecalculateCellWidths)}_getRenderedRows(e){let i=[];for(let s=0;s<e.viewContainer.length;s++){let r=e.viewContainer.get(s);i.push(r.rootNodes[0])}return i}_getRowDefs(e,i){if(this._rowDefs.length==1)return[this._rowDefs[0]];let s=[];if(this.multiTemplateDataRows)s=this._rowDefs.filter(r=>!r.when||r.when(i,e));else{let r=this._rowDefs.find(o=>o.when&&o.when(i,e))||this._defaultRowDef;r&&s.push(r)}return s.length,s}_getEmbeddedViewArgs(e,i){let s=e.rowDef,r={$implicit:e.data};return{templateRef:s.template,context:r,index:i}}_renderRow(e,i,s,r={}){let o=e.viewContainer.createEmbeddedView(i.template,r,s);return this._renderCellTemplateForItem(i,r),o}_renderCellTemplateForItem(e,i){for(let s of this._getCellTemplates(e))rt.mostRecentCellOutlet&&rt.mostRecentCellOutlet._viewContainer.createEmbeddedView(s,i);this._changeDetectorRef.markForCheck()}_updateRowIndexContext(){let e=this._rowOutlet.viewContainer;for(let i=0,s=e.length;i<s;i++){let o=e.get(i).context;o.count=s,o.first=i===0,o.last=i===s-1,o.even=i%2===0,o.odd=!o.even,this.multiTemplateDataRows?(o.dataIndex=this._renderRows[i].dataIndex,o.renderIndex=i):o.index=this._renderRows[i].dataIndex}}_getCellTemplates(e){return!e||!e.columns?[]:Array.from(e.columns,i=>{let s=this._columnDefsByName.get(i);return e.extractCellTemplate(s)})}_forceRenderDataRows(){this._dataDiffer.diff([]),this._rowOutlet.viewContainer.clear(),this.renderRows()}_checkStickyStates(){let e=(i,s)=>i||s.hasStickyChanged();this._headerRowDefs.reduce(e,!1)&&this.updateStickyHeaderRowStyles(),this._footerRowDefs.reduce(e,!1)&&this.updateStickyFooterRowStyles(),Array.from(this._columnDefsByName.values()).reduce(e,!1)&&(this._stickyColumnStylesNeedReset=!0,this.updateStickyColumnStyles())}_setupStickyStyler(){let e=this._dir?this._dir.value:"ltr";this._stickyStyler=new Vr(this._isNativeHtmlTable,this.stickyCssClass,e,this._coalescedStyleScheduler,this._platform.isBrowser,this.needsPositionStickyOnElement,this._stickyPositioningListener,this._injector),(this._dir?this._dir.change:at()).pipe(X(this._onDestroy)).subscribe(i=>{this._stickyStyler.direction=i,this.updateStickyColumnStyles()})}_getOwnDefs(e){return e.filter(i=>!i._table||i._table===this)}_updateNoDataRow(){let e=this._customNoDataRow||this._noDataRow;if(!e)return;let i=this._rowOutlet.viewContainer.length===0;if(i===this._isShowingNoDataRow)return;let s=this._noDataRowOutlet.viewContainer;if(i){let r=s.createEmbeddedView(e.templateRef),o=r.rootNodes[0];r.rootNodes.length===1&&o?.nodeType===this._document.ELEMENT_NODE&&(o.setAttribute("role","row"),o.classList.add(e._contentClassName))}else s.clear();this._isShowingNoDataRow=i,this._changeDetectorRef.markForCheck()}static \u0275fac=function(i){return new(i||n)};static \u0275cmp=U({type:n,selectors:[["cdk-table"],["table","cdk-table",""]],contentQueries:function(i,s,r){if(i&1&&(be(r,xc,5),be(r,Ft,5),be(r,Bi,5),be(r,Tn,5),be(r,Gr,5)),i&2){let o;oe(o=ae())&&(s._noDataRow=o.first),oe(o=ae())&&(s._contentColumnDefs=o),oe(o=ae())&&(s._contentRowDefs=o),oe(o=ae())&&(s._contentHeaderRowDefs=o),oe(o=ae())&&(s._contentFooterRowDefs=o)}},hostAttrs:[1,"cdk-table"],hostVars:2,hostBindings:function(i,s){i&2&&je("cdk-table-fixed-layout",s.fixedLayout)},inputs:{trackBy:"trackBy",dataSource:"dataSource",multiTemplateDataRows:[2,"multiTemplateDataRows","multiTemplateDataRows",K],fixedLayout:[2,"fixedLayout","fixedLayout",K]},outputs:{contentChanged:"contentChanged"},exportAs:["cdkTable"],features:[ee([{provide:he,useExisting:n},{provide:Ut,useClass:Wn},{provide:Oi,useClass:jr},{provide:Mi,useValue:null}]),Ce],ngContentSelectors:pp,decls:5,vars:2,consts:[["role","rowgroup"],["headerRowOutlet",""],["rowOutlet",""],["noDataRowOutlet",""],["footerRowOutlet",""]],template:function(i,s){i&1&&(An(fp),Ne(0),Ne(1,1),z(2,_p,1,0)(3,mp,7,0)(4,gp,4,0)),i&2&&(E(2),Y(s._isServer?2:-1),E(),Y(s._isNativeHtmlTable?3:4))},dependencies:[Kr,qr,Jr,Xr],styles:[".cdk-table-fixed-layout{table-layout:fixed}"],encapsulation:2})}return n})();function Ni(n,t){return n.concat(Array.from(t))}function Dc(n,t){let e=t.toUpperCase(),i=n.viewContainer.element.nativeElement;for(;i;){let s=i.nodeType===1?i.nodeName:null;if(s===e)return i;if(s==="TABLE")break;i=i.parentNode}return null}var Nc=(()=>{class n{static \u0275fac=function(i){return new(i||n)};static \u0275mod=xe({type:n});static \u0275inj=Ie({imports:[Lo]})}return n})();var vp=[[["caption"]],[["colgroup"],["col"]],"*"],wp=["caption","colgroup, col","*"];function Cp(n,t){n&1&&Ne(0,2)}function bp(n,t){n&1&&(y(0,"thead",0),q(1,1),C(),y(2,"tbody",2),q(3,3)(4,4),C(),y(5,"tfoot",0),q(6,5),C())}function Ep(n,t){n&1&&q(0,1)(1,3)(2,4)(3,5)}var Pc=(()=>{class n extends Zr{stickyCssClass="mat-mdc-table-sticky";needsPositionStickyOnElement=!1;static \u0275fac=(()=>{let e;return function(s){return(e||(e=re(n)))(s||n)}})();static \u0275cmp=U({type:n,selectors:[["mat-table"],["table","mat-table",""]],hostAttrs:[1,"mat-mdc-table","mdc-data-table__table"],hostVars:2,hostBindings:function(i,s){i&2&&je("mdc-table-fixed-layout",s.fixedLayout)},exportAs:["matTable"],features:[ee([{provide:Zr,useExisting:n},{provide:he,useExisting:n},{provide:Oi,useClass:jr},{provide:Ut,useClass:Wn},{provide:Mi,useValue:null}]),B],ngContentSelectors:wp,decls:5,vars:2,consts:[["role","rowgroup"],["headerRowOutlet",""],["role","rowgroup",1,"mdc-data-table__content"],["rowOutlet",""],["noDataRowOutlet",""],["footerRowOutlet",""]],template:function(i,s){i&1&&(An(vp),Ne(0),Ne(1,1),z(2,Cp,1,0)(3,bp,7,0)(4,Ep,4,0)),i&2&&(E(2),Y(s._isServer?2:-1),E(),Y(s._isNativeHtmlTable?3:4))},dependencies:[Kr,qr,Jr,Xr],styles:[".mat-mdc-table-sticky{position:sticky !important}mat-table{display:block}mat-header-row{min-height:56px}mat-row,mat-footer-row{min-height:48px}mat-row,mat-header-row,mat-footer-row{display:flex;border-width:0;border-bottom-width:1px;border-style:solid;align-items:center;box-sizing:border-box}mat-cell:first-of-type,mat-header-cell:first-of-type,mat-footer-cell:first-of-type{padding-left:24px}[dir=rtl] mat-cell:first-of-type:not(:only-of-type),[dir=rtl] mat-header-cell:first-of-type:not(:only-of-type),[dir=rtl] mat-footer-cell:first-of-type:not(:only-of-type){padding-left:0;padding-right:24px}mat-cell:last-of-type,mat-header-cell:last-of-type,mat-footer-cell:last-of-type{padding-right:24px}[dir=rtl] mat-cell:last-of-type:not(:only-of-type),[dir=rtl] mat-header-cell:last-of-type:not(:only-of-type),[dir=rtl] mat-footer-cell:last-of-type:not(:only-of-type){padding-right:0;padding-left:24px}mat-cell,mat-header-cell,mat-footer-cell{flex:1;display:flex;align-items:center;overflow:hidden;word-wrap:break-word;min-height:inherit}.mat-mdc-table{min-width:100%;border:0;border-spacing:0;table-layout:auto;white-space:normal;background-color:var(--mat-table-background-color, var(--mat-sys-surface))}.mdc-data-table__cell{box-sizing:border-box;overflow:hidden;text-align:left;text-overflow:ellipsis}[dir=rtl] .mdc-data-table__cell{text-align:right}.mdc-data-table__cell,.mdc-data-table__header-cell{padding:0 16px}.mat-mdc-header-row{-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;height:var(--mat-table-header-container-height, 56px);color:var(--mat-table-header-headline-color, var(--mat-sys-on-surface, rgba(0, 0, 0, 0.87)));font-family:var(--mat-table-header-headline-font, var(--mat-sys-title-small-font, Roboto, sans-serif));line-height:var(--mat-table-header-headline-line-height, var(--mat-sys-title-small-line-height));font-size:var(--mat-table-header-headline-size, var(--mat-sys-title-small-size, 14px));font-weight:var(--mat-table-header-headline-weight, var(--mat-sys-title-small-weight, 500))}.mat-mdc-row{height:var(--mat-table-row-item-container-height, 52px);color:var(--mat-table-row-item-label-text-color, var(--mat-sys-on-surface, rgba(0, 0, 0, 0.87)))}.mat-mdc-row,.mdc-data-table__content{-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;font-family:var(--mat-table-row-item-label-text-font, var(--mat-sys-body-medium-font, Roboto, sans-serif));line-height:var(--mat-table-row-item-label-text-line-height, var(--mat-sys-body-medium-line-height));font-size:var(--mat-table-row-item-label-text-size, var(--mat-sys-body-medium-size, 14px));font-weight:var(--mat-table-row-item-label-text-weight, var(--mat-sys-body-medium-weight))}.mat-mdc-footer-row{-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;height:var(--mat-table-footer-container-height, 52px);color:var(--mat-table-row-item-label-text-color, var(--mat-sys-on-surface, rgba(0, 0, 0, 0.87)));font-family:var(--mat-table-footer-supporting-text-font, var(--mat-sys-body-medium-font, Roboto, sans-serif));line-height:var(--mat-table-footer-supporting-text-line-height, var(--mat-sys-body-medium-line-height));font-size:var(--mat-table-footer-supporting-text-size, var(--mat-sys-body-medium-size, 14px));font-weight:var(--mat-table-footer-supporting-text-weight, var(--mat-sys-body-medium-weight));letter-spacing:var(--mat-table-footer-supporting-text-tracking, var(--mat-sys-body-medium-tracking))}.mat-mdc-header-cell{border-bottom-color:var(--mat-table-row-item-outline-color, var(--mat-sys-outline, rgba(0, 0, 0, 0.12)));border-bottom-width:var(--mat-table-row-item-outline-width, 1px);border-bottom-style:solid;letter-spacing:var(--mat-table-header-headline-tracking, var(--mat-sys-title-small-tracking));font-weight:inherit;line-height:inherit;box-sizing:border-box;text-overflow:ellipsis;overflow:hidden;outline:none;text-align:left}[dir=rtl] .mat-mdc-header-cell{text-align:right}.mdc-data-table__row:last-child>.mat-mdc-header-cell{border-bottom:none}.mat-mdc-cell{border-bottom-color:var(--mat-table-row-item-outline-color, var(--mat-sys-outline, rgba(0, 0, 0, 0.12)));border-bottom-width:var(--mat-table-row-item-outline-width, 1px);border-bottom-style:solid;letter-spacing:var(--mat-table-row-item-label-text-tracking, var(--mat-sys-body-medium-tracking));line-height:inherit}.mdc-data-table__row:last-child>.mat-mdc-cell{border-bottom:none}.mat-mdc-footer-cell{letter-spacing:var(--mat-table-row-item-label-text-tracking, var(--mat-sys-body-medium-tracking))}mat-row.mat-mdc-row,mat-header-row.mat-mdc-header-row,mat-footer-row.mat-mdc-footer-row{border-bottom:none}.mat-mdc-table tbody,.mat-mdc-table tfoot,.mat-mdc-table thead,.mat-mdc-cell,.mat-mdc-footer-cell,.mat-mdc-header-row,.mat-mdc-row,.mat-mdc-footer-row,.mat-mdc-table .mat-mdc-header-cell{background:inherit}.mat-mdc-table mat-header-row.mat-mdc-header-row,.mat-mdc-table mat-row.mat-mdc-row,.mat-mdc-table mat-footer-row.mat-mdc-footer-cell{height:unset}mat-header-cell.mat-mdc-header-cell,mat-cell.mat-mdc-cell,mat-footer-cell.mat-mdc-footer-cell{align-self:stretch}"],encapsulation:2})}return n})(),Ac=(()=>{class n extends Fi{static \u0275fac=(()=>{let e;return function(s){return(e||(e=re(n)))(s||n)}})();static \u0275dir=I({type:n,selectors:[["","matCellDef",""]],features:[ee([{provide:Fi,useExisting:n}]),B]})}return n})(),Oc=(()=>{class n extends Li{static \u0275fac=(()=>{let e;return function(s){return(e||(e=re(n)))(s||n)}})();static \u0275dir=I({type:n,selectors:[["","matHeaderCellDef",""]],features:[ee([{provide:Li,useExisting:n}]),B]})}return n})();var Mc=(()=>{class n extends Ft{get name(){return this._name}set name(e){this._setNameInput(e)}_updateColumnCssClassName(){super._updateColumnCssClassName(),this._columnCssClassName.push(`mat-column-${this.cssClassFriendlyName}`)}static \u0275fac=(()=>{let e;return function(s){return(e||(e=re(n)))(s||n)}})();static \u0275dir=I({type:n,selectors:[["","matColumnDef",""]],inputs:{name:[0,"matColumnDef","name"]},features:[ee([{provide:Ft,useExisting:n},{provide:"MAT_SORT_HEADER_COLUMN_DEF",useExisting:n}]),B]})}return n})(),Fc=(()=>{class n extends Ic{static \u0275fac=(()=>{let e;return function(s){return(e||(e=re(n)))(s||n)}})();static \u0275dir=I({type:n,selectors:[["mat-header-cell"],["th","mat-header-cell",""]],hostAttrs:["role","columnheader",1,"mat-mdc-header-cell","mdc-data-table__header-cell"],features:[B]})}return n})();var Lc=(()=>{class n extends kc{static \u0275fac=(()=>{let e;return function(s){return(e||(e=re(n)))(s||n)}})();static \u0275dir=I({type:n,selectors:[["mat-cell"],["td","mat-cell",""]],hostAttrs:[1,"mat-mdc-cell","mdc-data-table__cell"],features:[B]})}return n})();var Bc=(()=>{class n extends Tn{static \u0275fac=(()=>{let e;return function(s){return(e||(e=re(n)))(s||n)}})();static \u0275dir=I({type:n,selectors:[["","matHeaderRowDef",""]],inputs:{columns:[0,"matHeaderRowDef","columns"],sticky:[2,"matHeaderRowDefSticky","sticky",K]},features:[ee([{provide:Tn,useExisting:n}]),Ce,B]})}return n})();var zc=(()=>{class n extends Bi{static \u0275fac=(()=>{let e;return function(s){return(e||(e=re(n)))(s||n)}})();static \u0275dir=I({type:n,selectors:[["","matRowDef",""]],inputs:{columns:[0,"matRowDefColumns","columns"],when:[0,"matRowDefWhen","when"]},features:[ee([{provide:Bi,useExisting:n}]),B]})}return n})(),Hc=(()=>{class n extends Qr{static \u0275fac=(()=>{let e;return function(s){return(e||(e=re(n)))(s||n)}})();static \u0275cmp=U({type:n,selectors:[["mat-header-row"],["tr","mat-header-row",""]],hostAttrs:["role","row",1,"mat-mdc-header-row","mdc-data-table__header-row"],exportAs:["matHeaderRow"],features:[ee([{provide:Qr,useExisting:n}]),B],decls:1,vars:0,consts:[["cdkCellOutlet",""]],template:function(i,s){i&1&&q(0,0)},dependencies:[rt],encapsulation:2})}return n})();var Wc=(()=>{class n extends Yr{static \u0275fac=(()=>{let e;return function(s){return(e||(e=re(n)))(s||n)}})();static \u0275cmp=U({type:n,selectors:[["mat-row"],["tr","mat-row",""]],hostAttrs:["role","row",1,"mat-mdc-row","mdc-data-table__row"],exportAs:["matRow"],features:[ee([{provide:Yr,useExisting:n}]),B],decls:1,vars:0,consts:[["cdkCellOutlet",""]],template:function(i,s){i&1&&q(0,0)},dependencies:[rt],encapsulation:2})}return n})();var Uc=(()=>{class n{static \u0275fac=function(i){return new(i||n)};static \u0275mod=xe({type:n});static \u0275inj=Ie({imports:[pt,Nc,pt]})}return n})(),Sp=9007199254740991,Dn=class extends Po{_data;_renderData=new ot([]);_filter=new ot("");_internalPageChanges=new se;_renderChangesSubscription=null;filteredData;get data(){return this._data.value}set data(t){t=Array.isArray(t)?t:[],this._data.next(t),this._renderChangesSubscription||this._filterData(t)}get filter(){return this._filter.value}set filter(t){this._filter.next(t),this._renderChangesSubscription||this._filterData(this.data)}get sort(){return this._sort}set sort(t){this._sort=t,this._updateChangeSubscription()}_sort;get paginator(){return this._paginator}set paginator(t){this._paginator=t,this._updateChangeSubscription()}_paginator;sortingDataAccessor=(t,e)=>{let i=t[e];if(bo(i)){let s=Number(i);return s<Sp?s:i}return i};sortData=(t,e)=>{let i=e.active,s=e.direction;return!i||s==""?t:t.sort((r,o)=>{let a=this.sortingDataAccessor(r,i),l=this.sortingDataAccessor(o,i),c=typeof a,h=typeof l;c!==h&&(c==="number"&&(a+=""),h==="number"&&(l+=""));let d=0;return a!=null&&l!=null?a>l?d=1:a<l&&(d=-1):a!=null?d=1:l!=null&&(d=-1),d*(s=="asc"?1:-1)})};filterPredicate=(t,e)=>{let i=e.trim().toLowerCase();return Object.values(t).some(s=>`${s}`.toLowerCase().includes(i))};constructor(t=[]){super(),this._data=new ot(t),this._updateChangeSubscription()}_updateChangeSubscription(){let t=this._sort?Ui(this._sort.sortChange,this._sort.initialized):at(null),e=this._paginator?Ui(this._paginator.page,this._internalPageChanges,this._paginator.initialized):at(null),i=this._data,s=In([i,this._filter]).pipe(Re(([a])=>this._filterData(a))),r=In([s,t]).pipe(Re(([a])=>this._orderData(a))),o=In([r,e]).pipe(Re(([a])=>this._pageData(a)));this._renderChangesSubscription?.unsubscribe(),this._renderChangesSubscription=o.subscribe(a=>this._renderData.next(a))}_filterData(t){return this.filteredData=this.filter==null||this.filter===""?t:t.filter(e=>this.filterPredicate(e,this.filter)),this.paginator&&this._updatePaginator(this.filteredData.length),this.filteredData}_orderData(t){return this.sort?this.sortData(t.slice(),this.sort):t}_pageData(t){if(!this.paginator)return t;let e=this.paginator.pageIndex*this.paginator.pageSize;return t.slice(e,e+this.paginator.pageSize)}_updatePaginator(t){Promise.resolve().then(()=>{let e=this.paginator;if(e&&(e.length=t,e.pageIndex>0)){let i=Math.ceil(e.length/e.pageSize)-1||0,s=Math.min(e.pageIndex,i);s!==e.pageIndex&&(e.pageIndex=s,this._internalPageChanges.next())}})}connect(){return this._renderChangesSubscription||this._updateChangeSubscription(),this._renderData}disconnect(){this._renderChangesSubscription?.unsubscribe(),this._renderChangesSubscription=null}};var Rp=()=>[5,10,20],Ip=n=>[n],kp=n=>[n,"viewer"];function xp(n,t){n&1&&(y(0,"th",10),A(1,"#"),C())}function Np(n,t){if(n&1&&(y(0,"td",11),A(1),C()),n&2){let e=t.index,i=j();E(),Pe(" ",(i.paginator()?i.paginator().pageIndex:0)*(i.paginator()?i.paginator().pageSize:0)+e+1," ")}}function Pp(n,t){n&1&&(y(0,"th",10),A(1,"Question"),C())}function Ap(n,t){if(n&1&&(y(0,"td",11),A(1),C()),n&2){let e=t.$implicit;E(),Qe(e.questionText)}}function Op(n,t){n&1&&(y(0,"th",10),A(1,"Chart"),C())}function Mp(n,t){if(n&1&&(y(0,"td",11),A(1),C()),n&2){let e=t.$implicit;E(),Qe(e.chartType)}}function Fp(n,t){n&1&&Z(0,"th",10)}function Lp(n,t){if(n&1&&(y(0,"td",11)(1,"div",12)(2,"a",13),A(3,"Edit"),C(),y(4,"a",13),A(5,"View"),C()()()),n&2){let e=t.$implicit;E(2),M("routerLink",ji(2,Ip,e._id)),E(2),M("routerLink",ji(4,kp,e._id))}}function Bp(n,t){n&1&&Z(0,"tr",14)}function zp(n,t){n&1&&Z(0,"tr",15)}var Vc=(()=>{class n{data=ao([]);displayedColumns=["index","questionText","chart","action"];dataSource=new Dn([]);paginator=ho(Mt);dataEff=yo(()=>{this.data()&&(this.dataSource=new Dn(this.data()),this.paginator()&&(this.dataSource.paginator=this.paginator()))});static \u0275fac=function(i){return new(i||n)};static \u0275cmp=U({type:n,selectors:[["hls-question-table"]],viewQuery:function(i,s){i&1&&_o(s.paginator,Mt,5),i&2&&mo()},inputs:{data:[1,"data"]},decls:16,vars:5,consts:[["mat-table","",3,"dataSource"],["matColumnDef","index"],["mat-header-cell","",4,"matHeaderCellDef"],["mat-cell","",4,"matCellDef"],["matColumnDef","questionText"],["matColumnDef","chart"],["matColumnDef","action"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["showFirstLastButtons","","aria-label","Select page of periodic elements",3,"pageSizeOptions"],["mat-header-cell",""],["mat-cell",""],[1,"flex","gap-2"],["mat-button","",3,"routerLink"],["mat-header-row",""],["mat-row",""]],template:function(i,s){i&1&&(y(0,"table",0),$e(1,1),z(2,xp,2,0,"th",2)(3,Np,2,1,"td",3),Ge(),$e(4,4),z(5,Pp,2,0,"th",2)(6,Ap,2,1,"td",3),Ge(),$e(7,5),z(8,Op,2,0,"th",2)(9,Mp,2,1,"td",3),Ge(),$e(10,6),z(11,Fp,1,0,"th",2)(12,Lp,6,6,"td",3),Ge(),z(13,Bp,1,0,"tr",7)(14,zp,1,0,"tr",8),C(),Z(15,"mat-paginator",9)),i&2&&(M("dataSource",s.dataSource),E(13),M("matHeaderRowDef",s.displayedColumns),E(),M("matRowDefColumns",s.displayedColumns),E(),M("pageSizeOptions",On(4,Rp)))},dependencies:[Uc,Pc,Oc,Bc,Mc,Ac,zc,Fc,Lc,Hc,Wc,Sc,Mt,_t,zn,Bn],encapsulation:2})}return n})();var Hp=()=>["create"];function Wp(n,t){if(n&1&&Z(0,"hls-question-table",1),n&2){let e=j();M("data",e.dataSource())}}var fg=(()=>{class n{destroyed$=new se;realtimeDatabaseService=_(gc);questionDataService=_(xo);dataSource=lo([]);ngOnInit(){this.questionDataService.getQuestions().subscribe(e=>this.dataSource.set(e))}ngOnDestroy(){this.destroyed$.next(),this.destroyed$.complete()}convertToQuestionTypeArray(e){let i=[];for(let s in e)if(Object.prototype.hasOwnProperty.call(e,s)&&s!=="questionText"){let r=e[s],o={id:s,questionText:r.questionText||"",chartType:r.chartType,options:r.options,surveyAssignment:r.surveyAssignment,topics:r.topics,additionalOptions:r.additionalOptions,resultsVisibility:r.resultsVisibility,public:r.public,startDate:r.startDate||r.startDay,endDate:r.endDate||r.endDay};Object.keys(o).forEach(a=>o[a]===void 0?delete o[a]:{}),i.push(o)}return i}static \u0275fac=function(i){return new(i||n)};static \u0275cmp=U({type:n,selectors:[["hls-questions-page"]],decls:10,vars:3,consts:[[1,"container"],[3,"data"],["mat-button","",3,"routerLink"]],template:function(i,s){i&1&&(y(0,"div",0)(1,"mat-card")(2,"mat-card-header")(3,"mat-card-title"),A(4,"Questions"),C()(),y(5,"mat-card-content"),z(6,Wp,1,1,"hls-question-table",1),C(),y(7,"mat-card-actions")(8,"a",2),A(9,"Create Question"),C()()()()),i&2&&(E(6),Y(s.dataSource().length!==0?6:-1),E(2),M("routerLink",On(2,Hp)))},dependencies:[Vc,Vo,Bo,Wo,Ho,Uo,zo,_t,zn,Bn],encapsulation:2})}return n})();export{fg as QuestionsPageComponent};
